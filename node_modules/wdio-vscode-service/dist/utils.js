import fs from 'node:fs/promises';
import url from 'node:url';
import path from 'node:path';
import child_process from 'node:child_process';
import { VSCODE_CAPABILITY_KEY } from './constants.js';
const __dirname = url.fileURLToPath(new URL('.', import.meta.url));
function isEmulatedRosettaEnvironment() {
    const archName = child_process.spawnSync('uname', ['-m']).stdout.toString().trim();
    if (archName !== 'x86_64') {
        return false;
    }
    const processTranslated = child_process.spawnSync('sysctl', ['-in', 'sysctl.proc_translated'])
        .stdout.toString()
        .trim();
    return processTranslated === '1';
}
function getMacOsRealArch(chromeDriverVersion) {
    if (process.arch === 'arm64' || isEmulatedRosettaEnvironment()) {
        if (parseInt(chromeDriverVersion.split('.')[0], 10) > 106) {
            return 'mac_arm64';
        }
        return 'mac64_m1';
    }
    if (process.arch === 'x64') {
        return 'mac64';
    }
    return null;
}
export function validatePlatform(chromeDriverVersion) {
    if (process.platform === 'linux') {
        if (process.arch === 'arm64' || process.arch === 'x64') {
            return `${process.platform}64`;
        }
        throw new Error('Only Linux 64 bits supported.');
    }
    if (process.platform === 'darwin' || process.platform === 'freebsd') {
        const osxPlatform = getMacOsRealArch(chromeDriverVersion);
        if (!osxPlatform) {
            throw new Error('Only Mac 64 bits supported.');
        }
        return osxPlatform;
    }
    if (process.platform !== 'win32') {
        throw new Error(`Unexpected platform or architecture: ${process.platform}, ${process.arch}`);
    }
    return process.platform;
}
export async function getLocators(version) {
    if (version === 'insiders') {
        return import('./locators/insiders.js');
    }
    const files = (await fs.readdir(path.join(__dirname, 'locators'), { encoding: 'utf-8' }))
        .filter((filename) => filename.endsWith('.js') && !filename.endsWith('.d.ts'))
        .map((filename) => filename.slice(0, -3));
    const [major, minor] = version.split('.');
    const sanitizedVersion = `${major}.${minor}.0`;
    const locatorFile = files.find((f, i) => (f === sanitizedVersion
        || (files[i + 1] && files[i + 1] > sanitizedVersion))) || files[files.length - 1];
    return import(`./locators/${locatorFile}.js`);
}
export function fileExist(filepath) {
    return fs.access(filepath).then(() => true, () => false);
}
export async function directoryExists(directoryPath) {
    try {
        const stats = await fs.stat(directoryPath);
        return stats.isDirectory();
    }
    catch {
        return false;
    }
}
export function getValueSuffix(value) {
    if (typeof value === 'boolean' && value) {
        return '';
    }
    return `=${value}`;
}
export function isVSCodeCapability(cap) {
    return Boolean(cap[VSCODE_CAPABILITY_KEY]);
}
var FileType;
(function (FileType) {
    FileType[FileType["Unknown"] = 0] = "Unknown";
    FileType[FileType["File"] = 1] = "File";
    FileType[FileType["Directory"] = 2] = "Directory";
    FileType[FileType["SymbolicLink"] = 64] = "SymbolicLink";
})(FileType || (FileType = {}));
export function getFileType(stats) {
    if (stats.isFile()) {
        return FileType.File;
    }
    if (stats.isDirectory()) {
        return FileType.Directory;
    }
    if (stats.isSymbolicLink()) {
        return FileType.SymbolicLink;
    }
    return FileType.Unknown;
}
export const isMultiremote = (obj) => typeof obj === 'object' && !Array.isArray(obj);
export const isChrome = (cap) => cap.browserName && cap.browserName.toLowerCase() === 'chrome';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFDakMsT0FBTyxHQUFHLE1BQU0sVUFBVSxDQUFBO0FBQzFCLE9BQU8sSUFBSSxNQUFNLFdBQVcsQ0FBQTtBQUM1QixPQUFPLGFBQWEsTUFBTSxvQkFBb0IsQ0FBQTtBQUc5QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQTtBQUl0RCxNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLElBQUksR0FBRyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7QUFFbEUsU0FBUyw0QkFBNEI7SUFDakMsTUFBTSxRQUFRLEdBQUcsYUFBYSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUVsRixJQUFJLFFBQVEsS0FBSyxRQUFRLEVBQUU7UUFDdkIsT0FBTyxLQUFLLENBQUE7S0FDZjtJQUVELE1BQU0saUJBQWlCLEdBQUcsYUFBYSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxLQUFLLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztTQUN6RixNQUFNLENBQUMsUUFBUSxFQUFFO1NBQ2pCLElBQUksRUFBRSxDQUFBO0lBQ1gsT0FBTyxpQkFBaUIsS0FBSyxHQUFHLENBQUE7QUFDcEMsQ0FBQztBQUVELFNBQVMsZ0JBQWdCLENBQUUsbUJBQTJCO0lBQ2xELElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxPQUFPLElBQUksNEJBQTRCLEVBQUUsRUFBRTtRQUM1RCxJQUFJLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVB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QUFPLENBQUE7QUFDM0IsQ0FBQztBQUVELE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxDQUFDLEdBQVEsRUFBRSxFQUFFLENBQUMsT0FBTyxHQUFHLEtBQUssUUFBUSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQTtBQUN6RixNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxHQUF1QixFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsV0FBVyxJQUFJLEdBQUcsQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLEtBQUssUUFBUSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ25vZGU6ZnMvcHJvbWlzZXMnXG5pbXBvcnQgdXJsIGZyb20gJ25vZGU6dXJsJ1xuaW1wb3J0IHBhdGggZnJvbSAnbm9kZTpwYXRoJ1xuaW1wb3J0IGNoaWxkX3Byb2Nlc3MgZnJvbSAnbm9kZTpjaGlsZF9wcm9jZXNzJ1xuaW1wb3J0IHR5cGUgeyBEaXJlbnQsIFN0YXRzIH0gZnJvbSAnbm9kZTpmcydcblxuaW1wb3J0IHsgVlNDT0RFX0NBUEFCSUxJVFlfS0VZIH0gZnJvbSAnLi9jb25zdGFudHMuanMnXG5pbXBvcnQgdHlwZSB7IFZTQ29kZUxvY2F0b3JNYXAgfSBmcm9tICcuL3BhZ2VvYmplY3RzL3V0aWxzJ1xuaW1wb3J0IHR5cGUgeyBWU0NvZGVDYXBhYmlsaXRpZXMgfSBmcm9tICcuL3R5cGVzJ1xuXG5jb25zdCBfX2Rpcm5hbWUgPSB1cmwuZmlsZVVSTFRvUGF0aChuZXcgVVJMKCcuJywgaW1wb3J0Lm1ldGEudXJsKSlcblxuZnVuY3Rpb24gaXNFbXVsYXRlZFJvc2V0dGFFbnZpcm9ubWVudCAoKSB7XG4gICAgY29uc3QgYXJjaE5hbWUgPSBjaGlsZF9wcm9jZXNzLnNwYXduU3luYygndW5hbWUnLCBbJy1tJ10pLnN0ZG91dC50b1N0cmluZygpLnRyaW0oKVxuXG4gICAgaWYgKGFyY2hOYW1lICE9PSAneDg2XzY0Jykge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICBjb25zdCBwcm9jZXNzVHJhbnNsYXRlZCA9IGNoaWxkX3Byb2Nlc3Muc3Bhd25TeW5jKCdzeXNjdGwnLCBbJy1pbicsICdzeXNjdGwucHJvY190cmFuc2xhdGVkJ10pXG4gICAgICAgIC5zdGRvdXQudG9TdHJpbmcoKVxuICAgICAgICAudHJpbSgpXG4gICAgcmV0dXJuIHByb2Nlc3NUcmFuc2xhdGVkID09PSAnMSdcbn1cblxuZnVuY3Rpb24gZ2V0TWFjT3NSZWFsQXJjaCAoY2hyb21lRHJpdmVyVmVyc2lvbjogc3RyaW5nKSB7XG4gICAgaWYgKHByb2Nlc3MuYXJjaCA9PT0gJ2FybTY0JyB8fCBpc0VtdWxhdGVkUm9zZXR0YUVudmlyb25tZW50KCkpIHtcbiAgICAgICAgaWYgKHBhcnNlSW50KGNocm9tZURyaXZlclZlcnNpb24uc3BsaXQoJy4nKVswXSwgMTApID4gMTA2KSB7XG4gICAgICAgICAgICByZXR1cm4gJ21hY19hcm02NCdcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJ21hYzY0X20xJ1xuICAgIH1cblxuICAgIGlmIChwcm9jZXNzLmFyY2ggPT09ICd4NjQnKSB7XG4gICAgICAgIHJldHVybiAnbWFjNjQnXG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGxcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUGxhdGZvcm0gKGNocm9tZURyaXZlclZlcnNpb246IHN0cmluZykge1xuICAgIGlmIChwcm9jZXNzLnBsYXRmb3JtID09PSAnbGludXgnKSB7XG4gICAgICAgIGlmIChwcm9jZXNzLmFyY2ggPT09ICdhcm02NCcgfHwgcHJvY2Vzcy5hcmNoID09PSAneDY0Jykge1xuICAgICAgICAgICAgcmV0dXJuIGAke3Byb2Nlc3MucGxhdGZvcm19NjRgXG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgTGludXggNjQgYml0cyBzdXBwb3J0ZWQuJylcbiAgICB9XG5cbiAgICBpZiAocHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ2RhcndpbicgfHwgcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ2ZyZWVic2QnKSB7XG4gICAgICAgIGNvbnN0IG9zeFBsYXRmb3JtID0gZ2V0TWFjT3NSZWFsQXJjaChjaHJvbWVEcml2ZXJWZXJzaW9uKVxuXG4gICAgICAgIGlmICghb3N4UGxhdGZvcm0pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignT25seSBNYWMgNjQgYml0cyBzdXBwb3J0ZWQuJylcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBvc3hQbGF0Zm9ybVxuICAgIH1cblxuICAgIGlmIChwcm9jZXNzLnBsYXRmb3JtICE9PSAnd2luMzInKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3RlZCBwbGF0Zm9ybSBvciBhcmNoaXRlY3R1cmU6ICR7cHJvY2Vzcy5wbGF0Zm9ybX0sICR7cHJvY2Vzcy5hcmNofWApXG4gICAgfVxuXG4gICAgcmV0dXJuIHByb2Nlc3MucGxhdGZvcm1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldExvY2F0b3JzICh2ZXJzaW9uOiBzdHJpbmcpOiBQcm9taXNlPFZTQ29kZUxvY2F0b3JNYXA+IHtcbiAgICBpZiAodmVyc2lvbiA9PT0gJ2luc2lkZXJzJykge1xuICAgICAgICByZXR1cm4gaW1wb3J0KCcuL2xvY2F0b3JzL2luc2lkZXJzLmpzJykgYXMgYW55IGFzIFByb21pc2U8VlNDb2RlTG9jYXRvck1hcD5cbiAgICB9XG5cbiAgICBjb25zdCBmaWxlcyA9IChhd2FpdCBmcy5yZWFkZGlyKHBhdGguam9pbihfX2Rpcm5hbWUsICdsb2NhdG9ycycpLCB7IGVuY29kaW5nOiAndXRmLTgnIH0pKVxuICAgICAgICAuZmlsdGVyKChmaWxlbmFtZSkgPT4gZmlsZW5hbWUuZW5kc1dpdGgoJy5qcycpICYmICFmaWxlbmFtZS5lbmRzV2l0aCgnLmQudHMnKSlcbiAgICAgICAgLm1hcCgoZmlsZW5hbWUpID0+IGZpbGVuYW1lLnNsaWNlKDAsIC0zKSlcblxuICAgIGNvbnN0IFttYWpvciwgbWlub3JdID0gdmVyc2lvbi5zcGxpdCgnLicpXG4gICAgY29uc3Qgc2FuaXRpemVkVmVyc2lvbiA9IGAke21ham9yfS4ke21pbm9yfS4wYFxuXG4gICAgY29uc3QgbG9jYXRvckZpbGUgPSBmaWxlcy5maW5kKChmLCBpKSA9PiAoXG4gICAgICAgIGYgPT09IHNhbml0aXplZFZlcnNpb25cbiAgICAgICAgfHwgKGZpbGVzW2kgKyAxXSAmJiBmaWxlc1tpICsgMV0gPiBzYW5pdGl6ZWRWZXJzaW9uKVxuICAgICkpIHx8IGZpbGVzW2ZpbGVzLmxlbmd0aCAtIDFdXG4gICAgcmV0dXJuIGltcG9ydChgLi9sb2NhdG9ycy8ke2xvY2F0b3JGaWxlfS5qc2ApIGFzIFByb21pc2U8VlNDb2RlTG9jYXRvck1hcD5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbGVFeGlzdCAoZmlsZXBhdGg6IHN0cmluZykge1xuICAgIHJldHVybiBmcy5hY2Nlc3MoZmlsZXBhdGgpLnRoZW4oKCkgPT4gdHJ1ZSwgKCkgPT4gZmFsc2UpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkaXJlY3RvcnlFeGlzdHMgKGRpcmVjdG9yeVBhdGg6IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgZnMuc3RhdChkaXJlY3RvcnlQYXRoKVxuICAgICAgICByZXR1cm4gc3RhdHMuaXNEaXJlY3RvcnkoKVxuICAgIH0gY2F0Y2gge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRWYWx1ZVN1ZmZpeCAodmFsdWU6IHN0cmluZyB8IGJvb2xlYW4pIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgJiYgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuICcnXG4gICAgfVxuICAgIHJldHVybiBgPSR7dmFsdWV9YFxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNWU0NvZGVDYXBhYmlsaXR5IChjYXA6IFZTQ29kZUNhcGFiaWxpdGllcykge1xuICAgIHJldHVybiBCb29sZWFuKGNhcFtWU0NPREVfQ0FQQUJJTElUWV9LRVldKVxufVxuXG5lbnVtIEZpbGVUeXBlIHtcbiAgICBVbmtub3duID0gMCxcbiAgICBGaWxlID0gMSxcbiAgICBEaXJlY3RvcnkgPSAyLFxuICAgIFN5bWJvbGljTGluayA9IDY0XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWxlVHlwZSAoc3RhdHM6IFN0YXRzIHwgRGlyZW50KSB7XG4gICAgaWYgKHN0YXRzLmlzRmlsZSgpKSB7XG4gICAgICAgIHJldHVybiBGaWxlVHlwZS5GaWxlXG4gICAgfVxuXG4gICAgaWYgKHN0YXRzLmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgcmV0dXJuIEZpbGVUeXBlLkRpcmVjdG9yeVxuICAgIH1cblxuICAgIGlmIChzdGF0cy5pc1N5bWJvbGljTGluaygpKSB7XG4gICAgICAgIHJldHVybiBGaWxlVHlwZS5TeW1ib2xpY0xpbmtcbiAgICB9XG5cbiAgICByZXR1cm4gRmlsZVR5cGUuVW5rbm93blxufVxuXG5leHBvcnQgY29uc3QgaXNNdWx0aXJlbW90ZSA9IChvYmo6IGFueSkgPT4gdHlwZW9mIG9iaiA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkob2JqKVxuZXhwb3J0IGNvbnN0IGlzQ2hyb21lID0gKGNhcDogVlNDb2RlQ2FwYWJpbGl0aWVzKSA9PiBjYXAuYnJvd3Nlck5hbWUgJiYgY2FwLmJyb3dzZXJOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdjaHJvbWUnXG4iXX0=