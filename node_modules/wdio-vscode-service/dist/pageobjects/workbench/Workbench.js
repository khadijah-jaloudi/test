var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { TitleBar } from '../menu/TitleBar.js';
import { SideBarView } from '../sidebar/SideBarView.js';
import { ActivityBar } from '../activityBar/ActivityBar.js';
import { StatusBar } from '../statusBar/StatusBar.js';
import { EditorView } from '../editor/EditorView.js';
import { BottomBarPanel } from '../bottomBar/BottomBarPanel.js';
import { StandaloneNotification } from './Notification.js';
import { QuickOpenBox, InputBox } from './Input.js';
import { SettingsEditor } from '../editor/SettingsEditor.js';
import { WebView } from './WebView.js';
import { PageDecorator, BasePage, sleep } from '../utils.js';
import { Workbench as WorkbenchLocators } from '../../locators/1.73.0.js';
/**
 * Page object representing the custom VSCode title bar
 *
 * @category Workbench
 */
export let Workbench = class Workbench extends BasePage {
    constructor() {
        super(...arguments);
        /**
         * @private
         */
        this.locatorKey = 'Workbench';
    }
    /**
     * Get a title bar handle
     */
    getTitleBar() {
        return new TitleBar(this.locatorMap);
    }
    /**
     * Get a side bar handle
     */
    getSideBar() {
        return new SideBarView(this.locatorMap);
    }
    /**
     * Get an activity bar handle
     */
    getActivityBar() {
        return new ActivityBar(this.locatorMap);
    }
    /**
     * Get a status bar handle
     */
    getStatusBar() {
        return new StatusBar(this.locatorMap);
    }
    /**
     * Get a bottom bar handle
     */
    getBottomBar() {
        return new BottomBarPanel(this.locatorMap);
    }
    /**
     * Get a handle for the editor view
     */
    getEditorView() {
        return new EditorView(this.locatorMap);
    }
    /**
     * Get all available webviews
     */
    getAllWebviews() {
        return WebView.getAllWebViews(this._locators);
    }
    /**
     * Get webview by title
     */
    async getWebviewByTitle(title) {
        const webviews = await this.getAllWebviews();
        if (webviews.length === 0) {
            throw new Error('No webviews found');
        }
        const foundTitles = [];
        const getTitle = () => document.title;
        for (const webview of webviews) {
            /**
             * jump into webview
             */
            await webview.open();
            /**
             * get the title of webview
             */
            const webviewTitle = await browser.execute(getTitle);
            foundTitles.push(webviewTitle);
            /**
             * jump out of webview
             */
            await webview.close();
            if (webviewTitle.match(title)) {
                return webview;
            }
        }
        throw new Error(`Couldn't find webview with title "${title}", `
            + `the following webview titles were found: "${foundTitles.join('", "')}"`);
    }
    /**
     * Get all standalone notifications (notifications outside the notifications center)
     * @returns Promise resolving to array of Notification objects
     */
    async getNotifications() {
        const notifications = [];
        const containers = await this.notificationContainer$$;
        if (containers.length === 0) {
            return [];
        }
        for (const container of containers) {
            const elements = await container.$$(this.locators.notificationItem);
            for (const element of elements) {
                notifications.push(await new StandaloneNotification(this.locatorMap, 
                // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
                element).wait());
            }
        }
        return notifications;
    }
    /**
     * Verifies if any notifications are shown
     * @returns true if workbench has notifications, false otherwise
     */
    hasNotifications() {
        return this.notificationContainer$.isExisting();
    }
    /**
     * Opens the notifications center
     * @returns Promise resolving to NotificationsCenter object
     */
    openNotificationsCenter() {
        const statusBar = new StatusBar(this.locatorMap);
        return statusBar.openNotificationsCenter();
    }
    /**
     * Opens the settings editor
     *
     * @returns promise that resolves to a SettingsEditor instance
     */
    async openSettings() {
        await this.executeCommand('Preferences: Open User Settings');
        await new EditorView(this.locatorMap).openEditor('Settings');
        await this.elem.$(this.locatorMap.Editor.elem).waitForExist();
        await sleep(500);
        return new SettingsEditor(this.locatorMap);
    }
    /**
     * Open the VS Code command line prompt
     * @returns Promise resolving to InputBox (vscode 1.44+) or QuickOpenBox (vscode up to 1.43) object
     */
    async openCommandPrompt() {
        const editorView = await new EditorView(this.locatorMap).wait();
        const webview = await editorView.webView$$;
        if (webview.length > 0) {
            const tab = await editorView.getActiveTab();
            if (tab) {
                await tab.elem.addValue('F1');
                const inputBox = new InputBox(this.locatorMap).wait();
                return inputBox;
            }
        }
        await browser.keys(['F1']);
        if ((await browser.getVSCodeChannel() === 'vscode' && await browser.getVSCodeVersion() >= '1.44.0')
            || await browser.getVSCodeVersion() === 'insiders') {
            return new InputBox(this.locatorMap).wait();
        }
        return new QuickOpenBox(this.locatorMap).wait();
    }
    /**
     * Open the command prompt, type in a command, find the command using a fuzzy match, and execute
     * @param command text of the command to be executed
     * @returns Promise resolving to InputBox (vscode 1.44+) or QuickOpenBox (vscode up to 1.43) object
     * when the command prompt is confirmed
     */
    async executeCommand(command) {
        const prompt = await this.openCommandPrompt();
        await prompt.setText(`>${command}`);
        await prompt.confirm();
        return prompt;
    }
    /**
     * Open the command prompt, type in a command, find the command from the quick pick list, and execute
     * @param command text of the command to be executed
     * @returns Promise resolving to InputBox (vscode 1.44+) or QuickOpenBox (vscode up to 1.43) object
     * when the command prompt is confirmed
     */
    async executeQuickPick(command) {
        const prompt = await this.openCommandPrompt();
        await prompt.setText(`>${command}`);
        const quickPicks = await prompt.getQuickPicks();
        for (const quickPick of quickPicks) {
            const label = await quickPick.getLabel();
            if (label === command) {
                await quickPick.select();
                return prompt;
            }
        }
        throw new Error('Command not found');
    }
};
Workbench = __decorate([
    PageDecorator(WorkbenchLocators)
], Workbench);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV29ya2JlbmNoLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3BhZ2VvYmplY3RzL3dvcmtiZW5jaC9Xb3JrYmVuY2gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBQzlDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQTtBQUN2RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sK0JBQStCLENBQUE7QUFDM0QsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDJCQUEyQixDQUFBO0FBQ3JELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQTtBQUNwRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZ0NBQWdDLENBQUE7QUFDL0QsT0FBTyxFQUFnQixzQkFBc0IsRUFBRSxNQUFNLG1CQUFtQixDQUFBO0FBRXhFLE9BQU8sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFBO0FBQ25ELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUM1RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBRXRDLE9BQU8sRUFDSCxhQUFhLEVBQWtCLFFBQVEsRUFBRSxLQUFLLEVBQ2pELE1BQU0sYUFBYSxDQUFBO0FBQ3BCLE9BQU8sRUFBRSxTQUFTLElBQUksaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQTtBQUd6RTs7OztHQUlHO0FBRUksV0FBTSxTQUFTLEdBQWYsTUFBTSxTQUFVLFNBQVEsUUFBa0M7SUFBMUQ7O1FBQ0g7O1dBRUc7UUFDSSxlQUFVLEdBQUcsV0FBb0IsQ0FBQTtJQWlONUMsQ0FBQztJQS9NRzs7T0FFRztJQUNILFdBQVc7UUFDUCxPQUFPLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUN4QyxDQUFDO0lBRUQ7O09B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Q25CLE1BQU0sU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFBO2dCQUN4QixPQUFPLE1BQU0sQ0FBQTthQUNoQjtTQUNKO1FBRUQsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxDQUFBO0lBQ3hDLENBQUM7Q0FDSixDQUFBO0FBck5ZLFNBQVM7SUFEckIsYUFBYSxDQUFDLGlCQUFpQixDQUFDO0dBQ3BCLFNBQVMsQ0FxTnJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGl0bGVCYXIgfSBmcm9tICcuLi9tZW51L1RpdGxlQmFyLmpzJ1xuaW1wb3J0IHsgU2lkZUJhclZpZXcgfSBmcm9tICcuLi9zaWRlYmFyL1NpZGVCYXJWaWV3LmpzJ1xuaW1wb3J0IHsgQWN0aXZpdHlCYXIgfSBmcm9tICcuLi9hY3Rpdml0eUJhci9BY3Rpdml0eUJhci5qcydcbmltcG9ydCB7IFN0YXR1c0JhciB9IGZyb20gJy4uL3N0YXR1c0Jhci9TdGF0dXNCYXIuanMnXG5pbXBvcnQgeyBFZGl0b3JWaWV3IH0gZnJvbSAnLi4vZWRpdG9yL0VkaXRvclZpZXcuanMnXG5pbXBvcnQgeyBCb3R0b21CYXJQYW5lbCB9IGZyb20gJy4uL2JvdHRvbUJhci9Cb3R0b21CYXJQYW5lbC5qcydcbmltcG9ydCB7IE5vdGlmaWNhdGlvbiwgU3RhbmRhbG9uZU5vdGlmaWNhdGlvbiB9IGZyb20gJy4vTm90aWZpY2F0aW9uLmpzJ1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uc0NlbnRlciB9IGZyb20gJy4vTm90aWZpY2F0aW9uc0NlbnRlci5qcydcbmltcG9ydCB7IFF1aWNrT3BlbkJveCwgSW5wdXRCb3ggfSBmcm9tICcuL0lucHV0LmpzJ1xuaW1wb3J0IHsgU2V0dGluZ3NFZGl0b3IgfSBmcm9tICcuLi9lZGl0b3IvU2V0dGluZ3NFZGl0b3IuanMnXG5pbXBvcnQgeyBXZWJWaWV3IH0gZnJvbSAnLi9XZWJWaWV3LmpzJ1xuXG5pbXBvcnQge1xuICAgIFBhZ2VEZWNvcmF0b3IsIElQYWdlRGVjb3JhdG9yLCBCYXNlUGFnZSwgc2xlZXBcbn0gZnJvbSAnLi4vdXRpbHMuanMnXG5pbXBvcnQgeyBXb3JrYmVuY2ggYXMgV29ya2JlbmNoTG9jYXRvcnMgfSBmcm9tICcuLi8uLi9sb2NhdG9ycy8xLjczLjAuanMnXG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2JlbmNoIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFdvcmtiZW5jaExvY2F0b3JzPiB7fVxuLyoqXG4gKiBQYWdlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGN1c3RvbSBWU0NvZGUgdGl0bGUgYmFyXG4gKlxuICogQGNhdGVnb3J5IFdvcmtiZW5jaFxuICovXG5AUGFnZURlY29yYXRvcihXb3JrYmVuY2hMb2NhdG9ycylcbmV4cG9ydCBjbGFzcyBXb3JrYmVuY2ggZXh0ZW5kcyBCYXNlUGFnZTx0eXBlb2YgV29ya2JlbmNoTG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ1dvcmtiZW5jaCcgYXMgY29uc3RcblxuICAgIC8qKlxuICAgICAqIEdldCBhIHRpdGxlIGJhciBoYW5kbGVcbiAgICAgKi9cbiAgICBnZXRUaXRsZUJhciAoKTogVGl0bGVCYXIge1xuICAgICAgICByZXR1cm4gbmV3IFRpdGxlQmFyKHRoaXMubG9jYXRvck1hcClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYSBzaWRlIGJhciBoYW5kbGVcbiAgICAgKi9cbiAgICBnZXRTaWRlQmFyICgpOiBTaWRlQmFyVmlldzxhbnk+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBTaWRlQmFyVmlldzxhbnk+KHRoaXMubG9jYXRvck1hcClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYW4gYWN0aXZpdHkgYmFyIGhhbmRsZVxuICAgICAqL1xuICAgIGdldEFjdGl2aXR5QmFyICgpOiBBY3Rpdml0eUJhciB7XG4gICAgICAgIHJldHVybiBuZXcgQWN0aXZpdHlCYXIodGhpcy5sb2NhdG9yTWFwKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIHN0YXR1cyBiYXIgaGFuZGxlXG4gICAgICovXG4gICAgZ2V0U3RhdHVzQmFyICgpOiBTdGF0dXNCYXIge1xuICAgICAgICByZXR1cm4gbmV3IFN0YXR1c0Jhcih0aGlzLmxvY2F0b3JNYXApXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgYm90dG9tIGJhciBoYW5kbGVcbiAgICAgKi9cbiAgICBnZXRCb3R0b21CYXIgKCk6IEJvdHRvbUJhclBhbmVsIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCb3R0b21CYXJQYW5lbCh0aGlzLmxvY2F0b3JNYXApXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgaGFuZGxlIGZvciB0aGUgZWRpdG9yIHZpZXdcbiAgICAgKi9cbiAgICBnZXRFZGl0b3JWaWV3ICgpOiBFZGl0b3JWaWV3IHtcbiAgICAgICAgcmV0dXJuIG5ldyBFZGl0b3JWaWV3KHRoaXMubG9jYXRvck1hcClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIGF2YWlsYWJsZSB3ZWJ2aWV3c1xuICAgICAqL1xuICAgIGdldEFsbFdlYnZpZXdzICgpIHtcbiAgICAgICAgcmV0dXJuIFdlYlZpZXcuZ2V0QWxsV2ViVmlld3ModGhpcy5fbG9jYXRvcnMpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHdlYnZpZXcgYnkgdGl0bGVcbiAgICAgKi9cbiAgICBhc3luYyBnZXRXZWJ2aWV3QnlUaXRsZSAodGl0bGU6IHN0cmluZyB8IFJlZ0V4cCkge1xuICAgICAgICBjb25zdCB3ZWJ2aWV3cyA9IGF3YWl0IHRoaXMuZ2V0QWxsV2Vidmlld3MoKVxuXG4gICAgICAgIGlmICh3ZWJ2aWV3cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gd2Vidmlld3MgZm91bmQnKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZm91bmRUaXRsZXM6IHN0cmluZ1tdID0gW11cbiAgICAgICAgY29uc3QgZ2V0VGl0bGUgPSAoKSA9PiBkb2N1bWVudC50aXRsZVxuICAgICAgICBmb3IgKGNvbnN0IHdlYnZpZXcgb2Ygd2Vidmlld3MpIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICoganVtcCBpbnRvIHdlYnZpZXdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgYXdhaXQgd2Vidmlldy5vcGVuKClcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBnZXQgdGhlIHRpdGxlIG9mIHdlYnZpZXdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29uc3Qgd2Vidmlld1RpdGxlID0gYXdhaXQgYnJvd3Nlci5leGVjdXRlKGdldFRpdGxlKVxuICAgICAgICAgICAgZm91bmRUaXRsZXMucHVzaCh3ZWJ2aWV3VGl0bGUpXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICoganVtcCBvdXQgb2Ygd2Vidmlld1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBhd2FpdCB3ZWJ2aWV3LmNsb3NlKClcblxuICAgICAgICAgICAgaWYgKHdlYnZpZXdUaXRsZS5tYXRjaCh0aXRsZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gd2Vidmlld1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYENvdWxkbid0IGZpbmQgd2VidmlldyB3aXRoIHRpdGxlIFwiJHt0aXRsZX1cIiwgYFxuICAgICAgICAgICAgKyBgdGhlIGZvbGxvd2luZyB3ZWJ2aWV3IHRpdGxlcyB3ZXJlIGZvdW5kOiBcIiR7Zm91bmRUaXRsZXMuam9pbignXCIsIFwiJyl9XCJgXG4gICAgICAgIClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHN0YW5kYWxvbmUgbm90aWZpY2F0aW9ucyAobm90aWZpY2F0aW9ucyBvdXRzaWRlIHRoZSBub3RpZmljYXRpb25zIGNlbnRlcilcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBhcnJheSBvZiBOb3RpZmljYXRpb24gb2JqZWN0c1xuICAgICAqL1xuICAgIGFzeW5jIGdldE5vdGlmaWNhdGlvbnMgKCk6IFByb21pc2U8Tm90aWZpY2F0aW9uW10+IHtcbiAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uczogTm90aWZpY2F0aW9uW10gPSBbXVxuICAgICAgICBjb25zdCBjb250YWluZXJzID0gYXdhaXQgdGhpcy5ub3RpZmljYXRpb25Db250YWluZXIkJFxuXG4gICAgICAgIGlmIChjb250YWluZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFtdXG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGNvbnN0IGNvbnRhaW5lciBvZiBjb250YWluZXJzKSB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IGF3YWl0IGNvbnRhaW5lci4kJCh0aGlzLmxvY2F0b3JzLm5vdGlmaWNhdGlvbkl0ZW0pXG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykge1xuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFN0YW5kYWxvbmVOb3RpZmljYXRpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvY2F0b3JNYXAsXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hcmd1bWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCBhcyBhbnlcbiAgICAgICAgICAgICAgICAgICAgKS53YWl0KClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbm90aWZpY2F0aW9uc1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFZlcmlmaWVzIGlmIGFueSBub3RpZmljYXRpb25zIGFyZSBzaG93blxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgd29ya2JlbmNoIGhhcyBub3RpZmljYXRpb25zLCBmYWxzZSBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBoYXNOb3RpZmljYXRpb25zICgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9uQ29udGFpbmVyJC5pc0V4aXN0aW5nKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVucyB0aGUgbm90aWZpY2F0aW9ucyBjZW50ZXJcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBOb3RpZmljYXRpb25zQ2VudGVyIG9iamVjdFxuICAgICAqL1xuICAgIG9wZW5Ob3RpZmljYXRpb25zQ2VudGVyICgpOiBQcm9taXNlPE5vdGlmaWNhdGlvbnNDZW50ZXI+IHtcbiAgICAgICAgY29uc3Qgc3RhdHVzQmFyID0gbmV3IFN0YXR1c0Jhcih0aGlzLmxvY2F0b3JNYXApXG4gICAgICAgIHJldHVybiBzdGF0dXNCYXIub3Blbk5vdGlmaWNhdGlvbnNDZW50ZXIoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZW5zIHRoZSBzZXR0aW5ncyBlZGl0b3JcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBhIFNldHRpbmdzRWRpdG9yIGluc3RhbmNlXG4gICAgICovXG4gICAgYXN5bmMgb3BlblNldHRpbmdzICgpOiBQcm9taXNlPFNldHRpbmdzRWRpdG9yPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUNvbW1hbmQoJ1ByZWZlcmVuY2VzOiBPcGVuIFVzZXIgU2V0dGluZ3MnKVxuICAgICAgICBhd2FpdCBuZXcgRWRpdG9yVmlldyh0aGlzLmxvY2F0b3JNYXApLm9wZW5FZGl0b3IoJ1NldHRpbmdzJylcbiAgICAgICAgYXdhaXQgdGhpcy5lbGVtLiQodGhpcy5sb2NhdG9yTWFwLkVkaXRvci5lbGVtIGFzIHN0cmluZykud2FpdEZvckV4aXN0KClcbiAgICAgICAgYXdhaXQgc2xlZXAoNTAwKVxuICAgICAgICByZXR1cm4gbmV3IFNldHRpbmdzRWRpdG9yKHRoaXMubG9jYXRvck1hcClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuIHRoZSBWUyBDb2RlIGNvbW1hbmQgbGluZSBwcm9tcHRcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBJbnB1dEJveCAodnNjb2RlIDEuNDQrKSBvciBRdWlja09wZW5Cb3ggKHZzY29kZSB1cCB0byAxLjQzKSBvYmplY3RcbiAgICAgKi9cbiAgICBhc3luYyBvcGVuQ29tbWFuZFByb21wdCAoKTogUHJvbWlzZTxRdWlja09wZW5Cb3ggfCBJbnB1dEJveD4ge1xuICAgICAgICBjb25zdCBlZGl0b3JWaWV3ID0gYXdhaXQgbmV3IEVkaXRvclZpZXcodGhpcy5sb2NhdG9yTWFwKS53YWl0KClcbiAgICAgICAgY29uc3Qgd2VidmlldyA9IGF3YWl0IGVkaXRvclZpZXcud2ViVmlldyQkXG4gICAgICAgIGlmICh3ZWJ2aWV3Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRhYiA9IGF3YWl0IGVkaXRvclZpZXcuZ2V0QWN0aXZlVGFiKClcbiAgICAgICAgICAgIGlmICh0YWIpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0YWIuZWxlbS5hZGRWYWx1ZSgnRjEnKVxuICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0Qm94ID0gbmV3IElucHV0Qm94KHRoaXMubG9jYXRvck1hcCkud2FpdCgpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0Qm94XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgYnJvd3Nlci5rZXlzKFsnRjEnXSlcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgKGF3YWl0IGJyb3dzZXIuZ2V0VlNDb2RlQ2hhbm5lbCgpID09PSAndnNjb2RlJyAmJiBhd2FpdCBicm93c2VyLmdldFZTQ29kZVZlcnNpb24oKSA+PSAnMS40NC4wJylcbiAgICAgICAgICAgIHx8IGF3YWl0IGJyb3dzZXIuZ2V0VlNDb2RlVmVyc2lvbigpID09PSAnaW5zaWRlcnMnXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBJbnB1dEJveCh0aGlzLmxvY2F0b3JNYXApLndhaXQoKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUXVpY2tPcGVuQm94KHRoaXMubG9jYXRvck1hcCkud2FpdCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3BlbiB0aGUgY29tbWFuZCBwcm9tcHQsIHR5cGUgaW4gYSBjb21tYW5kLCBmaW5kIHRoZSBjb21tYW5kIHVzaW5nIGEgZnV6enkgbWF0Y2gsIGFuZCBleGVjdXRlXG4gICAgICogQHBhcmFtIGNvbW1hbmQgdGV4dCBvZiB0aGUgY29tbWFuZCB0byBiZSBleGVjdXRlZFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIElucHV0Qm94ICh2c2NvZGUgMS40NCspIG9yIFF1aWNrT3BlbkJveCAodnNjb2RlIHVwIHRvIDEuNDMpIG9iamVjdFxuICAgICAqIHdoZW4gdGhlIGNvbW1hbmQgcHJvbXB0IGlzIGNvbmZpcm1lZFxuICAgICAqL1xuICAgIGFzeW5jIGV4ZWN1dGVDb21tYW5kIChjb21tYW5kOiBzdHJpbmcpOiBQcm9taXNlPElucHV0Qm94IHwgUXVpY2tPcGVuQm94PiB7XG4gICAgICAgIGNvbnN0IHByb21wdCA9IGF3YWl0IHRoaXMub3BlbkNvbW1hbmRQcm9tcHQoKVxuICAgICAgICBhd2FpdCBwcm9tcHQuc2V0VGV4dChgPiR7Y29tbWFuZH1gKVxuICAgICAgICBhd2FpdCBwcm9tcHQuY29uZmlybSgpXG5cbiAgICAgICAgcmV0dXJuIHByb21wdFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZW4gdGhlIGNvbW1hbmQgcHJvbXB0LCB0eXBlIGluIGEgY29tbWFuZCwgZmluZCB0aGUgY29tbWFuZCBmcm9tIHRoZSBxdWljayBwaWNrIGxpc3QsIGFuZCBleGVjdXRlXG4gICAgICogQHBhcmFtIGNvbW1hbmQgdGV4dCBvZiB0aGUgY29tbWFuZCB0byBiZSBleGVjdXRlZFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIElucHV0Qm94ICh2c2NvZGUgMS40NCspIG9yIFF1aWNrT3BlbkJveCAodnNjb2RlIHVwIHRvIDEuNDMpIG9iamVjdFxuICAgICAqIHdoZW4gdGhlIGNvbW1hbmQgcHJvbXB0IGlzIGNvbmZpcm1lZFxuICAgICAqL1xuICAgIGFzeW5jIGV4ZWN1dGVRdWlja1BpY2sgKGNvbW1hbmQ6IHN0cmluZyk6IFByb21pc2U8SW5wdXRCb3ggfCBRdWlja09wZW5Cb3g+IHtcbiAgICAgICAgY29uc3QgcHJvbXB0ID0gYXdhaXQgdGhpcy5vcGVuQ29tbWFuZFByb21wdCgpXG4gICAgICAgIGF3YWl0IHByb21wdC5zZXRUZXh0KGA+JHtjb21tYW5kfWApXG4gICAgICAgIGNvbnN0IHF1aWNrUGlja3MgPSBhd2FpdCBwcm9tcHQuZ2V0UXVpY2tQaWNrcygpXG4gICAgICAgIGZvciAoY29uc3QgcXVpY2tQaWNrIG9mIHF1aWNrUGlja3MpIHtcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gYXdhaXQgcXVpY2tQaWNrLmdldExhYmVsKClcbiAgICAgICAgICAgIGlmIChsYWJlbCA9PT0gY29tbWFuZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHF1aWNrUGljay5zZWxlY3QoKVxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9tcHRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tbWFuZCBub3QgZm91bmQnKVxuICAgIH1cbn1cbiJdfQ==