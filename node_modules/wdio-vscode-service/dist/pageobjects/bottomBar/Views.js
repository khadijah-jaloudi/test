var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import clipboard from 'clipboardy';
import { Key } from 'webdriverio';
import { Workbench, BottomBarPanel, ContentAssist } from '../../index.js';
import { TextView, ChannelView } from './AbstractViews.js';
import { ElementWithContextMenu, PageDecorator, sleep } from '../utils.js';
import { OutputView as OutputViewLocators, DebugConsoleView as DebugConsoleViewLocators, TerminalView as TerminalViewLocators } from '../../locators/1.73.0.js';
/**
 * Output view of the bottom panel
 *
 * ```ts
 * const bottomBar = workbench.getBottomBar()
 * const outputView = await bottomBar.openOutputView()
 * console.log(await outputView.getChannelNames())
 * // returns
 * // [
 * //   'Tasks',
 * //   'Extensions',
 * //   'Microsoft Authentication',
 * //   'Git',
 * //   'GitHub Authentication',
 * //   'Log (Window)',
 * //   'Log (Main)',
 * //   'Log (Extension Host)',
 * //   'Log (Settings Sync)',
 * //   'Log (Shared)'
 * // ]
 * ```
 *
 * @category BottomBar
 */
export let OutputView = class OutputView extends TextView {
    constructor(locators, panel = new BottomBarPanel(locators)) {
        super(locators);
        this.panel = panel;
        /**
         * @private
         */
        this.locatorKey = 'OutputView';
        this.actionsLabel = locators.OutputView.actionsLabel;
        this.setParentElement(panel.elem);
    }
};
OutputView = __decorate([
    PageDecorator(OutputViewLocators)
], OutputView);
/**
 * Debug Console view on the bottom panel
 * Most functionality will only be available when a debug session is running
 *
 * @category BottomBar
 */
export let DebugConsoleView = class DebugConsoleView extends ElementWithContextMenu {
    constructor(locators, panel = new BottomBarPanel(locators)) {
        super(locators);
        this.panel = panel;
        /**
         * @private
         */
        this.locatorKey = 'DebugConsoleView';
        this.setParentElement(panel.elem);
    }
    /**
     * Get all text from the debug console
     */
    async getText() {
        const menu = await this.openContextMenu();
        await menu.select('Copy All');
        const text = await clipboard.read();
        await clipboard.write('');
        return text;
    }
    /**
     * Clear the console of all text
     */
    async clearText() {
        const menu = await this.openContextMenu();
        await menu.select('Clear Console');
    }
    /**
     * Type an expression into the debug console text area
     * @param expression expression in form of a string
     */
    async setExpression(expression) {
        const textarea = await this.elem.$(this.locatorMap.BottomBarViews.textArea);
        await textarea.setValue(expression);
    }
    /**
     * Evaluate an expression:
     *  - if no argument is supplied, evaluate the current expression present in debug console text area
     *  - if a string argument is supplied, replace the current expression with the `expression` argument and evaluate
     *
     * @param expression expression to evaluate. To use existing contents of the debug console
     *                   text area instead, don't define this argument
     */
    async evaluateExpression(expression) {
        if (expression) {
            await this.setExpression(expression);
        }
        await browser.keys('Enter');
    }
    /**
     * Create a content assist page object
     * @returns promise resolving to ContentAssist object
     */
    async getContentAssist() {
        return new ContentAssist(this.locatorMap, this).wait();
    }
};
DebugConsoleView = __decorate([
    PageDecorator(DebugConsoleViewLocators)
], DebugConsoleView);
/**
 * Terminal view on the bottom panel
 *
 * @category BottomBar
 */
export let TerminalView = class TerminalView extends ChannelView {
    constructor(locators, panel = new BottomBarPanel(locators)) {
        super(locators);
        this.panel = panel;
        /**
         * @private
         */
        this.locatorKey = 'TerminalView';
        this.actionsLabel = locators.OutputView.actionsLabel;
    }
    /**
     * Execute command in the internal terminal and wait for results
     * @param command text of the command
     * @param timeout optional maximum time to wait for completion in milliseconds, 0 for unlimited
     * @returns Promise resolving when the command is finished
     */
    async executeCommand(command, timeout = 0) {
        const input = await this.textArea$;
        try {
            await input.clearValue();
        }
        catch (err) {
            // try clearing, ignore if not available
        }
        await input.setValue(command);
        await browser.action('key').down(Key.Enter).up(Key.Enter).perform();
        let timer = 0;
        let style = await input.getCSSProperty('left');
        do {
            if (timeout > 0 && timer > timeout) {
                throw new Error(`Timeout of ${timeout}ms exceeded`);
            }
            await sleep(500);
            timer += 500;
            style = await input.getCSSProperty('left');
        } while (style.value === '0px');
    }
    /**
     * Get all text from the internal terminal
     * Beware, no formatting.
     * @returns Promise resolving to all terminal text
     */
    async getText(retry = 3) {
        const workbench = new Workbench(this.locatorMap);
        await workbench.executeCommand('terminal select all');
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(500);
        await browser.keys([Key.Ctrl, 'c']);
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(500);
        const text = await clipboard.read();
        if (!text && retry > 0) {
            return this.getText(retry - 1);
        }
        clipboard.writeSync('');
        return text.trim();
    }
    /**
     * Destroy the currently open terminal
     * @returns Promise resolving when Kill Terminal button is pressed
     */
    async killTerminal() {
        await new Workbench(this.locatorMap)
            .executeCommand('terminal: kill the active terminal instance');
    }
    /**
     * Initiate new terminal creation
     * @returns Promise resolving when New Terminal button is pressed
     */
    async newTerminal() {
        await new Workbench(this.locatorMap)
            .executeCommand(this.locators.newCommand);
        const combo = await this.panel.elem.$$(this.locatorMap.BottomBarViews.channelCombo);
        if (combo.length < 1) {
            await browser.waitUntil(async () => {
                const list = await this.tabList$$;
                return list.length > 0;
            }, { timeout: 5000 });
        }
    }
    async getCurrentChannel() {
        const combo = await this.panel.elem.$$(this.locatorMap.BottomBarViews.channelCombo);
        if (combo.length > 0) {
            return super.getCurrentChannel();
        }
        const singleTerm = await this.panel.elem.$$(this.locators.singleTab);
        if (singleTerm.length > 0) {
            return singleTerm[0].getText();
        }
        const list = await this.tabList$;
        const row = await list.$(this.locators.selectedRow);
        const label = (await row.getAttribute('aria-label')).split(' ');
        return `${label[1]}: ${label[2]}`;
    }
    async selectChannel(name) {
        const combo = await this.panel.elem.$$(this.locatorMap.BottomBarViews.channelCombo);
        if (combo.length > 0) {
            return super.selectChannel(name);
        }
        const singleTerm = await this.panel.elem.$$(this.locators.singleTab);
        if (singleTerm.length > 0) {
            return undefined;
        }
        const matches = name.match(/.*(\d+).?\s.*/);
        if (matches === null || !matches[1]) {
            throw new Error(`Channel ${name} not found`);
        }
        const channelNumber = matches[1];
        const list = await this.tabList$;
        const rows = await list.$$(this.locators.row);
        for (const row of rows) {
            const label = await row.getAttribute('aria-label');
            if (label.includes(channelNumber)) {
                await row.click();
                return undefined;
            }
        }
        throw new Error(`Channel ${name} not found`);
    }
};
TerminalView = __decorate([
    PageDecorator(TerminalViewLocators)
], TerminalView);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlld3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFnZW9iamVjdHMvYm90dG9tQmFyL1ZpZXdzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sYUFBYSxDQUFBO0FBRWpDLE9BQU8sRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQ3pFLE9BQU8sRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDMUQsT0FBTyxFQUNILHNCQUFzQixFQUFFLGFBQWEsRUFDckMsS0FBSyxFQUNSLE1BQU0sYUFBYSxDQUFBO0FBQ3BCLE9BQU8sRUFDSCxVQUFVLElBQUksa0JBQWtCLEVBQ2hDLGdCQUFnQixJQUFJLHdCQUF3QixFQUM1QyxZQUFZLElBQUksb0JBQW9CLEVBQ3ZDLE1BQU0sMEJBQTBCLENBQUE7QUFHakM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJHO0FBRUksV0FBTSxVQUFVLEdBQWhCLE1BQU0sVUFBVyxTQUFRLFFBQW1DO0lBTS9ELFlBQ0ksUUFBMEIsRUFDbkIsUUFBUSxJQUFJLGNBQWMsQ0FBQyxRQUFRLENBQUM7UUFFM0MsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBRlIsVUFBSyxHQUFMLEtBQUssQ0FBK0I7UUFQL0M7O1dBRUc7UUFDSSxlQUFVLEdBQUcsWUFBcUIsQ0FBQTtRQU9yQyxJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUMsWUFBc0IsQ0FBQTtRQUM5RCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ3JDLENBQUM7Q0FDSixDQUFBO0FBZFksVUFBVTtJQUR0QixhQUFhLENBQUMsa0JBQWtCLENBQUM7R0FDckIsVUFBVSxDQWN0QjtB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UUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ3BFLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdkIsT0FBTyxTQUFTLENBQUE7U0FDbkI7UUFFRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFBO1FBQzNDLElBQUksT0FBTyxLQUFLLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNqQyxNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsSUFBSSxZQUFZLENBQUMsQ0FBQTtTQUMvQztRQUNELE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUVoQyxNQUFNLElBQUksR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUE7UUFDaEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFN0MsS0FBSyxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUU7WUFDcEIsTUFBTSxLQUFLLEdBQUcsTUFBTSxHQUFHLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFBO1lBQ2xELElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsRUFBRTtnQkFDL0IsTUFBTSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUE7Z0JBQ2pCLE9BQU8sU0FBUyxDQUFBO2FBQ25CO1NBQ0o7UUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsSUFBSSxZQUFZLENBQUMsQ0FBQTtJQUNoRCxDQUFDO0NBQ0osQ0FBQTtBQXZJWSxZQUFZO0lBRHhCLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQztHQUN2QixZQUFZLENBdUl4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjbGlwYm9hcmQgZnJvbSAnY2xpcGJvYXJkeSdcbmltcG9ydCB7IEtleSB9IGZyb20gJ3dlYmRyaXZlcmlvJ1xuXG5pbXBvcnQgeyBXb3JrYmVuY2gsIEJvdHRvbUJhclBhbmVsLCBDb250ZW50QXNzaXN0IH0gZnJvbSAnLi4vLi4vaW5kZXguanMnXG5pbXBvcnQgeyBUZXh0VmlldywgQ2hhbm5lbFZpZXcgfSBmcm9tICcuL0Fic3RyYWN0Vmlld3MuanMnXG5pbXBvcnQge1xuICAgIEVsZW1lbnRXaXRoQ29udGV4dE1lbnUsIFBhZ2VEZWNvcmF0b3IsIElQYWdlRGVjb3JhdG9yLCBWU0NvZGVMb2NhdG9yTWFwLFxuICAgIHNsZWVwXG59IGZyb20gJy4uL3V0aWxzLmpzJ1xuaW1wb3J0IHtcbiAgICBPdXRwdXRWaWV3IGFzIE91dHB1dFZpZXdMb2NhdG9ycyxcbiAgICBEZWJ1Z0NvbnNvbGVWaWV3IGFzIERlYnVnQ29uc29sZVZpZXdMb2NhdG9ycyxcbiAgICBUZXJtaW5hbFZpZXcgYXMgVGVybWluYWxWaWV3TG9jYXRvcnNcbn0gZnJvbSAnLi4vLi4vbG9jYXRvcnMvMS43My4wLmpzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIE91dHB1dFZpZXcgZXh0ZW5kcyBJUGFnZURlY29yYXRvcjx0eXBlb2YgT3V0cHV0Vmlld0xvY2F0b3JzPiB7fVxuLyoqXG4gKiBPdXRwdXQgdmlldyBvZiB0aGUgYm90dG9tIHBhbmVsXG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IGJvdHRvbUJhciA9IHdvcmtiZW5jaC5nZXRCb3R0b21CYXIoKVxuICogY29uc3Qgb3V0cHV0VmlldyA9IGF3YWl0IGJvdHRvbUJhci5vcGVuT3V0cHV0VmlldygpXG4gKiBjb25zb2xlLmxvZyhhd2FpdCBvdXRwdXRWaWV3LmdldENoYW5uZWxOYW1lcygpKVxuICogLy8gcmV0dXJuc1xuICogLy8gW1xuICogLy8gICAnVGFza3MnLFxuICogLy8gICAnRXh0ZW5zaW9ucycsXG4gKiAvLyAgICdNaWNyb3NvZnQgQXV0aGVudGljYXRpb24nLFxuICogLy8gICAnR2l0JyxcbiAqIC8vICAgJ0dpdEh1YiBBdXRoZW50aWNhdGlvbicsXG4gKiAvLyAgICdMb2cgKFdpbmRvdyknLFxuICogLy8gICAnTG9nIChNYWluKScsXG4gKiAvLyAgICdMb2cgKEV4dGVuc2lvbiBIb3N0KScsXG4gKiAvLyAgICdMb2cgKFNldHRpbmdzIFN5bmMpJyxcbiAqIC8vICAgJ0xvZyAoU2hhcmVkKSdcbiAqIC8vIF1cbiAqIGBgYFxuICpcbiAqIEBjYXRlZ29yeSBCb3R0b21CYXJcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoT3V0cHV0Vmlld0xvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIE91dHB1dFZpZXcgZXh0ZW5kcyBUZXh0Vmlldzx0eXBlb2YgT3V0cHV0Vmlld0xvY2F0b3JzPiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9ICdPdXRwdXRWaWV3JyBhcyBjb25zdFxuXG4gICAgY29uc3RydWN0b3IgKFxuICAgICAgICBsb2NhdG9yczogVlNDb2RlTG9jYXRvck1hcCxcbiAgICAgICAgcHVibGljIHBhbmVsID0gbmV3IEJvdHRvbUJhclBhbmVsKGxvY2F0b3JzKVxuICAgICkge1xuICAgICAgICBzdXBlcihsb2NhdG9ycylcbiAgICAgICAgdGhpcy5hY3Rpb25zTGFiZWwgPSBsb2NhdG9ycy5PdXRwdXRWaWV3LmFjdGlvbnNMYWJlbCBhcyBzdHJpbmdcbiAgICAgICAgdGhpcy5zZXRQYXJlbnRFbGVtZW50KHBhbmVsLmVsZW0pXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIERlYnVnQ29uc29sZVZpZXcgZXh0ZW5kcyBJUGFnZURlY29yYXRvcjx0eXBlb2YgRGVidWdDb25zb2xlVmlld0xvY2F0b3JzPiB7fVxuLyoqXG4gKiBEZWJ1ZyBDb25zb2xlIHZpZXcgb24gdGhlIGJvdHRvbSBwYW5lbFxuICogTW9zdCBmdW5jdGlvbmFsaXR5IHdpbGwgb25seSBiZSBhdmFpbGFibGUgd2hlbiBhIGRlYnVnIHNlc3Npb24gaXMgcnVubmluZ1xuICpcbiAqIEBjYXRlZ29yeSBCb3R0b21CYXJcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoRGVidWdDb25zb2xlVmlld0xvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIERlYnVnQ29uc29sZVZpZXcgZXh0ZW5kcyBFbGVtZW50V2l0aENvbnRleHRNZW51PHR5cGVvZiBEZWJ1Z0NvbnNvbGVWaWV3TG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ0RlYnVnQ29uc29sZVZpZXcnIGFzIGNvbnN0XG5cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIGxvY2F0b3JzOiBWU0NvZGVMb2NhdG9yTWFwLFxuICAgICAgICBwdWJsaWMgcGFuZWw6IEJvdHRvbUJhclBhbmVsID0gbmV3IEJvdHRvbUJhclBhbmVsKGxvY2F0b3JzKVxuICAgICkge1xuICAgICAgICBzdXBlcihsb2NhdG9ycylcbiAgICAgICAgdGhpcy5zZXRQYXJlbnRFbGVtZW50KHBhbmVsLmVsZW0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGFsbCB0ZXh0IGZyb20gdGhlIGRlYnVnIGNvbnNvbGVcbiAgICAgKi9cbiAgICBhc3luYyBnZXRUZXh0ICgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICBjb25zdCBtZW51ID0gYXdhaXQgdGhpcy5vcGVuQ29udGV4dE1lbnUoKVxuICAgICAgICBhd2FpdCBtZW51LnNlbGVjdCgnQ29weSBBbGwnKVxuICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgY2xpcGJvYXJkLnJlYWQoKVxuICAgICAgICBhd2FpdCBjbGlwYm9hcmQud3JpdGUoJycpXG4gICAgICAgIHJldHVybiB0ZXh0XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGhlIGNvbnNvbGUgb2YgYWxsIHRleHRcbiAgICAgKi9cbiAgICBhc3luYyBjbGVhclRleHQgKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBtZW51ID0gYXdhaXQgdGhpcy5vcGVuQ29udGV4dE1lbnUoKVxuICAgICAgICBhd2FpdCBtZW51LnNlbGVjdCgnQ2xlYXIgQ29uc29sZScpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHlwZSBhbiBleHByZXNzaW9uIGludG8gdGhlIGRlYnVnIGNvbnNvbGUgdGV4dCBhcmVhXG4gICAgICogQHBhcmFtIGV4cHJlc3Npb24gZXhwcmVzc2lvbiBpbiBmb3JtIG9mIGEgc3RyaW5nXG4gICAgICovXG4gICAgYXN5bmMgc2V0RXhwcmVzc2lvbiAoZXhwcmVzc2lvbjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHRleHRhcmVhID0gYXdhaXQgdGhpcy5lbGVtLiQodGhpcy5sb2NhdG9yTWFwLkJvdHRvbUJhclZpZXdzLnRleHRBcmVhIGFzIHN0cmluZylcbiAgICAgICAgYXdhaXQgdGV4dGFyZWEuc2V0VmFsdWUoZXhwcmVzc2lvbilcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFdmFsdWF0ZSBhbiBleHByZXNzaW9uOlxuICAgICAqICAtIGlmIG5vIGFyZ3VtZW50IGlzIHN1cHBsaWVkLCBldmFsdWF0ZSB0aGUgY3VycmVudCBleHByZXNzaW9uIHByZXNlbnQgaW4gZGVidWcgY29uc29sZSB0ZXh0IGFyZWFcbiAgICAgKiAgLSBpZiBhIHN0cmluZyBhcmd1bWVudCBpcyBzdXBwbGllZCwgcmVwbGFjZSB0aGUgY3VycmVudCBleHByZXNzaW9uIHdpdGggdGhlIGBleHByZXNzaW9uYCBhcmd1bWVudCBhbmQgZXZhbHVhdGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBleHByZXNzaW9uIGV4cHJlc3Npb24gdG8gZXZhbHVhdGUuIFRvIHVzZSBleGlzdGluZyBjb250ZW50cyBvZiB0aGUgZGVidWcgY29uc29sZVxuICAgICAqICAgICAgICAgICAgICAgICAgIHRleHQgYXJlYSBpbnN0ZWFkLCBkb24ndCBkZWZpbmUgdGhpcyBhcmd1bWVudFxuICAgICAqL1xuICAgIGFzeW5jIGV2YWx1YXRlRXhwcmVzc2lvbiAoZXhwcmVzc2lvbj86IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoZXhwcmVzc2lvbikge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zZXRFeHByZXNzaW9uKGV4cHJlc3Npb24pXG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgYnJvd3Nlci5rZXlzKCdFbnRlcicpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgY29udGVudCBhc3Npc3QgcGFnZSBvYmplY3RcbiAgICAgKiBAcmV0dXJucyBwcm9taXNlIHJlc29sdmluZyB0byBDb250ZW50QXNzaXN0IG9iamVjdFxuICAgICAqL1xuICAgIGFzeW5jIGdldENvbnRlbnRBc3Npc3QgKCk6IFByb21pc2U8Q29udGVudEFzc2lzdD4ge1xuICAgICAgICByZXR1cm4gbmV3IENvbnRlbnRBc3Npc3QodGhpcy5sb2NhdG9yTWFwLCB0aGlzKS53YWl0KClcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGVybWluYWxWaWV3IGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFRlcm1pbmFsVmlld0xvY2F0b3JzPiB7fVxuLyoqXG4gKiBUZXJtaW5hbCB2aWV3IG9uIHRoZSBib3R0b20gcGFuZWxcbiAqXG4gKiBAY2F0ZWdvcnkgQm90dG9tQmFyXG4gKi9cbkBQYWdlRGVjb3JhdG9yKFRlcm1pbmFsVmlld0xvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIFRlcm1pbmFsVmlldyBleHRlbmRzIENoYW5uZWxWaWV3PHR5cGVvZiBUZXJtaW5hbFZpZXdMb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHVibGljIGxvY2F0b3JLZXkgPSAnVGVybWluYWxWaWV3JyBhcyBjb25zdFxuXG4gICAgY29uc3RydWN0b3IgKFxuICAgICAgICBsb2NhdG9yczogVlNDb2RlTG9jYXRvck1hcCxcbiAgICAgICAgcHVibGljIHBhbmVsID0gbmV3IEJvdHRvbUJhclBhbmVsKGxvY2F0b3JzKVxuICAgICkge1xuICAgICAgICBzdXBlcihsb2NhdG9ycylcbiAgICAgICAgdGhpcy5hY3Rpb25zTGFiZWwgPSBsb2NhdG9ycy5PdXRwdXRWaWV3LmFjdGlvbnNMYWJlbCBhcyBzdHJpbmdcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlIGNvbW1hbmQgaW4gdGhlIGludGVybmFsIHRlcm1pbmFsIGFuZCB3YWl0IGZvciByZXN1bHRzXG4gICAgICogQHBhcmFtIGNvbW1hbmQgdGV4dCBvZiB0aGUgY29tbWFuZFxuICAgICAqIEBwYXJhbSB0aW1lb3V0IG9wdGlvbmFsIG1heGltdW0gdGltZSB0byB3YWl0IGZvciBjb21wbGV0aW9uIGluIG1pbGxpc2Vjb25kcywgMCBmb3IgdW5saW1pdGVkXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgd2hlbiB0aGUgY29tbWFuZCBpcyBmaW5pc2hlZFxuICAgICAqL1xuICAgIGFzeW5jIGV4ZWN1dGVDb21tYW5kIChjb21tYW5kOiBzdHJpbmcsIHRpbWVvdXQgPSAwKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gYXdhaXQgdGhpcy50ZXh0QXJlYSRcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgaW5wdXQuY2xlYXJWYWx1ZSgpXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgLy8gdHJ5IGNsZWFyaW5nLCBpZ25vcmUgaWYgbm90IGF2YWlsYWJsZVxuICAgICAgICB9XG4gICAgICAgIGF3YWl0IGlucHV0LnNldFZhbHVlKGNvbW1hbmQpXG4gICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKS5kb3duKEtleS5FbnRlcikudXAoS2V5LkVudGVyKS5wZXJmb3JtKClcblxuICAgICAgICBsZXQgdGltZXIgPSAwXG4gICAgICAgIGxldCBzdHlsZSA9IGF3YWl0IGlucHV0LmdldENTU1Byb3BlcnR5KCdsZWZ0JylcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgaWYgKHRpbWVvdXQgPiAwICYmIHRpbWVyID4gdGltZW91dCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGltZW91dCBvZiAke3RpbWVvdXR9bXMgZXhjZWVkZWRgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgc2xlZXAoNTAwKVxuICAgICAgICAgICAgdGltZXIgKz0gNTAwXG4gICAgICAgICAgICBzdHlsZSA9IGF3YWl0IGlucHV0LmdldENTU1Byb3BlcnR5KCdsZWZ0JylcbiAgICAgICAgfSB3aGlsZSAoc3R5bGUudmFsdWUgPT09ICcwcHgnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgdGV4dCBmcm9tIHRoZSBpbnRlcm5hbCB0ZXJtaW5hbFxuICAgICAqIEJld2FyZSwgbm8gZm9ybWF0dGluZy5cbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBhbGwgdGVybWluYWwgdGV4dFxuICAgICAqL1xuICAgIGFzeW5jIGdldFRleHQgKHJldHJ5ID0gMyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHdvcmtiZW5jaCA9IG5ldyBXb3JrYmVuY2godGhpcy5sb2NhdG9yTWFwKVxuICAgICAgICBhd2FpdCB3b3JrYmVuY2guZXhlY3V0ZUNvbW1hbmQoJ3Rlcm1pbmFsIHNlbGVjdCBhbGwnKVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgd2Rpby9uby1wYXVzZVxuICAgICAgICBhd2FpdCBicm93c2VyLnBhdXNlKDUwMClcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5rZXlzKFtLZXkuQ3RybCwgJ2MnXSlcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHdkaW8vbm8tcGF1c2VcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5wYXVzZSg1MDApXG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCBjbGlwYm9hcmQucmVhZCgpXG5cbiAgICAgICAgaWYgKCF0ZXh0ICYmIHJldHJ5ID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VGV4dChyZXRyeSAtIDEpXG4gICAgICAgIH1cblxuICAgICAgICBjbGlwYm9hcmQud3JpdGVTeW5jKCcnKVxuICAgICAgICByZXR1cm4gdGV4dC50cmltKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95IHRoZSBjdXJyZW50bHkgb3BlbiB0ZXJtaW5hbFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gS2lsbCBUZXJtaW5hbCBidXR0b24gaXMgcHJlc3NlZFxuICAgICAqL1xuICAgIGFzeW5jIGtpbGxUZXJtaW5hbCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IG5ldyBXb3JrYmVuY2godGhpcy5sb2NhdG9yTWFwKVxuICAgICAgICAgICAgLmV4ZWN1dGVDb21tYW5kKCd0ZXJtaW5hbDoga2lsbCB0aGUgYWN0aXZlIHRlcm1pbmFsIGluc3RhbmNlJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWF0ZSBuZXcgdGVybWluYWwgY3JlYXRpb25cbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB3aGVuIE5ldyBUZXJtaW5hbCBidXR0b24gaXMgcHJlc3NlZFxuICAgICAqL1xuICAgIGFzeW5jIG5ld1Rlcm1pbmFsICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgbmV3IFdvcmtiZW5jaCh0aGlzLmxvY2F0b3JNYXApXG4gICAgICAgICAgICAuZXhlY3V0ZUNvbW1hbmQodGhpcy5sb2NhdG9ycy5uZXdDb21tYW5kKVxuICAgICAgICBjb25zdCBjb21ibyA9IGF3YWl0IHRoaXMucGFuZWwuZWxlbS4kJCh0aGlzLmxvY2F0b3JNYXAuQm90dG9tQmFyVmlld3MuY2hhbm5lbENvbWJvIGFzIHN0cmluZylcbiAgICAgICAgaWYgKGNvbWJvLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIud2FpdFVudGlsKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBsaXN0ID0gYXdhaXQgdGhpcy50YWJMaXN0JCRcbiAgICAgICAgICAgICAgICByZXR1cm4gbGlzdC5sZW5ndGggPiAwXG4gICAgICAgICAgICB9LCB7IHRpbWVvdXQ6IDUwMDAgfSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldEN1cnJlbnRDaGFubmVsICgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICBjb25zdCBjb21ibyA9IGF3YWl0IHRoaXMucGFuZWwuZWxlbS4kJCh0aGlzLmxvY2F0b3JNYXAuQm90dG9tQmFyVmlld3MuY2hhbm5lbENvbWJvIGFzIHN0cmluZylcbiAgICAgICAgaWYgKGNvbWJvLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBzdXBlci5nZXRDdXJyZW50Q2hhbm5lbCgpXG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2luZ2xlVGVybSA9IGF3YWl0IHRoaXMucGFuZWwuZWxlbS4kJCh0aGlzLmxvY2F0b3JzLnNpbmdsZVRhYilcbiAgICAgICAgaWYgKHNpbmdsZVRlcm0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHNpbmdsZVRlcm1bMF0uZ2V0VGV4dCgpXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGlzdCA9IGF3YWl0IHRoaXMudGFiTGlzdCRcbiAgICAgICAgY29uc3Qgcm93ID0gYXdhaXQgbGlzdC4kKHRoaXMubG9jYXRvcnMuc2VsZWN0ZWRSb3cpXG4gICAgICAgIGNvbnN0IGxhYmVsID0gKGF3YWl0IHJvdy5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKSkuc3BsaXQoJyAnKVxuXG4gICAgICAgIHJldHVybiBgJHtsYWJlbFsxXX06ICR7bGFiZWxbMl19YFxuICAgIH1cblxuICAgIGFzeW5jIHNlbGVjdENoYW5uZWwgKG5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBjb21ibyA9IGF3YWl0IHRoaXMucGFuZWwuZWxlbS4kJCh0aGlzLmxvY2F0b3JNYXAuQm90dG9tQmFyVmlld3MuY2hhbm5lbENvbWJvIGFzIHN0cmluZylcbiAgICAgICAgaWYgKGNvbWJvLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBzdXBlci5zZWxlY3RDaGFubmVsKG5hbWUpXG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2luZ2xlVGVybSA9IGF3YWl0IHRoaXMucGFuZWwuZWxlbS4kJCh0aGlzLmxvY2F0b3JzLnNpbmdsZVRhYilcbiAgICAgICAgaWYgKHNpbmdsZVRlcm0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IG5hbWUubWF0Y2goLy4qKFxcZCspLj9cXHMuKi8pXG4gICAgICAgIGlmIChtYXRjaGVzID09PSBudWxsIHx8ICFtYXRjaGVzWzFdKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENoYW5uZWwgJHtuYW1lfSBub3QgZm91bmRgKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoYW5uZWxOdW1iZXIgPSBtYXRjaGVzWzFdXG5cbiAgICAgICAgY29uc3QgbGlzdCA9IGF3YWl0IHRoaXMudGFiTGlzdCRcbiAgICAgICAgY29uc3Qgcm93cyA9IGF3YWl0IGxpc3QuJCQodGhpcy5sb2NhdG9ycy5yb3cpXG5cbiAgICAgICAgZm9yIChjb25zdCByb3cgb2Ygcm93cykge1xuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBhd2FpdCByb3cuZ2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJylcbiAgICAgICAgICAgIGlmIChsYWJlbC5pbmNsdWRlcyhjaGFubmVsTnVtYmVyKSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHJvdy5jbGljaygpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2hhbm5lbCAke25hbWV9IG5vdCBmb3VuZGApXG4gICAgfVxufVxuIl19