var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { PageDecorator, sleep } from '../utils.js';
import { WindowControls, ContextMenu } from '../index.js';
import { Menu } from './Menu.js';
import { MenuItem } from './MenuItem.js';
import { TitleBar as TitleBarLocators } from '../../locators/1.73.0.js';
/**
 * Page object representing the custom VSCode title bar
 *
 * @category Menu
 */
export let TitleBar = class TitleBar extends Menu {
    constructor() {
        super(...arguments);
        /**
         * @private
         */
        this.locatorKey = 'TitleBar';
    }
    /**
     * Get title bar item by name
     * @param name name of the item to search by
     * @returns Promise resolving to TitleBarItem object
     */
    async getItem(name) {
        const all = await this.getItems();
        for (const item of all) {
            if (item.label === name) {
                return item;
            }
        }
        return undefined;
    }
    /**
     * Get all title bar items
     * @returns Promise resolving to array of TitleBarItem objects
     */
    async getItems() {
        // can't search in this. because in web version the overflow menu is in activity bar
        const menubar = await browser.$(this.locators.menubar);
        if (!(await menubar.isExisting())) {
            throw new Error('Menubar not found in TitleBar, this probably means you are using "native" Title Bar Style. '
                + 'Title Items can only be found when using "custom" style.');
        }
        const items = [];
        for (const element of await menubar.$$(this.locators.itemElement)) {
            const isDisplayed = await element.isDisplayed();
            if (!isDisplayed) {
                continue;
            }
            const label = await element.getAttribute(this.locators.itemLabel);
            if (label === 'More' // electron
                || label === 'Application Menu' // web
            ) {
                await element.click();
                const overflow = await new ContextMenu(this.locatorMap).wait();
                for (const overflowItem of await overflow.getItems()) {
                    const item = new TitleBarItem(this.locatorMap, this.locators.overflowItemConstructor, async (self) => {
                        await element.click(); // make sure the overflow menu is open
                        await self.elem.click();
                    }, await overflowItem.getLabel(), this);
                    await item.wait();
                    items.push(item);
                }
                await browser.keys('Escape');
            }
            else {
                const item = new TitleBarItem(this.locatorMap, this.locators.topLevelItemConstructor, async (self) => {
                    await self.elem.click();
                }, label, this);
                await item.wait();
                items.push(item);
            }
        }
        return items;
    }
    /**
     * Get the window title
     * @returns Promise resolving to the window title
     */
    async getTitle() {
        const title = await this.title$.getText();
        /**
         * when testing VSCode on the web the element is not
         * visible and the text will be "", therefor we need
         * to fetch the HTML
         */
        if (title.length === 0) {
            return this.title$.getHTML(false);
        }
        return title;
    }
    /**
     * Get a reference to the WindowControls
     */
    getWindowControls() {
        return new WindowControls(this.locatorMap, this.elem);
    }
};
TitleBar = __decorate([
    PageDecorator(TitleBarLocators)
], TitleBar);
/**
 * Page object representing an item of the custom VSCode title bar
 *
 * @category Menu
 */
export let TitleBarItem = class TitleBarItem extends MenuItem {
    constructor(locators, ctor, openMenu, label, parentMenu) {
        super(locators, ctor(label));
        this.openMenu = openMenu;
        this.label = label;
        this.parentMenu = parentMenu;
        /**
         * @private
         */
        this.locatorKey = 'TitleBar';
    }
    async select() {
        const openMenus = await browser.$$(this.locatorMap.ContextMenu.elem);
        if (openMenus.length > 0 && await openMenus[0].isDisplayed()) {
            await browser.keys('Escape');
        }
        await this.openMenu(this);
        await sleep(500);
        const menu = new ContextMenu(this.locatorMap, this.elem);
        await menu.wait();
        return menu;
    }
};
TitleBarItem = __decorate([
    PageDecorator(TitleBarLocators)
], TitleBarItem);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGl0bGVCYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFnZW9iamVjdHMvbWVudS9UaXRsZUJhci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQ0gsYUFBYSxFQUFvQyxLQUFLLEVBQ3pELE1BQU0sYUFBYSxDQUFBO0FBQ3BCLE9BQU8sRUFBRSxjQUFjLEVBQUUsV0FBVyxFQUFFLE1BQU0sYUFBYSxDQUFBO0FBQ3pELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDaEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUN4QyxPQUFPLEVBQUUsUUFBUSxJQUFJLGdCQUFnQixFQUFFLE1BQU0sMEJBQTBCLENBQUE7QUFHdkU7Ozs7R0FJRztBQUVJLFdBQU0sUUFBUSxHQUFkLE1BQU0sUUFBUyxTQUFRLElBQTZCO0lBQXBEOztRQUNIOztXQUVHO1FBQ0ksZUFBVSxHQUFHLFVBQW1CLENBQUE7SUFxRzNDLENBQUM7SUFuR0c7Ozs7T0FJRztJQUNILEtBQUssQ0FBQyxPQUFPLENBQUUsSUFBWTtRQUN2QixNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUNqQyxLQUFLLE1BQU0sSUFBSSxJQUFJLEdBQUcsRUFBRTtZQUNwQixJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssSUFBSSxFQUFFO2dCQUNyQixPQUFPLElBQUksQ0FBQTthQUNkO1NBQ0o7UUFDRCxPQUFPLFNBQVMsQ0FBQTtJQUNwQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLFFBQVE7UUFDVixvRkFBb0Y7UUFDcEYsTUFBTSxPQUFPLEdBQUcsTUFBTSxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDdEQsSUFBSSxDQUFDLENBQUMsTUFBTSxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsRUFB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U0FBUSxRQUFpQztJQU0vRCxZQUNJLFFBQTBCLEVBQzFCLElBQWMsRUFDTixRQUErQyxFQUNoRCxLQUFhLEVBQ2IsVUFBeUM7UUFFaEQsS0FBSyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFXLENBQUMsQ0FBQTtRQUo5QixhQUFRLEdBQVIsUUFBUSxDQUF1QztRQUNoRCxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQ2IsZUFBVSxHQUFWLFVBQVUsQ0FBK0I7UUFWcEQ7O1dBRUc7UUFDSSxlQUFVLEdBQUcsVUFBbUIsQ0FBQTtJQVV2QyxDQUFDO0lBRUQsS0FBSyxDQUFDLE1BQU07UUFDUixNQUFNLFNBQVMsR0FBRyxNQUFNLE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBYyxDQUFDLENBQUE7UUFDOUUsSUFBSSxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxNQUFNLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsRUFBRTtZQUMxRCxNQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7U0FDL0I7UUFDRCxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDekIsTUFBTSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFaEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDeEQsTUFBTSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDakIsT0FBTyxJQUFJLENBQUE7SUFDZixDQUFDO0NBQ0osQ0FBQTtBQTVCWSxZQUFZO0lBRHhCLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQztHQUNuQixZQUFZLENBNEJ4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgUGFnZURlY29yYXRvciwgSVBhZ2VEZWNvcmF0b3IsIFZTQ29kZUxvY2F0b3JNYXAsIHNsZWVwXG59IGZyb20gJy4uL3V0aWxzLmpzJ1xuaW1wb3J0IHsgV2luZG93Q29udHJvbHMsIENvbnRleHRNZW51IH0gZnJvbSAnLi4vaW5kZXguanMnXG5pbXBvcnQgeyBNZW51IH0gZnJvbSAnLi9NZW51LmpzJ1xuaW1wb3J0IHsgTWVudUl0ZW0gfSBmcm9tICcuL01lbnVJdGVtLmpzJ1xuaW1wb3J0IHsgVGl0bGVCYXIgYXMgVGl0bGVCYXJMb2NhdG9ycyB9IGZyb20gJy4uLy4uL2xvY2F0b3JzLzEuNzMuMC5qcydcblxuZXhwb3J0IGludGVyZmFjZSBUaXRsZUJhciBleHRlbmRzIElQYWdlRGVjb3JhdG9yPHR5cGVvZiBUaXRsZUJhckxvY2F0b3JzPiB7fVxuLyoqXG4gKiBQYWdlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGN1c3RvbSBWU0NvZGUgdGl0bGUgYmFyXG4gKlxuICogQGNhdGVnb3J5IE1lbnVcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoVGl0bGVCYXJMb2NhdG9ycylcbmV4cG9ydCBjbGFzcyBUaXRsZUJhciBleHRlbmRzIE1lbnU8dHlwZW9mIFRpdGxlQmFyTG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ1RpdGxlQmFyJyBhcyBjb25zdFxuXG4gICAgLyoqXG4gICAgICogR2V0IHRpdGxlIGJhciBpdGVtIGJ5IG5hbWVcbiAgICAgKiBAcGFyYW0gbmFtZSBuYW1lIG9mIHRoZSBpdGVtIHRvIHNlYXJjaCBieVxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIFRpdGxlQmFySXRlbSBvYmplY3RcbiAgICAgKi9cbiAgICBhc3luYyBnZXRJdGVtIChuYW1lOiBzdHJpbmcpOiBQcm9taXNlPFRpdGxlQmFySXRlbSB8IHVuZGVmaW5lZD4ge1xuICAgICAgICBjb25zdCBhbGwgPSBhd2FpdCB0aGlzLmdldEl0ZW1zKClcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGFsbCkge1xuICAgICAgICAgICAgaWYgKGl0ZW0ubGFiZWwgPT09IG5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRpdGxlIGJhciBpdGVtc1xuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIGFycmF5IG9mIFRpdGxlQmFySXRlbSBvYmplY3RzXG4gICAgICovXG4gICAgYXN5bmMgZ2V0SXRlbXMgKCk6IFByb21pc2U8VGl0bGVCYXJJdGVtW10+IHtcbiAgICAgICAgLy8gY2FuJ3Qgc2VhcmNoIGluIHRoaXMuIGJlY2F1c2UgaW4gd2ViIHZlcnNpb24gdGhlIG92ZXJmbG93IG1lbnUgaXMgaW4gYWN0aXZpdHkgYmFyXG4gICAgICAgIGNvbnN0IG1lbnViYXIgPSBhd2FpdCBicm93c2VyLiQodGhpcy5sb2NhdG9ycy5tZW51YmFyKVxuICAgICAgICBpZiAoIShhd2FpdCBtZW51YmFyLmlzRXhpc3RpbmcoKSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICAnTWVudWJhciBub3QgZm91bmQgaW4gVGl0bGVCYXIsIHRoaXMgcHJvYmFibHkgbWVhbnMgeW91IGFyZSB1c2luZyBcIm5hdGl2ZVwiIFRpdGxlIEJhciBTdHlsZS4gJ1xuICAgICAgICAgICAgICAgICsgJ1RpdGxlIEl0ZW1zIGNhbiBvbmx5IGJlIGZvdW5kIHdoZW4gdXNpbmcgXCJjdXN0b21cIiBzdHlsZS4nXG4gICAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBpdGVtczogVGl0bGVCYXJJdGVtW10gPSBbXVxuICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYXdhaXQgbWVudWJhci4kJCh0aGlzLmxvY2F0b3JzLml0ZW1FbGVtZW50KSkge1xuICAgICAgICAgICAgY29uc3QgaXNEaXNwbGF5ZWQgPSBhd2FpdCBlbGVtZW50LmlzRGlzcGxheWVkKClcbiAgICAgICAgICAgIGlmICghaXNEaXNwbGF5ZWQpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBhd2FpdCBlbGVtZW50LmdldEF0dHJpYnV0ZSh0aGlzLmxvY2F0b3JzLml0ZW1MYWJlbClcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBsYWJlbCA9PT0gJ01vcmUnIC8vIGVsZWN0cm9uXG4gICAgICAgICAgICAgICAgfHwgbGFiZWwgPT09ICdBcHBsaWNhdGlvbiBNZW51JyAvLyB3ZWJcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGVsZW1lbnQuY2xpY2soKVxuICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJmbG93ID0gYXdhaXQgbmV3IENvbnRleHRNZW51KHRoaXMubG9jYXRvck1hcCkud2FpdCgpXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBvdmVyZmxvd0l0ZW0gb2YgYXdhaXQgb3ZlcmZsb3cuZ2V0SXRlbXMoKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gbmV3IFRpdGxlQmFySXRlbShcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYXRvck1hcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmxvY2F0b3JzLm92ZXJmbG93SXRlbUNvbnN0cnVjdG9yIGFzIEZ1bmN0aW9uKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jIChzZWxmKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgZWxlbWVudC5jbGljaygpIC8vIG1ha2Ugc3VyZSB0aGUgb3ZlcmZsb3cgbWVudSBpcyBvcGVuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5lbGVtLmNsaWNrKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBvdmVyZmxvd0l0ZW0uZ2V0TGFiZWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBpdGVtLndhaXQoKVxuICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGl0ZW0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIua2V5cygnRXNjYXBlJylcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IG5ldyBUaXRsZUJhckl0ZW0oXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYXRvck1hcCxcbiAgICAgICAgICAgICAgICAgICAgKHRoaXMubG9jYXRvcnMudG9wTGV2ZWxJdGVtQ29uc3RydWN0b3IgYXMgRnVuY3Rpb24pLFxuICAgICAgICAgICAgICAgICAgICBhc3luYyAoc2VsZikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5lbGVtLmNsaWNrKClcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWwsXG4gICAgICAgICAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgYXdhaXQgaXRlbS53YWl0KClcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGl0ZW0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGl0ZW1zXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB3aW5kb3cgdGl0bGVcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byB0aGUgd2luZG93IHRpdGxlXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VGl0bGUgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IHRpdGxlID0gYXdhaXQgdGhpcy50aXRsZSQuZ2V0VGV4dCgpXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIHdoZW4gdGVzdGluZyBWU0NvZGUgb24gdGhlIHdlYiB0aGUgZWxlbWVudCBpcyBub3RcbiAgICAgICAgICogdmlzaWJsZSBhbmQgdGhlIHRleHQgd2lsbCBiZSBcIlwiLCB0aGVyZWZvciB3ZSBuZWVkXG4gICAgICAgICAqIHRvIGZldGNoIHRoZSBIVE1MXG4gICAgICAgICAqL1xuICAgICAgICBpZiAodGl0bGUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50aXRsZSQuZ2V0SFRNTChmYWxzZSlcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aXRsZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIHJlZmVyZW5jZSB0byB0aGUgV2luZG93Q29udHJvbHNcbiAgICAgKi9cbiAgICBnZXRXaW5kb3dDb250cm9scyAoKTogV2luZG93Q29udHJvbHMge1xuICAgICAgICByZXR1cm4gbmV3IFdpbmRvd0NvbnRyb2xzKHRoaXMubG9jYXRvck1hcCwgdGhpcy5lbGVtKVxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBUaXRsZUJhckl0ZW0gZXh0ZW5kcyBJUGFnZURlY29yYXRvcjx0eXBlb2YgVGl0bGVCYXJMb2NhdG9ycz4ge31cbi8qKlxuICogUGFnZSBvYmplY3QgcmVwcmVzZW50aW5nIGFuIGl0ZW0gb2YgdGhlIGN1c3RvbSBWU0NvZGUgdGl0bGUgYmFyXG4gKlxuICogQGNhdGVnb3J5IE1lbnVcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoVGl0bGVCYXJMb2NhdG9ycylcbmV4cG9ydCBjbGFzcyBUaXRsZUJhckl0ZW0gZXh0ZW5kcyBNZW51SXRlbTx0eXBlb2YgVGl0bGVCYXJMb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHVibGljIGxvY2F0b3JLZXkgPSAnVGl0bGVCYXInIGFzIGNvbnN0XG5cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIGxvY2F0b3JzOiBWU0NvZGVMb2NhdG9yTWFwLFxuICAgICAgICBjdG9yOiBGdW5jdGlvbixcbiAgICAgICAgcHJpdmF0ZSBvcGVuTWVudTogKHNlbGY6IFRpdGxlQmFySXRlbSkgPT4gUHJvbWlzZTx2b2lkPixcbiAgICAgICAgcHVibGljIGxhYmVsOiBzdHJpbmcsXG4gICAgICAgIHB1YmxpYyBwYXJlbnRNZW51OiBNZW51PHR5cGVvZiBUaXRsZUJhckxvY2F0b3JzPlxuICAgICkge1xuICAgICAgICBzdXBlcihsb2NhdG9ycywgY3RvcihsYWJlbCkgYXMgc3RyaW5nKVxuICAgIH1cblxuICAgIGFzeW5jIHNlbGVjdCAoKSB7XG4gICAgICAgIGNvbnN0IG9wZW5NZW51cyA9IGF3YWl0IGJyb3dzZXIuJCQodGhpcy5sb2NhdG9yTWFwLkNvbnRleHRNZW51LmVsZW0gYXMgc3RyaW5nKVxuICAgICAgICBpZiAob3Blbk1lbnVzLmxlbmd0aCA+IDAgJiYgYXdhaXQgb3Blbk1lbnVzWzBdLmlzRGlzcGxheWVkKCkpIHtcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIua2V5cygnRXNjYXBlJylcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLm9wZW5NZW51KHRoaXMpXG4gICAgICAgIGF3YWl0IHNsZWVwKDUwMClcblxuICAgICAgICBjb25zdCBtZW51ID0gbmV3IENvbnRleHRNZW51KHRoaXMubG9jYXRvck1hcCwgdGhpcy5lbGVtKVxuICAgICAgICBhd2FpdCBtZW51LndhaXQoKVxuICAgICAgICByZXR1cm4gbWVudVxuICAgIH1cbn1cbiJdfQ==