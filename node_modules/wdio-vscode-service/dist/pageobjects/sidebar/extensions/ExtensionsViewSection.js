var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { Key } from 'webdriverio';
import { ViewSection } from '../ViewSection.js';
import { ExtensionsViewItem } from '../../index.js';
import { PageDecorator } from '../../utils.js';
import { ViewSection as ViewSectionLocators, ExtensionsViewSection as ExtensionsViewSectionLocators } from '../../../locators/1.73.0.js';
import { CMD_KEY } from '../../../constants.js';
/**
 * Categories of extensions to search for
 */
var ExtensionCategory;
(function (ExtensionCategory) {
    ExtensionCategory["Installed"] = "@installed";
    ExtensionCategory["Enabled"] = "@enabled";
    ExtensionCategory["Disabled"] = "@disabled";
    ExtensionCategory["Outdated"] = "@outdated";
    ExtensionCategory["Recommended"] = "@recommended";
})(ExtensionCategory || (ExtensionCategory = {}));
/**
 * View section containing extensions
 *
 * @category Sidebar
 */
export let ExtensionsViewSection = class ExtensionsViewSection extends ViewSection {
    constructor() {
        super(...arguments);
        /**
         * @private
         */
        this.locatorKey = ['ViewSection', 'ExtensionsViewSection'];
    }
    async getVisibleItems() {
        await this.items$.$(this.locators.itemRow).waitForExist({
            timeoutMsg: 'Could not find any extension items'
        });
        const extensionRows = await this.items$.$$(this.locators.itemRow);
        const extensionViewItems = [];
        for (const row of extensionRows) {
            // add implicit wait to avoid stale element exceptions
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(100);
            extensionViewItems.push(
            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
            await new ExtensionsViewItem(this.locatorMap, row, this).wait());
        }
        return extensionViewItems;
    }
    /**
     * Search for an extension by title. This utilizes the search bar
     * in the Extensions view, which switches the perspective to the
     * section representing the chosen category and temporarily hides all other sections.
     * If you wish to continue working with the initial view section
     * (i.e. Enabled), use the clearSearch method to reset it back to default
     *
     * @param title title to search for in '@category name' format,
     * e.g '@installed extension'. If no @category is present, marketplace will be searched
     *
     * @returns Promise resolving to ExtensionsViewItem if such item exists, undefined otherwise
     */
    async findItem(title) {
        await this.clearSearch();
        const progress = await this.content.progress$;
        const searchField = await this.content.elem.$(this.locators.searchBox);
        await searchField.addValue(title);
        await progress.waitForDisplayed();
        await progress.waitForDisplayed({ reverse: true });
        const sectionTitle = this.getSectionForCategory(title);
        const section = await this.content.getSection(sectionTitle);
        const titleParts = title.split(' ');
        if (titleParts[0].startsWith('@')) {
            title = titleParts.slice(1).join(' ');
        }
        const extensions = await section.getVisibleItems();
        for (const extension of extensions) {
            if (await extension.getTitle() === title) {
                return extension;
            }
        }
        return undefined;
    }
    /**
     * Clears the search bar on top of the view
     * @returns Promise resolving when the search box is cleared
     */
    async clearSearch() {
        const progress = await this.content.progress$;
        try {
            await browser.action('key')
                .down(CMD_KEY).down('a')
                .up(CMD_KEY).up('a')
                .perform();
            await browser.action('key')
                .down(Key.Backspace).up(Key.Backspace)
                .perform();
            await progress.waitForDisplayed();
            await progress.waitForDisplayed({ reverse: true });
        }
        catch (err) {
            // do nothing, the text field is empty
        }
    }
    /**
     * Find and open an extension item
     * @param title title of the extension
     * @returns Promise resolving when the item is clicked
     */
    async openItem(title) {
        const item = await this.findItem(title);
        if (item) {
            await item.elem.click();
        }
        return [];
    }
    getSectionForCategory(title) {
        const category = title.split(' ')[0].toLowerCase();
        switch (category) {
            case ExtensionCategory.Disabled:
                return 'Disabled';
            case ExtensionCategory.Enabled:
                return 'Enabled';
            case ExtensionCategory.Installed:
                return 'Installed';
            case ExtensionCategory.Outdated:
                return 'Outdated';
            case ExtensionCategory.Recommended:
                return 'Other Recommendations';
            default:
                return 'Marketplace';
        }
    }
};
ExtensionsViewSection = __decorate([
    PageDecorator({ ...ViewSectionLocators, ...ExtensionsViewSectionLocators })
], ExtensionsViewSection);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXh0ZW5zaW9uc1ZpZXdTZWN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3BhZ2VvYmplY3RzL3NpZGViYXIvZXh0ZW5zaW9ucy9FeHRlbnNpb25zVmlld1NlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUVqQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUE7QUFDL0MsT0FBTyxFQUFFLGtCQUFrQixFQUEwQixNQUFNLGdCQUFnQixDQUFBO0FBQzNFLE9BQU8sRUFBRSxhQUFhLEVBQWtCLE1BQU0sZ0JBQWdCLENBQUE7QUFDOUQsT0FBTyxFQUNILFdBQVcsSUFBSSxtQkFBbUIsRUFDbEMscUJBQXFCLElBQUksNkJBQTZCLEVBQ3pELE1BQU0sNkJBQTZCLENBQUE7QUFDcEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHVCQUF1QixDQUFBO0FBRS9DOztHQUVHO0FBQ0gsSUFBSyxpQkFNSjtBQU5ELFdBQUssaUJBQWlCO0lBQ2xCLDZDQUF3QixDQUFBO0lBQ3hCLHlDQUFvQixDQUFBO0lBQ3BCLDJDQUFzQixDQUFBO0lBQ3RCLDJDQUFzQixDQUFBO0lBQ3RCLGlEQUE0QixDQUFBO0FBQ2hDLENBQUMsRUFOSSxpQkFBaUIsS0FBakIsaUJBQWlCLFFBTXJCO0FBR0Q7Ozs7R0FJRztBQUVJLFdBQU0scUJBQXFCLEdBQTNCLE1BQU0scUJBQXNCLFNBQVEsV0FBVztJQUEvQzs7UUFDSDs7V0FFRztRQUNJLGVBQVUsR0FBRyxDQUFDLGFBQXNCLEVBQUUsdUJBQWdDLENBQUMsQ0FBQTtJQWlIbEYsQ0FBQztJQS9HRyxLQUFLLENBQUMsZUFBZTtRQUNqQixNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBWSxDQUFDO1lBQ3BE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J1xuXG5pbXBvcnQgeyBWaWV3U2VjdGlvbiB9IGZyb20gJy4uL1ZpZXdTZWN0aW9uLmpzJ1xuaW1wb3J0IHsgRXh0ZW5zaW9uc1ZpZXdJdGVtLCBBbGxWaWV3U2VjdGlvbkxvY2F0b3JzIH0gZnJvbSAnLi4vLi4vaW5kZXguanMnXG5pbXBvcnQgeyBQYWdlRGVjb3JhdG9yLCBJUGFnZURlY29yYXRvciB9IGZyb20gJy4uLy4uL3V0aWxzLmpzJ1xuaW1wb3J0IHtcbiAgICBWaWV3U2VjdGlvbiBhcyBWaWV3U2VjdGlvbkxvY2F0b3JzLFxuICAgIEV4dGVuc2lvbnNWaWV3U2VjdGlvbiBhcyBFeHRlbnNpb25zVmlld1NlY3Rpb25Mb2NhdG9yc1xufSBmcm9tICcuLi8uLi8uLi9sb2NhdG9ycy8xLjczLjAuanMnXG5pbXBvcnQgeyBDTURfS0VZIH0gZnJvbSAnLi4vLi4vLi4vY29uc3RhbnRzLmpzJ1xuXG4vKipcbiAqIENhdGVnb3JpZXMgb2YgZXh0ZW5zaW9ucyB0byBzZWFyY2ggZm9yXG4gKi9cbmVudW0gRXh0ZW5zaW9uQ2F0ZWdvcnkge1xuICAgIEluc3RhbGxlZCA9ICdAaW5zdGFsbGVkJyxcbiAgICBFbmFibGVkID0gJ0BlbmFibGVkJyxcbiAgICBEaXNhYmxlZCA9ICdAZGlzYWJsZWQnLFxuICAgIE91dGRhdGVkID0gJ0BvdXRkYXRlZCcsXG4gICAgUmVjb21tZW5kZWQgPSAnQHJlY29tbWVuZGVkJ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV4dGVuc2lvbnNWaWV3U2VjdGlvbiBleHRlbmRzIElQYWdlRGVjb3JhdG9yPEFsbFZpZXdTZWN0aW9uTG9jYXRvcnM+IHsgfVxuLyoqXG4gKiBWaWV3IHNlY3Rpb24gY29udGFpbmluZyBleHRlbnNpb25zXG4gKlxuICogQGNhdGVnb3J5IFNpZGViYXJcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoeyAuLi5WaWV3U2VjdGlvbkxvY2F0b3JzLCAuLi5FeHRlbnNpb25zVmlld1NlY3Rpb25Mb2NhdG9ycyB9KVxuZXhwb3J0IGNsYXNzIEV4dGVuc2lvbnNWaWV3U2VjdGlvbiBleHRlbmRzIFZpZXdTZWN0aW9uIHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gWydWaWV3U2VjdGlvbicgYXMgY29uc3QsICdFeHRlbnNpb25zVmlld1NlY3Rpb24nIGFzIGNvbnN0XVxuXG4gICAgYXN5bmMgZ2V0VmlzaWJsZUl0ZW1zICgpOiBQcm9taXNlPEV4dGVuc2lvbnNWaWV3SXRlbVtdPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuaXRlbXMkLiQodGhpcy5sb2NhdG9ycy5pdGVtUm93KS53YWl0Rm9yRXhpc3Qoe1xuICAgICAgICAgICAgdGltZW91dE1zZzogJ0NvdWxkIG5vdCBmaW5kIGFueSBleHRlbnNpb24gaXRlbXMnXG4gICAgICAgIH0pXG4gICAgICAgIGNvbnN0IGV4dGVuc2lvblJvd3MgPSBhd2FpdCB0aGlzLml0ZW1zJC4kJCh0aGlzLmxvY2F0b3JzLml0ZW1Sb3cpXG4gICAgICAgIGNvbnN0IGV4dGVuc2lvblZpZXdJdGVtczogRXh0ZW5zaW9uc1ZpZXdJdGVtW10gPSBbXVxuXG4gICAgICAgIGZvciAoY29uc3Qgcm93IG9mIGV4dGVuc2lvblJvd3MpIHtcbiAgICAgICAgICAgIC8vIGFkZCBpbXBsaWNpdCB3YWl0IHRvIGF2b2lkIHN0YWxlIGVsZW1lbnQgZXhjZXB0aW9uc1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHdkaW8vbm8tcGF1c2VcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIucGF1c2UoMTAwKVxuICAgICAgICAgICAgZXh0ZW5zaW9uVmlld0l0ZW1zLnB1c2goXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXJndW1lbnRcbiAgICAgICAgICAgICAgICBhd2FpdCBuZXcgRXh0ZW5zaW9uc1ZpZXdJdGVtKHRoaXMubG9jYXRvck1hcCwgcm93IGFzIGFueSwgdGhpcykud2FpdCgpXG4gICAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZXh0ZW5zaW9uVmlld0l0ZW1zXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VhcmNoIGZvciBhbiBleHRlbnNpb24gYnkgdGl0bGUuIFRoaXMgdXRpbGl6ZXMgdGhlIHNlYXJjaCBiYXJcbiAgICAgKiBpbiB0aGUgRXh0ZW5zaW9ucyB2aWV3LCB3aGljaCBzd2l0Y2hlcyB0aGUgcGVyc3BlY3RpdmUgdG8gdGhlXG4gICAgICogc2VjdGlvbiByZXByZXNlbnRpbmcgdGhlIGNob3NlbiBjYXRlZ29yeSBhbmQgdGVtcG9yYXJpbHkgaGlkZXMgYWxsIG90aGVyIHNlY3Rpb25zLlxuICAgICAqIElmIHlvdSB3aXNoIHRvIGNvbnRpbnVlIHdvcmtpbmcgd2l0aCB0aGUgaW5pdGlhbCB2aWV3IHNlY3Rpb25cbiAgICAgKiAoaS5lLiBFbmFibGVkKSwgdXNlIHRoZSBjbGVhclNlYXJjaCBtZXRob2QgdG8gcmVzZXQgaXQgYmFjayB0byBkZWZhdWx0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGl0bGUgdGl0bGUgdG8gc2VhcmNoIGZvciBpbiAnQGNhdGVnb3J5IG5hbWUnIGZvcm1hdCxcbiAgICAgKiBlLmcgJ0BpbnN0YWxsZWQgZXh0ZW5zaW9uJy4gSWYgbm8gQGNhdGVnb3J5IGlzIHByZXNlbnQsIG1hcmtldHBsYWNlIHdpbGwgYmUgc2VhcmNoZWRcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIEV4dGVuc2lvbnNWaWV3SXRlbSBpZiBzdWNoIGl0ZW0gZXhpc3RzLCB1bmRlZmluZWQgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgYXN5bmMgZmluZEl0ZW0gKHRpdGxlOiBzdHJpbmcpOiBQcm9taXNlPEV4dGVuc2lvbnNWaWV3SXRlbSB8IHVuZGVmaW5lZD4ge1xuICAgICAgICBhd2FpdCB0aGlzLmNsZWFyU2VhcmNoKClcbiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBhd2FpdCB0aGlzLmNvbnRlbnQucHJvZ3Jlc3MkXG4gICAgICAgIGNvbnN0IHNlYXJjaEZpZWxkID0gYXdhaXQgdGhpcy5jb250ZW50LmVsZW0uJCh0aGlzLmxvY2F0b3JzLnNlYXJjaEJveClcbiAgICAgICAgYXdhaXQgc2VhcmNoRmllbGQuYWRkVmFsdWUodGl0bGUpXG5cbiAgICAgICAgYXdhaXQgcHJvZ3Jlc3Mud2FpdEZvckRpc3BsYXllZCgpXG4gICAgICAgIGF3YWl0IHByb2dyZXNzLndhaXRGb3JEaXNwbGF5ZWQoeyByZXZlcnNlOiB0cnVlIH0pXG5cbiAgICAgICAgY29uc3Qgc2VjdGlvblRpdGxlID0gdGhpcy5nZXRTZWN0aW9uRm9yQ2F0ZWdvcnkodGl0bGUpXG4gICAgICAgIGNvbnN0IHNlY3Rpb24gPSBhd2FpdCB0aGlzLmNvbnRlbnQuZ2V0U2VjdGlvbihzZWN0aW9uVGl0bGUpIGFzIEV4dGVuc2lvbnNWaWV3U2VjdGlvblxuXG4gICAgICAgIGNvbnN0IHRpdGxlUGFydHMgPSB0aXRsZS5zcGxpdCgnICcpXG4gICAgICAgIGlmICh0aXRsZVBhcnRzWzBdLnN0YXJ0c1dpdGgoJ0AnKSkge1xuICAgICAgICAgICAgdGl0bGUgPSB0aXRsZVBhcnRzLnNsaWNlKDEpLmpvaW4oJyAnKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZXh0ZW5zaW9ucyA9IGF3YWl0IHNlY3Rpb24uZ2V0VmlzaWJsZUl0ZW1zKClcblxuICAgICAgICBmb3IgKGNvbnN0IGV4dGVuc2lvbiBvZiBleHRlbnNpb25zKSB7XG4gICAgICAgICAgICBpZiAoYXdhaXQgZXh0ZW5zaW9uLmdldFRpdGxlKCkgPT09IHRpdGxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4dGVuc2lvblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsZWFycyB0aGUgc2VhcmNoIGJhciBvbiB0b3Agb2YgdGhlIHZpZXdcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB3aGVuIHRoZSBzZWFyY2ggYm94IGlzIGNsZWFyZWRcbiAgICAgKi9cbiAgICBhc3luYyBjbGVhclNlYXJjaCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHByb2dyZXNzID0gYXdhaXQgdGhpcy5jb250ZW50LnByb2dyZXNzJFxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAgICAgLmRvd24oQ01EX0tFWSkuZG93bignYScpXG4gICAgICAgICAgICAgICAgLnVwKENNRF9LRVkpLnVwKCdhJylcbiAgICAgICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgICAgICAgICBhd2FpdCBicm93c2VyLmFjdGlvbigna2V5JylcbiAgICAgICAgICAgICAgICAuZG93bihLZXkuQmFja3NwYWNlKS51cChLZXkuQmFja3NwYWNlKVxuICAgICAgICAgICAgICAgIC5wZXJmb3JtKClcbiAgICAgICAgICAgIGF3YWl0IHByb2dyZXNzLndhaXRGb3JEaXNwbGF5ZWQoKVxuICAgICAgICAgICAgYXdhaXQgcHJvZ3Jlc3Mud2FpdEZvckRpc3BsYXllZCh7IHJldmVyc2U6IHRydWUgfSlcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAvLyBkbyBub3RoaW5nLCB0aGUgdGV4dCBmaWVsZCBpcyBlbXB0eVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCBhbmQgb3BlbiBhbiBleHRlbnNpb24gaXRlbVxuICAgICAqIEBwYXJhbSB0aXRsZSB0aXRsZSBvZiB0aGUgZXh0ZW5zaW9uXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgd2hlbiB0aGUgaXRlbSBpcyBjbGlja2VkXG4gICAgICovXG4gICAgYXN5bmMgb3Blbkl0ZW0gKHRpdGxlOiBzdHJpbmcpOiBQcm9taXNlPG5ldmVyW10+IHtcbiAgICAgICAgY29uc3QgaXRlbSA9IGF3YWl0IHRoaXMuZmluZEl0ZW0odGl0bGUpXG4gICAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgICAgICBhd2FpdCBpdGVtLmVsZW0uY2xpY2soKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0U2VjdGlvbkZvckNhdGVnb3J5ICh0aXRsZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgY2F0ZWdvcnkgPSB0aXRsZS5zcGxpdCgnICcpWzBdLnRvTG93ZXJDYXNlKClcbiAgICAgICAgc3dpdGNoIChjYXRlZ29yeSkge1xuICAgICAgICAgICAgY2FzZSBFeHRlbnNpb25DYXRlZ29yeS5EaXNhYmxlZDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0Rpc2FibGVkJ1xuICAgICAgICAgICAgY2FzZSBFeHRlbnNpb25DYXRlZ29yeS5FbmFibGVkOlxuICAgICAgICAgICAgICAgIHJldHVybiAnRW5hYmxlZCdcbiAgICAgICAgICAgIGNhc2UgRXh0ZW5zaW9uQ2F0ZWdvcnkuSW5zdGFsbGVkOlxuICAgICAgICAgICAgICAgIHJldHVybiAnSW5zdGFsbGVkJ1xuICAgICAgICAgICAgY2FzZSBFeHRlbnNpb25DYXRlZ29yeS5PdXRkYXRlZDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ091dGRhdGVkJ1xuICAgICAgICAgICAgY2FzZSBFeHRlbnNpb25DYXRlZ29yeS5SZWNvbW1lbmRlZDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ090aGVyIFJlY29tbWVuZGF0aW9ucydcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdNYXJrZXRwbGFjZSdcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==