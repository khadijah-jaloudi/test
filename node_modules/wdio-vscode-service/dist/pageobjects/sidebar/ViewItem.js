var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { BasePage, ElementWithContextMenu, PageDecorator } from '../utils.js';
import { ViewSection as ViewSectionLocators } from '../../locators/1.73.0.js';
/**
 * Arbitrary item in the side bar view
 *
 * @category Sidebar
 */
export class ViewItem extends ElementWithContextMenu {
    /**
     * Select the item in the view.
     * Note that selecting the item will toggle its expand state when applicable.
     * @returns Promise resolving when the item has been clicked
     */
    async select() {
        await this.elem.click();
    }
}
/**
 * TreeItem abstract class
 *
 * @category Sidebar
 */
export class TreeItem extends ViewItem {
    /**
     * Finds if the item has children by actually counting the child items
     * Note that this will expand the item if it was collapsed
     * @returns Promise resolving to true/false
     */
    async hasChildren() {
        const children = await this.getChildren();
        return children && children.length > 0;
    }
    /**
     * Expands the current item, if it can be expanded and is collapsed.
     */
    async expand() {
        if (await this.isExpandable() && !await this.isExpanded()) {
            await this.twistie$.click();
        }
    }
    /**
     * Find a child item with the given name
     * @returns Promise resolving to TreeItem object if the child item exists, undefined otherwise
     */
    async findChildItem(name) {
        const children = await this.getChildren();
        for (const item of children) {
            if (await item.getLabel() === name) {
                return item;
            }
        }
        return undefined;
    }
    /**
     * Collapse the item if expanded
     */
    async collapse() {
        if (await this.isExpandable() && await this.isExpanded()) {
            await this.twistie$.click();
        }
    }
    /**
     * Find all action buttons bound to the view item
     *
     * @returns array of ViewItemAction objects, empty array if item has no
     * actions associated
     */
    async getActionButtons() {
        await this.elem.moveTo();
        const container = await this.actions$;
        if (!await container.isExisting()) {
            return [];
        }
        const actions = [];
        const items = await container.$$(this.locators.actionLabel);
        for (const item of items) {
            const elem = item.$(this.locatorMap.ViewSection.actionConstructor());
            const label = (
            // v1.69.0 and before
            await elem.getAttribute(this.locators.actionTitle)
                // v1.70.0 and after
                || await item.getAttribute(this.locators.actionTitle));
            actions.push(new ViewItemAction(this.locatorMap, elem, label, this));
        }
        return actions;
    }
    /**
     * Find action button for view item by label
     * @param label label of the button to search by
     *
     * @returns ViewItemAction object if such button exists, undefined otherwise
     */
    async getActionButton(label) {
        const actions = await this.getActionButtons();
        if (actions.length > 0) {
            return actions.find((item) => item.getLabel().indexOf(label) > -1);
        }
        return undefined;
    }
    /**
     * Find all child elements of a tree item
     * @param locator locator of a given type of tree item
     */
    async getChildItems(locator) {
        const items = [];
        await this.expand();
        const rows = await this.parent.$$(locator);
        const baseIndex = +await this.elem.getAttribute(this.locatorMap.ViewSection.index);
        const baseLevel = +await this.elem.getAttribute(this.locatorMap.ViewSection.level);
        for (const row of rows) {
            const level = +await row.getAttribute(this.locatorMap.ViewSection.level);
            const index = +await row.getAttribute(this.locatorMap.ViewSection.index);
            if (index <= baseIndex) {
                continue;
            }
            if (level > baseLevel + 1) {
                continue;
            }
            if (level <= baseLevel) {
                break;
            }
            items.push(row);
        }
        return items;
    }
    async findTwistie() {
        return this.twistie$;
    }
}
/**
 * Action button bound to a view item
 *
 * @category Sidebar
 */
export let ViewItemAction = class ViewItemAction extends BasePage {
    constructor(locators, elem, label, viewItem) {
        super(locators, elem, viewItem.elem);
        /**
         * @private
         */
        this.locatorKey = 'ViewSection';
        this.label = label;
    }
    /**
     * Get label of the action button
     */
    getLabel() {
        return this.label;
    }
};
ViewItemAction = __decorate([
    PageDecorator(ViewSectionLocators)
], ViewItemAction);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlld0l0ZW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFnZW9iamVjdHMvc2lkZWJhci9WaWV3SXRlbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxPQUFPLEVBQ2EsUUFBUSxFQUFFLHNCQUFzQixFQUFFLGFBQWEsRUFDbEUsTUFBTSxhQUFhLENBQUE7QUFDcEIsT0FBTyxFQUNILFdBQVcsSUFBSSxtQkFBbUIsRUFLckMsTUFBTSwwQkFBMEIsQ0FBQTtBQWVqQzs7OztHQUlHO0FBQ0gsTUFBTSxPQUFnQixRQUFTLFNBQVEsc0JBQXdDO0lBQzNFOzs7O09BSUc7SUFDSCxLQUFLLENBQUMsTUFBTTtRQUNSLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUMzQixDQUFDO0NBQ0o7QUFHRDs7OztHQUlHO0FBQ0gsTUFBTSxPQUFnQixRQUFTLFNBQVEsUUFBUTtJQWtCM0M7Ozs7T0FJRztJQUNILEtBQUssQ0FBQyxXQUFXO1FBQ2IsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDekMsT0FBTyxRQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7SUFDMUMsQ0FBQztJQW9CRDs7T0FFRztJQUNILEtBQUssQ0FBQyxNQUFNO1FBQ1IsSUFBSSxNQUFNLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ3ZELE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtTQUM5QjtJQUNMLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsYUFBYSxDQUFFLElBQVk7UUFDN0IsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDekMsS0FBSyxNQUFNLElBQUksSUFBSSxRQUFRLEVBQUU7WUFDekIsSUFBSSxNQUFNLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ2hDLE9BQU8sSUFBSSxDQUFBO2FBQ2Q7U0FDSjtRQUNELE9BQU8sU0FBUyxDQUFBO0lBQ3BCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxRQUFRO1FBQ1YsSUFBSSxNQUFNLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUN0RCxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUE7U0FDOUI7SUFDTCxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxLQUFLLENBQUMsZ0JBQWdCO1FBQ2xCLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtRQUN4QixNQUFNLFNBQVMsR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUE7UUFFckMsSUFBSSxDQUFDLE1BQU0sU0FBUyxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQy9CLE9BQU8sRUFBRSxDQUFBO1NBQ1o7UUFFRCxNQUFNLE9BQU8sR0FBcUIsRUFBRSxDQUFBO1FBQ3BDLE1BQU0sS0FBSyxHQUFHLE1BQU0sU0FBUyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQzNELEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFO1lBQ3RCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsaUJBQWtDLEVBQUUsQ0FBQyxDQUFBO1lBQ3RGLE1BQU0sS0FBSyxHQUFHO1lBQ1YscUJBQXFCO1lBQ3JCLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztnQkFDbEQsb0JBQW9CO21CQUNqQixNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FDeEQsQ0FBQTtZQUNELE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUE7U0FDdkU7UUFDRCxPQUFPLE9BQU8sQ0FBQTtJQUNsQixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxLQUFLLENBQUMsZUFBZSxDQUFFLEtBQWE7UUFDaEMsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtRQUM3QyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3BCLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO1NBQ3JFO1FBQ0QsT0FBTyxTQUFTLENBQUE7SUFDcEIsQ0FBQztJQUVEOzs7T0FHRztJQUNPLEtBQUssQ0FBQyxhQUFhLENBQUUsT0FBZTtRQUMxQyxNQUFNLEtBQUssR0FBMEIsRUFBRSxDQUFBO1FBQ3ZDLE1BQU0sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFBO1FBRW5CLE1BQU0sSUFBSSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDMUMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLEtBQWUsQ0FBQyxDQUFBO1FBQzVGLE1BQU0sU0FBUyxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxLQUFlLENBQUMsQ0FBQTtRQUU1RixLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRTtZQUNwQixNQUFNLEtBQUssR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxLQUFlLENBQUMsQ0FBQTtZQUNsRixNQUFNLEtBQUssR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxLQUFlLENBQUMsQ0FBQTtZQUVsRixJQUFJLEtBQUssSUFBSSxTQUFTLEVBQUU7Z0JBQ3BCLFNBQVE7YUFDWDtZQUNELElBQUksS0FBSyxHQUFHLFNBQVMsR0FBRyxDQUFDLEVBQUU7Z0JBQ3ZCLFNBQVE7YUFDWDtZQUNELElBQUksS0FBSyxJQUFJLFNBQVMsRUFBRTtnQkFDcEIsTUFBSzthQUNSO1lBRUQsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtTQUNsQjtRQUVELE9BQU8sS0FBSyxDQUFBO0lBQ2hCLENBQUM7SUFFUyxLQUFLLENBQUMsV0FBVztRQUN2QixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUE7SUFDeEIsQ0FBQztDQUNKO0FBR0Q7Ozs7R0FJRztBQUVJLFdBQU0sY0FBYyxHQUFwQixNQUFNLGNBQWUsU0FBUSxRQUFvQztJQU9wRSxZQUNJLFFBQTBCLEVBQzFCLElBQWtELEVBQ2xELEtBQWEsRUFDYixRQUFrQjtRQUVsQixLQUFLLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUE7UUFaeEM7O1dBRUc7UUFDSSxlQUFVLEdBQUcsYUFBc0IsQ0FBQTtRQVV0QyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTtJQUN0QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxRQUFRO1FBQ0osT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFBO0lBQ3JCLENBQUM7Q0FDSixDQUFBO0FBdkJZLGNBQWM7SUFEMUIsYUFBYSxDQUFDLG1CQUFtQixDQUFDO0dBQ3RCLGNBQWMsQ0F1QjFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDaGFpbmFibGVQcm9taXNlRWxlbWVudCB9IGZyb20gJ3dlYmRyaXZlcmlvJ1xuaW1wb3J0IHtcbiAgICBJUGFnZURlY29yYXRvciwgQmFzZVBhZ2UsIEVsZW1lbnRXaXRoQ29udGV4dE1lbnUsIFBhZ2VEZWNvcmF0b3IsIFZTQ29kZUxvY2F0b3JNYXBcbn0gZnJvbSAnLi4vdXRpbHMuanMnXG5pbXBvcnQge1xuICAgIFZpZXdTZWN0aW9uIGFzIFZpZXdTZWN0aW9uTG9jYXRvcnMsXG4gICAgVHJlZUl0ZW0gYXMgVHJlZUl0ZW1Mb2NhdG9ycyxcbiAgICBDdXN0b21UcmVlSXRlbSBhcyBDdXN0b21UcmVlSXRlbUxvY2F0b3JzLFxuICAgIERlZmF1bHRUcmVlSXRlbSBhcyBEZWZhdWx0VHJlZUl0ZW1Mb2NhdG9ycyxcbiAgICBFeHRlbnNpb25zVmlld0l0ZW0gYXMgRXh0ZW5zaW9uc1ZpZXdJdGVtTG9jYXRvcnNcbn0gZnJvbSAnLi4vLi4vbG9jYXRvcnMvMS43My4wLmpzJ1xuXG4vKipcbiAqIEFic3RyYWN0IHJlcHJlc2VudGF0aW9uIG9mIGEgcm93IGluIHRoZSB0cmVlIGluc2lkZSBhIHZpZXcgY29udGVudCBzZWN0aW9uXG4gKiBAaGlkZGVuXG4gKi9cbmV4cG9ydCB0eXBlIFZpZXdJdGVtTG9jYXRvcnMgPSAoXG4gICAgdHlwZW9mIFZpZXdTZWN0aW9uTG9jYXRvcnMgJlxuICAgIHR5cGVvZiBUcmVlSXRlbUxvY2F0b3JzICZcbiAgICB0eXBlb2YgQ3VzdG9tVHJlZUl0ZW1Mb2NhdG9ycyAmXG4gICAgdHlwZW9mIERlZmF1bHRUcmVlSXRlbUxvY2F0b3JzICZcbiAgICB0eXBlb2YgRXh0ZW5zaW9uc1ZpZXdJdGVtTG9jYXRvcnNcbilcblxuZXhwb3J0IGludGVyZmFjZSBWaWV3SXRlbSBleHRlbmRzIElQYWdlRGVjb3JhdG9yPFZpZXdJdGVtTG9jYXRvcnM+IHsgfVxuLyoqXG4gKiBBcmJpdHJhcnkgaXRlbSBpbiB0aGUgc2lkZSBiYXIgdmlld1xuICpcbiAqIEBjYXRlZ29yeSBTaWRlYmFyXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBWaWV3SXRlbSBleHRlbmRzIEVsZW1lbnRXaXRoQ29udGV4dE1lbnU8Vmlld0l0ZW1Mb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIFNlbGVjdCB0aGUgaXRlbSBpbiB0aGUgdmlldy5cbiAgICAgKiBOb3RlIHRoYXQgc2VsZWN0aW5nIHRoZSBpdGVtIHdpbGwgdG9nZ2xlIGl0cyBleHBhbmQgc3RhdGUgd2hlbiBhcHBsaWNhYmxlLlxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIGl0ZW0gaGFzIGJlZW4gY2xpY2tlZFxuICAgICAqL1xuICAgIGFzeW5jIHNlbGVjdCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuZWxlbS5jbGljaygpXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyZWVJdGVtIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8Vmlld0l0ZW1Mb2NhdG9ycz4geyB9XG4vKipcbiAqIFRyZWVJdGVtIGFic3RyYWN0IGNsYXNzXG4gKlxuICogQGNhdGVnb3J5IFNpZGViYXJcbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFRyZWVJdGVtIGV4dGVuZHMgVmlld0l0ZW0ge1xuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyB0aGUgbGFiZWwgb2YgdGhpcyB2aWV3IGl0ZW1cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBnZXRMYWJlbCAoKTogUHJvbWlzZTxzdHJpbmc+XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIHRvb2x0aXAgb2YgdGhpcyBUcmVlSXRlbS5cbiAgICAgKiBAcmV0dXJucyBBIHByb21pc2UgcmVzb2x2aW5nIHRvIHRoZSB0b29sdGlwIG9yIHVuZGVmaW5lZCBpZiB0aGUgVHJlZUl0ZW0gaGFzIG5vIHRvb2x0aXAuXG4gICAgICovXG4gICAgYWJzdHJhY3QgZ2V0VG9vbHRpcCAoKTogUHJvbWlzZTxzdHJpbmcgfCB1bmRlZmluZWQ+XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIGRlc2NyaXB0aW9uIG9mIHRoaXMgVHJlZUl0ZW0uXG4gICAgICogQHJldHVybnMgQSBwcm9taXNlIHJlc29sdmluZyB0byB0aGUgdG9vbHRpcCBvciB1bmRlZmluZWQgaWYgdGhlIFRyZWVJdGVtIGhhcyBubyBkZXNjcmlwdGlvbi5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBnZXREZXNjcmlwdGlvbiAoKTogUHJvbWlzZTxzdHJpbmcgfCB1bmRlZmluZWQ+XG5cbiAgICAvKipcbiAgICAgKiBGaW5kcyBpZiB0aGUgaXRlbSBoYXMgY2hpbGRyZW4gYnkgYWN0dWFsbHkgY291bnRpbmcgdGhlIGNoaWxkIGl0ZW1zXG4gICAgICogTm90ZSB0aGF0IHRoaXMgd2lsbCBleHBhbmQgdGhlIGl0ZW0gaWYgaXQgd2FzIGNvbGxhcHNlZFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRydWUvZmFsc2VcbiAgICAgKi9cbiAgICBhc3luYyBoYXNDaGlsZHJlbiAoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gYXdhaXQgdGhpcy5nZXRDaGlsZHJlbigpXG4gICAgICAgIHJldHVybiBjaGlsZHJlbiAmJiBjaGlsZHJlbi5sZW5ndGggPiAwXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZHMgd2hldGhlciB0aGUgaXRlbSBpcyBleHBhbmRlZC4gQWx3YXlzIHJldHVybnMgZmFsc2UgaWYgaXRlbSBoYXMgbm8gY2hpbGRyZW4uXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gdHJ1ZS9mYWxzZVxuICAgICAqL1xuICAgIGFic3RyYWN0IGlzRXhwYW5kZWQgKCk6IFByb21pc2U8Ym9vbGVhbj5cblxuICAgIC8qKlxuICAgICAqIEZpbmQgY2hpbGRyZW4gb2YgYW4gaXRlbSwgd2lsbCB0cnkgdG8gZXhwYW5kIHRoZSBpdGVtIGluIHRoZSBwcm9jZXNzXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gYXJyYXkgb2YgVHJlZUl0ZW0gb2JqZWN0cywgZW1wdHkgYXJyYXkgaWYgaXRlbSBoYXMgbm8gY2hpbGRyZW5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBnZXRDaGlsZHJlbiAoKTogUHJvbWlzZTxUcmVlSXRlbVtdPlxuXG4gICAgLyoqXG4gICAgICogRmluZHMgaWYgdGhlIGl0ZW0gaXMgZXhwYW5kYWJsZS9jb2xsYXBzaWJsZVxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRydWUvZmFsc2VcbiAgICAgKi9cbiAgICBhYnN0cmFjdCBpc0V4cGFuZGFibGUgKCk6IFByb21pc2U8Ym9vbGVhbj5cblxuICAgIC8qKlxuICAgICAqIEV4cGFuZHMgdGhlIGN1cnJlbnQgaXRlbSwgaWYgaXQgY2FuIGJlIGV4cGFuZGVkIGFuZCBpcyBjb2xsYXBzZWQuXG4gICAgICovXG4gICAgYXN5bmMgZXhwYW5kICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuaXNFeHBhbmRhYmxlKCkgJiYgIWF3YWl0IHRoaXMuaXNFeHBhbmRlZCgpKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnR3aXN0aWUkLmNsaWNrKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgYSBjaGlsZCBpdGVtIHdpdGggdGhlIGdpdmVuIG5hbWVcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBUcmVlSXRlbSBvYmplY3QgaWYgdGhlIGNoaWxkIGl0ZW0gZXhpc3RzLCB1bmRlZmluZWQgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgYXN5bmMgZmluZENoaWxkSXRlbSAobmFtZTogc3RyaW5nKTogUHJvbWlzZTxUcmVlSXRlbSB8IHVuZGVmaW5lZD4ge1xuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGF3YWl0IHRoaXMuZ2V0Q2hpbGRyZW4oKVxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGlmIChhd2FpdCBpdGVtLmdldExhYmVsKCkgPT09IG5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb2xsYXBzZSB0aGUgaXRlbSBpZiBleHBhbmRlZFxuICAgICAqL1xuICAgIGFzeW5jIGNvbGxhcHNlICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuaXNFeHBhbmRhYmxlKCkgJiYgYXdhaXQgdGhpcy5pc0V4cGFuZGVkKCkpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudHdpc3RpZSQuY2xpY2soKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCBhbGwgYWN0aW9uIGJ1dHRvbnMgYm91bmQgdG8gdGhlIHZpZXcgaXRlbVxuICAgICAqXG4gICAgICogQHJldHVybnMgYXJyYXkgb2YgVmlld0l0ZW1BY3Rpb24gb2JqZWN0cywgZW1wdHkgYXJyYXkgaWYgaXRlbSBoYXMgbm9cbiAgICAgKiBhY3Rpb25zIGFzc29jaWF0ZWRcbiAgICAgKi9cbiAgICBhc3luYyBnZXRBY3Rpb25CdXR0b25zICgpOiBQcm9taXNlPFZpZXdJdGVtQWN0aW9uW10+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5lbGVtLm1vdmVUbygpXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGF3YWl0IHRoaXMuYWN0aW9ucyRcblxuICAgICAgICBpZiAoIWF3YWl0IGNvbnRhaW5lci5pc0V4aXN0aW5nKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWN0aW9uczogVmlld0l0ZW1BY3Rpb25bXSA9IFtdXG4gICAgICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgY29udGFpbmVyLiQkKHRoaXMubG9jYXRvcnMuYWN0aW9uTGFiZWwpXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgICAgICAgY29uc3QgZWxlbSA9IGl0ZW0uJCgodGhpcy5sb2NhdG9yTWFwLlZpZXdTZWN0aW9uLmFjdGlvbkNvbnN0cnVjdG9yIGFzICgpID0+IHN0cmluZykoKSlcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gKFxuICAgICAgICAgICAgICAgIC8vIHYxLjY5LjAgYW5kIGJlZm9yZVxuICAgICAgICAgICAgICAgIGF3YWl0IGVsZW0uZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvcnMuYWN0aW9uVGl0bGUpXG4gICAgICAgICAgICAgICAgLy8gdjEuNzAuMCBhbmQgYWZ0ZXJcbiAgICAgICAgICAgICAgICB8fCBhd2FpdCBpdGVtLmdldEF0dHJpYnV0ZSh0aGlzLmxvY2F0b3JzLmFjdGlvblRpdGxlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgYWN0aW9ucy5wdXNoKG5ldyBWaWV3SXRlbUFjdGlvbih0aGlzLmxvY2F0b3JNYXAsIGVsZW0sIGxhYmVsLCB0aGlzKSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWN0aW9uc1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgYWN0aW9uIGJ1dHRvbiBmb3IgdmlldyBpdGVtIGJ5IGxhYmVsXG4gICAgICogQHBhcmFtIGxhYmVsIGxhYmVsIG9mIHRoZSBidXR0b24gdG8gc2VhcmNoIGJ5XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBWaWV3SXRlbUFjdGlvbiBvYmplY3QgaWYgc3VjaCBidXR0b24gZXhpc3RzLCB1bmRlZmluZWQgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgYXN5bmMgZ2V0QWN0aW9uQnV0dG9uIChsYWJlbDogc3RyaW5nKTogUHJvbWlzZTxWaWV3SXRlbUFjdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgICAgICBjb25zdCBhY3Rpb25zID0gYXdhaXQgdGhpcy5nZXRBY3Rpb25CdXR0b25zKClcbiAgICAgICAgaWYgKGFjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnMuZmluZCgoaXRlbSkgPT4gaXRlbS5nZXRMYWJlbCgpLmluZGV4T2YobGFiZWwpID4gLTEpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgYWxsIGNoaWxkIGVsZW1lbnRzIG9mIGEgdHJlZSBpdGVtXG4gICAgICogQHBhcmFtIGxvY2F0b3IgbG9jYXRvciBvZiBhIGdpdmVuIHR5cGUgb2YgdHJlZSBpdGVtXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGFzeW5jIGdldENoaWxkSXRlbXMgKGxvY2F0b3I6IHN0cmluZykge1xuICAgICAgICBjb25zdCBpdGVtczogV2ViZHJpdmVySU8uRWxlbWVudFtdID0gW11cbiAgICAgICAgYXdhaXQgdGhpcy5leHBhbmQoKVxuXG4gICAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCB0aGlzLnBhcmVudC4kJChsb2NhdG9yKVxuICAgICAgICBjb25zdCBiYXNlSW5kZXggPSArYXdhaXQgdGhpcy5lbGVtLmdldEF0dHJpYnV0ZSh0aGlzLmxvY2F0b3JNYXAuVmlld1NlY3Rpb24uaW5kZXggYXMgc3RyaW5nKVxuICAgICAgICBjb25zdCBiYXNlTGV2ZWwgPSArYXdhaXQgdGhpcy5lbGVtLmdldEF0dHJpYnV0ZSh0aGlzLmxvY2F0b3JNYXAuVmlld1NlY3Rpb24ubGV2ZWwgYXMgc3RyaW5nKVxuXG4gICAgICAgIGZvciAoY29uc3Qgcm93IG9mIHJvd3MpIHtcbiAgICAgICAgICAgIGNvbnN0IGxldmVsID0gK2F3YWl0IHJvdy5nZXRBdHRyaWJ1dGUodGhpcy5sb2NhdG9yTWFwLlZpZXdTZWN0aW9uLmxldmVsIGFzIHN0cmluZylcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gK2F3YWl0IHJvdy5nZXRBdHRyaWJ1dGUodGhpcy5sb2NhdG9yTWFwLlZpZXdTZWN0aW9uLmluZGV4IGFzIHN0cmluZylcblxuICAgICAgICAgICAgaWYgKGluZGV4IDw9IGJhc2VJbmRleCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobGV2ZWwgPiBiYXNlTGV2ZWwgKyAxKSB7XG4gICAgICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChsZXZlbCA8PSBiYXNlTGV2ZWwpIHtcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpdGVtcy5wdXNoKHJvdylcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpdGVtc1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBhc3luYyBmaW5kVHdpc3RpZSAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnR3aXN0aWUkXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZpZXdJdGVtQWN0aW9uIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFZpZXdTZWN0aW9uTG9jYXRvcnM+IHsgfVxuLyoqXG4gKiBBY3Rpb24gYnV0dG9uIGJvdW5kIHRvIGEgdmlldyBpdGVtXG4gKlxuICogQGNhdGVnb3J5IFNpZGViYXJcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoVmlld1NlY3Rpb25Mb2NhdG9ycylcbmV4cG9ydCBjbGFzcyBWaWV3SXRlbUFjdGlvbiBleHRlbmRzIEJhc2VQYWdlPHR5cGVvZiBWaWV3U2VjdGlvbkxvY2F0b3JzPiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9ICdWaWV3U2VjdGlvbicgYXMgY29uc3RcbiAgICBwcml2YXRlIGxhYmVsOiBzdHJpbmdcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgbG9jYXRvcnM6IFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgICAgIGVsZW06IENoYWluYWJsZVByb21pc2VFbGVtZW50PFdlYmRyaXZlcklPLkVsZW1lbnQ+LFxuICAgICAgICBsYWJlbDogc3RyaW5nLFxuICAgICAgICB2aWV3SXRlbTogVHJlZUl0ZW1cbiAgICApIHtcbiAgICAgICAgc3VwZXIobG9jYXRvcnMsIGVsZW0sIHZpZXdJdGVtLmVsZW0pXG4gICAgICAgIHRoaXMubGFiZWwgPSBsYWJlbFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBsYWJlbCBvZiB0aGUgYWN0aW9uIGJ1dHRvblxuICAgICAqL1xuICAgIGdldExhYmVsICgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5sYWJlbFxuICAgIH1cbn1cbiJdfQ==