var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { fileURLToPath } from 'node:url';
import clipboard from 'clipboardy';
import { Key } from 'webdriverio';
import logger from '@wdio/logger';
import { ContentAssist, ContextMenu, InputBox } from '../index.js';
import { StatusBar } from '../statusBar/StatusBar.js';
import { Editor } from './Editor.js';
import { PageDecorator, BasePage, ElementWithContextMenu } from '../utils.js';
import { TextEditor as TextEditorLocators, FindWidget as FindWidgetLocators } from '../../locators/1.73.0.js';
import { CMD_KEY } from '../../constants.js';
const log = logger('wdio-vscode-service');
/**
 * Page object representing the active text editor
 *
 * @category Editor
 */
export let TextEditor = class TextEditor extends Editor {
    constructor() {
        super(...arguments);
        /**
         * @private
         */
        this.locatorKey = 'TextEditor';
    }
    /**
     * Find whether the active editor has unsaved changes
     * @returns Promise resolving to true/false
     */
    async isDirty() {
        const klass = await this.parent.$(this.locators.activeTab).getAttribute('class');
        return klass.indexOf('dirty') >= 0;
    }
    /**
     * Saves the active editor
     * @returns Promise resolving when ctrl+s is invoked
     */
    async save() {
        await browser.action('key')
            .down(CMD_KEY).down('s')
            .pause(10)
            .up(CMD_KEY).up('s')
            .perform();
    }
    /**
     * Open the Save as prompt
     *
     * @returns InputBox serving as a simple file dialog
     */
    async saveAs() {
        await browser.action('key')
            .down(CMD_KEY).down(Key.Shift).down('s')
            .pause(10)
            .up(CMD_KEY).down(Key.Shift).up('s')
            .perform();
        const inputBox = browser.$(this.locatorMap.InputBox.elem);
        await inputBox.waitForExist({ timeout: 5000 });
        return new InputBox(this.locatorMap, inputBox);
    }
    /**
     * Retrieve the Uri of the file opened in the active editor
     * @returns Promise resolving to editor's underlying Uri
     */
    async getFileUri() {
        const ed = await this.editorContainer$;
        return ed.getAttribute(this.locators.dataUri);
    }
    /**
     * Retrieve the path to the file opened in the active editor
     * @returns Promise resolving to editor's underlying file path
     */
    async getFilePath() {
        return fileURLToPath(await this.getFileUri());
    }
    /**
     * Open/Close the content assistant at the current position in the editor by sending the default
     * keyboard shortcut signal
     * @param open true to open, false to close
     * @returns Promise resolving to ContentAssist object when opening, void otherwise
     */
    async toggleContentAssist(open) {
        let isHidden = true;
        try {
            const assist = await this.elem.$(this.locatorMap.ContentAssist.elem);
            const klass = await assist.getAttribute('class');
            const visibility = await assist.getCSSProperty('visibility');
            isHidden = klass.indexOf('visible') < 0 || visibility.value === 'hidden';
        }
        catch (err) {
            isHidden = true;
        }
        if (open) {
            if (isHidden) {
                await browser.action('key')
                    .down(CMD_KEY).down(Key.Space)
                    .up(CMD_KEY).up(Key.Space)
                    .perform();
                await browser.$(this.locatorMap.ContentAssist.elem)
                    .waitForExist({ timeout: 2000 });
            }
            const assist = await new ContentAssist(this.locatorMap, this).wait();
            await browser.waitUntil(() => assist.isLoaded(), { timeout: 10000 });
            return assist;
        }
        if (!isHidden) {
            await browser.action('key')
                .down(Key.Escape).up(Key.Escape)
                .perform();
        }
        return undefined;
    }
    /**
     * Get all text from the editor
     * @returns Promise resolving to editor text
     */
    async getText() {
        await browser.action('key')
            .down(CMD_KEY).down('a').down('c')
            .pause(10)
            .up(CMD_KEY).up('a').up('c')
            .perform();
        const text = clipboard.readSync();
        await browser.action('key')
            .down(Key.ArrowUp).up(Key.ArrowUp)
            .perform();
        clipboard.writeSync('');
        /**
         * let's return "" if the editor is empty rather than "\n"
         */
        return text.trim().length === 0
            ? ''
            : text;
    }
    /**
     * Replace the contents of the editor with a given text
     * @param text text to type into the editor
     * @param formatText format the new text, default false
     * @returns Promise resolving once the new text is copied over
     */
    async setText(text, formatText = false) {
        clipboard.writeSync(text);
        await browser.action('key')
            .down(CMD_KEY).down('a').down('v')
            .pause(10)
            .up(CMD_KEY).up('a').up('v')
            .perform();
        clipboard.writeSync('');
        if (formatText) {
            await this.formatDocument();
        }
    }
    /**
     * Deletes all text within the editor
     * @returns Promise resolving once the text is deleted
     */
    async clearText() {
        await browser.action('key')
            .down(CMD_KEY).down('a').down(Key.Backspace)
            .pause(10)
            .up(CMD_KEY).up('a').up(Key.Backspace)
            .perform();
    }
    /**
     * Get text from a given line
     * @param line number of the line to retrieve
     * @returns Promise resolving to text at the given line number
     */
    async getTextAtLine(line) {
        const text = await this.getText();
        const lines = text.split('\n');
        if (line < 1 || line > lines.length) {
            throw new Error(`Line number ${line} does not exist`);
        }
        return lines[line - 1].trim();
    }
    /**
     * Replace the contents of a line with a given text
     * @param line number of the line to edit
     * @param text text to set at the line
     * @returns Promise resolving when the text is typed in
     */
    async setTextAtLine(line, text) {
        if (line < 1 || line > await this.getNumberOfLines()) {
            throw new Error(`Line number ${line} does not exist`);
        }
        const lines = (await this.getText()).split('\n');
        lines[line - 1] = text;
        await this.setText(lines.join('\n'));
    }
    /**
     * Get line number that contains the given text. Not suitable for multi line inputs.
     *
     * @param text text to search for
     * @param occurrence select which occurrence of the search text to look for in case
     *                   there are multiple in the document, defaults to 1 (the first instance)
     *
     * @returns Number of the line that contains the start of the given text. -1 if no such text is found.
     * If occurrence number is specified, searches until it finds as many instances of the given text.
     * Returns the line number that holds the last occurrence found this way.
     */
    async getLineOfText(text, occurrence = 1) {
        let lineNum = -1;
        let found = 0;
        const lines = (await this.getText()).split('\n');
        for (let i = 0; i < lines.length; i += 1) {
            if (lines[i].includes(text)) {
                found += 1;
                lineNum = i + 1;
                if (found >= occurrence) {
                    break;
                }
            }
        }
        return lineNum;
    }
    /**
     * Find and select a given text. Not usable for multi line selection.
     *
     * @param text text to select
     * @param occurrence specify which onccurrence of text to select if multiple are present in the document
     */
    async selectText(text, occurrence = 1) {
        const lineNum = await this.getLineOfText(text, occurrence);
        if (lineNum < 1) {
            throw new Error(`Text '${text}' not found`);
        }
        const line = await this.getTextAtLine(lineNum);
        const column = line.indexOf(text) + 1;
        await this.moveCursor(lineNum, column);
        await browser.action('key')
            .down(CMD_KEY).down(Key.Shift).down(Key.ArrowRight)
            .pause(10)
            .up(CMD_KEY).up(Key.Shift).up(Key.ArrowRight)
            .perform();
    }
    /**
     * Get the text that is currently selected as string
     */
    async getSelectedText() {
        await browser.action('key')
            .down(CMD_KEY).down('c')
            .up(CMD_KEY).up('c')
            .perform();
        return clipboard.read();
    }
    /**
     * Get the selection block as a page object
     * @returns Selection page object
     */
    async getSelection() {
        const selection = await this.selection$$;
        if (selection.length < 1) {
            return undefined;
        }
        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
        return new Selection(this.locatorMap, selection[0], this);
    }
    async openFindWidget() {
        await browser.keys([CMD_KEY, 'f']);
        const widget = await browser.$(this.locators.findWidget);
        await widget.waitForDisplayed({ timeout: 2000 });
        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
        return new FindWidget(this.locatorMap, widget, this);
    }
    /**
     * Add the given text to the given coordinates
     * @param line number of the line to type into
     * @param column number of the column to start typing at
     * @param text text to add
     * @returns Promise resolving when the text is typed in
     */
    async typeTextAt(line, column, text) {
        await this.moveCursor(line, column);
        const inputarea = await this.elem.$(this.locatorMap.Editor.inputArea);
        await inputarea.addValue(text);
    }
    /**
     * Type given text at the current coordinates
     * @param text text to type
     * @returns promise resolving when the text is typed in
     */
    async typeText(text) {
        const inputarea = await this.elem.$(this.locatorMap.Editor.inputArea);
        await inputarea.addValue(text);
    }
    /**
     * Move the cursor to the given coordinates
     * @param line line number to move to
     * @param column column number to move to
     * @returns Promise resolving when the cursor has reached the given coordinates
     */
    async moveCursor(line, column) {
        if (line < 1 || line > await this.getNumberOfLines()) {
            throw new Error(`Line number ${line} does not exist`);
        }
        if (column < 1) {
            throw new Error(`Column number ${column} does not exist`);
        }
        let coordinates = await this.getCoordinates();
        const lineGap = coordinates[0] - line;
        const lineKey = lineGap >= 0 ? Key.ArrowUp : Key.ArrowDown;
        for (let i = 0; i < Math.abs(lineGap); i += 1) {
            await browser.action('key')
                .down(lineKey).pause(10).up(lineKey)
                .perform();
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(50);
        }
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(100);
        coordinates = await this.getCoordinates();
        const columnGap = coordinates[1] - column;
        const columnKey = columnGap >= 0 ? Key.ArrowLeft : Key.ArrowRight;
        for (let i = 0; i < Math.abs(columnGap); i += 1) {
            await browser.action('key')
                .down(columnKey).pause(10).up(columnKey)
                .perform();
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(50);
            if ((await this.getCoordinates())[0] !== coordinates[0]) {
                throw new Error(`Column number ${column} is not accessible on line ${line}`);
            }
        }
    }
    /**
     * Get number of lines in the editor
     * @returns Promise resolving to number of lines
     */
    async getNumberOfLines() {
        const lines = (await this.getText()).split('\n');
        return lines.length;
    }
    /**
     * Use the built-in 'Format Document' option to format the text
     * @returns Promise resolving when the Format Document command is invoked
     */
    async formatDocument() {
        const menu = await this.openContextMenu();
        try {
            await menu.select('Format Document');
        }
        catch (err) {
            log.error('Warn: Format Document not available for selected language');
            if (await menu.elem.isDisplayed()) {
                await menu.close();
            }
        }
    }
    async openContextMenu() {
        await this.elem.click({ button: 2 });
        const shadowRootHost = await this.view.elem.$$('.shadow-root-host');
        if (shadowRootHost.length > 0) {
            const shadowRoot = $(await browser.execute('return arguments[0].shadowRoot', shadowRootHost[0]));
            return new ContextMenu(this.locatorMap, shadowRoot).wait();
        }
        return super.openContextMenu();
    }
    /**
     * Get the cursor's coordinates as an array of two numbers: `[line, column]`
     *
     * **Caution** line & column coordinates do not start at `0` but at `1`!
     */
    async getCoordinates() {
        const coords = [];
        const statusBar = new StatusBar(this.locatorMap);
        const coordinates = (await statusBar.getCurrentPosition()).match(/\d+/g);
        for (const c of coordinates) {
            coords.push(+c);
        }
        return [coords[0], coords[1]];
    }
    /**
     * Toggle breakpoint on a given line
     *
     * @param line target line number
     * @returns promise resolving to true when a breakpoint was added, false when removed or
     */
    async toggleBreakpoint(line) {
        const margin = await this.marginArea$;
        const lineNum = await margin.$(this.locators.lineNumber(line));
        await lineNum.moveTo();
        const lineOverlay = await margin.$(this.locators.lineOverlay(line));
        const breakPoint = await lineOverlay.$$(this.locators.breakPoint);
        if (breakPoint.length > 0) {
            await breakPoint[0].click();
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(200);
            return false;
        }
        const noBreak = await lineOverlay.$$(this.locators.debugHint);
        if (noBreak.length > 0) {
            await noBreak[0].click();
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(200);
            return true;
        }
        return false;
    }
    /**
     * Get all code lenses within the editor
     * @returns list of CodeLens page objects
     */
    async getCodeLenses() {
        const lenses = [];
        const widgets = await this.elem.$('.contentWidgets');
        const items = await widgets.$$('.//span[contains(@widgetid, \'codelens.widget\')]');
        for (const item of items) {
            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
            lenses.push(await new CodeLens(this.locatorMap, item, this).wait());
        }
        return lenses;
    }
    /**
     * Get a code lens based on title, or zero based index
     *
     * @param indexOrTitle zero based index (counting from the top of the editor), or partial title of the code lens
     * @returns CodeLens object if such a code lens exists, undefined otherwise
     */
    async getCodeLens(indexOrTitle) {
        const lenses = await this.getCodeLenses();
        if (typeof indexOrTitle === 'string') {
            for (const lens of lenses) {
                const title = await lens.getText();
                const match = title.match(indexOrTitle);
                if (match && match.length > 0) {
                    return lens;
                }
            }
        }
        else if (lenses[indexOrTitle]) {
            return lenses[indexOrTitle];
        }
        return undefined;
    }
};
TextEditor = __decorate([
    PageDecorator(TextEditorLocators)
], TextEditor);
/**
 * Text selection block
 *
 * @category Editor
 */
let Selection = class Selection extends ElementWithContextMenu {
    constructor(locators, element, editor) {
        super(locators, element);
        this.editor = editor;
        /**
         * @private
         */
        this.locatorKey = 'TextEditor';
    }
    async openContextMenu() {
        await this.elem.click({ button: 2 });
        const shadowRootHost = await this.editor.view.elem.$$('.shadow-root-host');
        if (shadowRootHost.length > 0) {
            const shadowRoot = $(await browser.execute('return arguments[0].shadowRoot', shadowRootHost[0]));
            return new ContextMenu(this.locatorMap, shadowRoot).wait();
        }
        return super.openContextMenu();
    }
};
Selection = __decorate([
    PageDecorator(TextEditorLocators)
], Selection);
/**
 * Page object for Code Lens inside a text editor
 *
 * @category Editor
 */
export let CodeLens = class CodeLens extends BasePage {
    constructor(locators, element, editor) {
        super(locators, element);
        this.editor = editor;
        /**
         * @private
         */
        this.locatorKey = 'TextEditor';
    }
    /**
     * Get the text displayed on the code lens
     * @returns text as string
     */
    async getText() {
        const link = await this.elem.$('a');
        return link.getText();
    }
    /**
     * Get tooltip of the code lens
     * @returns tooltip as string
     */
    async getTooltip() {
        const link = await this.elem.$('a');
        return link.getAttribute('title');
    }
};
CodeLens = __decorate([
    PageDecorator(TextEditorLocators)
], CodeLens);
/**
 * Text Editor's Find Widget
 *
 * @category Editor
 */
export let FindWidget = class FindWidget extends BasePage {
    constructor(locators, element, textEditor) {
        super(locators, element);
        this.textEditor = textEditor;
        /**
         * @private
         */
        this.locatorKey = 'FindWidget';
    }
    /**
     * Toggle between find and replace mode
     * @param replace true for replace, false for find
     */
    async toggleReplace(replace) {
        const btn = await this.toggleReplace$;
        const klass = await btn.getAttribute('class');
        if ((replace && klass.includes('collapsed')) || (!replace && !klass.includes('collapsed'))) {
            await btn.addValue(' ');
            const repl = await browser.$(this.locators.replacePart);
            await repl.waitForExist({ timeout: 2000 });
            if (replace) {
                await repl.waitForDisplayed({ timeout: 2000 });
            }
            else {
                await repl.waitForDisplayed({ timeout: 2000, reverse: true });
            }
        }
    }
    /**
     * Set text in the search box
     * @param text text to fill in
     */
    async setSearchText(text) {
        await browser.keys([CMD_KEY, 'f']);
        await browser.keys(text);
    }
    /**
     * Get text from Find input box
     * @returns value of find input as string
     */
    async getSearchText() {
        const findPart = await this.findPart$;
        return this.getInputText(findPart);
    }
    /**
     * Set text in the replace box. Will toggle replace mode on if called in find mode.
     * @param text text to fill in
     */
    async setReplaceText(text) {
        await this.toggleReplace(true);
        const replacePart = await this.replacePart$;
        await this.setText(text, replacePart);
    }
    /**
     * Get text from Replace input box
     * @returns value of replace input as string
     */
    async getReplaceText() {
        const replacePart = await this.replacePart$;
        return this.getInputText(replacePart);
    }
    /**
     * Click 'Next match'
     */
    async nextMatch() {
        const name = (await browser.getVSCodeVersion()) < '1.59.0' ? 'Next match' : 'Next Match';
        await this.clickButton(name, 'find');
    }
    /**
     * Click 'Previous match'
     */
    async previousMatch() {
        const name = (await browser.getVSCodeVersion()) < '1.59.0' ? 'Previous match' : 'Previous Match';
        await this.clickButton(name, 'find');
    }
    /**
     * Click 'Replace'. Only works in replace mode.
     */
    async replace() {
        await this.clickButton('Replace', 'replace');
    }
    /**
     * Click 'Replace All'. Only works in replace mode.
     */
    async replaceAll() {
        await this.clickButton('Replace All', 'replace');
    }
    /**
     * Close the widget.
     */
    async close() {
        await this.clickButton('Close', 'find');
    }
    /**
     * Get the number of results as an ordered pair of numbers
     * @returns pair in form of [current result index, total number of results]
     */
    async getResultCount() {
        const count = await this.matchCount$;
        const text = await count.getText();
        if (text.includes('No results')) {
            return [0, 0];
        }
        const numbers = text.split(' of ');
        return [+numbers[0], +numbers[1]];
    }
    /**
     * Toggle the search to match case
     * @param toggle true to turn on, false to turn off
     */
    async toggleMatchCase(toggle) {
        await this.toggleControl('Match Case', 'find', toggle);
    }
    /**
     * Toggle the search to match whole words
     * @param toggle true to turn on, false to turn off
     */
    async toggleMatchWholeWord(toggle) {
        await this.toggleControl('Match Whole Word', 'find', toggle);
    }
    /**
     * Toggle the search to use regular expressions
     * @param toggle true to turn on, false to turn off
     */
    async toggleUseRegularExpression(toggle) {
        await this.toggleControl('Use Regular Expression', 'find', toggle);
    }
    /**
     * Toggle the replace to preserve case
     * @param toggle true to turn on, false to turn off
     */
    async togglePreserveCase(toggle) {
        await this.toggleControl('Preserve Case', 'replace', toggle);
    }
    async toggleControl(title, part, toggle) {
        if (part !== 'find' && part !== 'replace') {
            throw new Error('"part" parameter needs to be "find" or "replace"');
        }
        const element = part === 'find'
            ? await this.findPart$
            : await this.replacePart$;
        if (part === 'replace') {
            await this.toggleReplace(true);
        }
        const control = await element.$(this.locators.checkbox(title));
        const checked = await control.getAttribute('aria-checked');
        if ((toggle && checked !== 'true') || (!toggle && checked === 'true')) {
            await control.click();
        }
    }
    async clickButton(title, part) {
        if (part !== 'find' && part !== 'replace') {
            throw new Error('"part" parameter needs to be "find" or "replace"');
        }
        const element = part === 'find'
            ? await this.findPart$
            : await this.replacePart$;
        if (part === 'replace') {
            await this.toggleReplace(true);
        }
        const btn = await element.$(this.locators.button(title));
        await btn.click();
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(100);
    }
    async setText(text, composite) {
        const input = await composite.$(this.locators.input);
        await input.setValue(text);
    }
    async getInputText(composite) {
        const input = await composite.$(this.locators.content);
        return input.getHTML(false);
    }
};
FindWidget = __decorate([
    PageDecorator(FindWidgetLocators)
], FindWidget);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGV4dEVkaXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wYWdlb2JqZWN0cy9lZGl0b3IvVGV4dEVkaXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ3hDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUUsR0FBRyxFQUEyQixNQUFNLGFBQWEsQ0FBQTtBQUUxRCxPQUFPLE1BQU0sTUFBTSxjQUFjLENBQUE7QUFDakMsT0FBTyxFQUFFLGFBQWEsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFBO0FBQ2xFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQTtBQUNyRCxPQUFPLEVBQUUsTUFBTSxFQUFrQixNQUFNLGFBQWEsQ0FBQTtBQUVwRCxPQUFPLEVBQ0gsYUFBYSxFQUFrQixRQUFRLEVBQUUsc0JBQXNCLEVBQ2xFLE1BQU0sYUFBYSxDQUFBO0FBQ3BCLE9BQU8sRUFDSCxVQUFVLElBQUksa0JBQWtCLEVBQ2hDLFVBQVUsSUFBSSxrQkFBa0IsRUFDbkMsTUFBTSwwQkFBMEIsQ0FBQTtBQUNqQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFFNUMsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUE7QUFHekM7Ozs7R0FJRztBQUVJLFdBQU0sVUFBVSxHQUFoQixNQUFNLFVBQVcsU0FBUSxNQUFzQjtJQUEvQzs7UUFDSDs7V0FFRztRQUNJLGVBQVUsR0FBRyxZQUFxQixDQUFBO0lBNmI3QyxDQUFDO0lBM2JHOzs7T0FHRztJQUNILEtBQUssQ0FBQyxPQUFPO1FBQ1QsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFD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QUFBO1FBQ3hELE1BQU0sR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFBO1FBQ2pCLHlDQUF5QztRQUN6QyxNQUFNLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDNUIsQ0FBQztJQUVPLEtBQUssQ0FBQyxPQUFPLENBQUUsSUFBWSxFQUFFLFNBQThCO1FBQy9ELE1BQU0sS0FBSyxHQUFHLE1BQU0sU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ3BELE1BQU0sS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM5QixDQUFDO0lBRU8sS0FBSyxDQUFDLFlBQVksQ0FBRSxTQUE4QjtRQUN0RCxNQUFNLEtBQUssR0FBRyxNQUFNLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUN0RCxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDL0IsQ0FBQztDQUNKLENBQUE7QUEzTVksVUFBVTtJQUR0QixhQUFhLENBQUMsa0JBQWtCLENBQUM7R0FDckIsVUFBVSxDQTJNdEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmaWxlVVJMVG9QYXRoIH0gZnJvbSAnbm9kZTp1cmwnXG5pbXBvcnQgY2xpcGJvYXJkIGZyb20gJ2NsaXBib2FyZHknXG5pbXBvcnQgeyBLZXksIENoYWluYWJsZVByb21pc2VFbGVtZW50IH0gZnJvbSAnd2ViZHJpdmVyaW8nXG5cbmltcG9ydCBsb2dnZXIgZnJvbSAnQHdkaW8vbG9nZ2VyJ1xuaW1wb3J0IHsgQ29udGVudEFzc2lzdCwgQ29udGV4dE1lbnUsIElucHV0Qm94IH0gZnJvbSAnLi4vaW5kZXguanMnXG5pbXBvcnQgeyBTdGF0dXNCYXIgfSBmcm9tICcuLi9zdGF0dXNCYXIvU3RhdHVzQmFyLmpzJ1xuaW1wb3J0IHsgRWRpdG9yLCBFZGl0b3JMb2NhdG9ycyB9IGZyb20gJy4vRWRpdG9yLmpzJ1xuXG5pbXBvcnQge1xuICAgIFBhZ2VEZWNvcmF0b3IsIElQYWdlRGVjb3JhdG9yLCBCYXNlUGFnZSwgRWxlbWVudFdpdGhDb250ZXh0TWVudSwgVlNDb2RlTG9jYXRvck1hcFxufSBmcm9tICcuLi91dGlscy5qcydcbmltcG9ydCB7XG4gICAgVGV4dEVkaXRvciBhcyBUZXh0RWRpdG9yTG9jYXRvcnMsXG4gICAgRmluZFdpZGdldCBhcyBGaW5kV2lkZ2V0TG9jYXRvcnNcbn0gZnJvbSAnLi4vLi4vbG9jYXRvcnMvMS43My4wLmpzJ1xuaW1wb3J0IHsgQ01EX0tFWSB9IGZyb20gJy4uLy4uL2NvbnN0YW50cy5qcydcblxuY29uc3QgbG9nID0gbG9nZ2VyKCd3ZGlvLXZzY29kZS1zZXJ2aWNlJylcblxuZXhwb3J0IGludGVyZmFjZSBUZXh0RWRpdG9yIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8RWRpdG9yTG9jYXRvcnM+IHt9XG4vKipcbiAqIFBhZ2Ugb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgYWN0aXZlIHRleHQgZWRpdG9yXG4gKlxuICogQGNhdGVnb3J5IEVkaXRvclxuICovXG5AUGFnZURlY29yYXRvcihUZXh0RWRpdG9yTG9jYXRvcnMpXG5leHBvcnQgY2xhc3MgVGV4dEVkaXRvciBleHRlbmRzIEVkaXRvcjxFZGl0b3JMb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHVibGljIGxvY2F0b3JLZXkgPSAnVGV4dEVkaXRvcicgYXMgY29uc3RcblxuICAgIC8qKlxuICAgICAqIEZpbmQgd2hldGhlciB0aGUgYWN0aXZlIGVkaXRvciBoYXMgdW5zYXZlZCBjaGFuZ2VzXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gdHJ1ZS9mYWxzZVxuICAgICAqL1xuICAgIGFzeW5jIGlzRGlydHkgKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBjb25zdCBrbGFzcyA9IGF3YWl0IHRoaXMucGFyZW50LiQodGhpcy5sb2NhdG9ycy5hY3RpdmVUYWIpLmdldEF0dHJpYnV0ZSgnY2xhc3MnKVxuICAgICAgICByZXR1cm4ga2xhc3MuaW5kZXhPZignZGlydHknKSA+PSAwXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2F2ZXMgdGhlIGFjdGl2ZSBlZGl0b3JcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB3aGVuIGN0cmwrcyBpcyBpbnZva2VkXG4gICAgICovXG4gICAgYXN5bmMgc2F2ZSAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgLmRvd24oQ01EX0tFWSkuZG93bigncycpXG4gICAgICAgICAgICAucGF1c2UoMTApXG4gICAgICAgICAgICAudXAoQ01EX0tFWSkudXAoJ3MnKVxuICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZW4gdGhlIFNhdmUgYXMgcHJvbXB0XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBJbnB1dEJveCBzZXJ2aW5nIGFzIGEgc2ltcGxlIGZpbGUgZGlhbG9nXG4gICAgICovXG4gICAgYXN5bmMgc2F2ZUFzICgpOiBQcm9taXNlPElucHV0Qm94PiB7XG4gICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgLmRvd24oQ01EX0tFWSkuZG93bihLZXkuU2hpZnQpLmRvd24oJ3MnKVxuICAgICAgICAgICAgLnBhdXNlKDEwKVxuICAgICAgICAgICAgLnVwKENNRF9LRVkpLmRvd24oS2V5LlNoaWZ0KS51cCgncycpXG4gICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgICAgIGNvbnN0IGlucHV0Qm94ID0gYnJvd3Nlci4kKHRoaXMubG9jYXRvck1hcC5JbnB1dEJveC5lbGVtIGFzIHN0cmluZylcbiAgICAgICAgYXdhaXQgaW5wdXRCb3gud2FpdEZvckV4aXN0KHsgdGltZW91dDogNTAwMCB9KVxuICAgICAgICByZXR1cm4gbmV3IElucHV0Qm94KHRoaXMubG9jYXRvck1hcCwgaW5wdXRCb3gpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhlIFVyaSBvZiB0aGUgZmlsZSBvcGVuZWQgaW4gdGhlIGFjdGl2ZSBlZGl0b3JcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBlZGl0b3IncyB1bmRlcmx5aW5nIFVyaVxuICAgICAqL1xuICAgIGFzeW5jIGdldEZpbGVVcmkgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IGVkID0gYXdhaXQgdGhpcy5lZGl0b3JDb250YWluZXIkXG4gICAgICAgIHJldHVybiBlZC5nZXRBdHRyaWJ1dGUodGhpcy5sb2NhdG9ycy5kYXRhVXJpKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIHRoZSBwYXRoIHRvIHRoZSBmaWxlIG9wZW5lZCBpbiB0aGUgYWN0aXZlIGVkaXRvclxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIGVkaXRvcidzIHVuZGVybHlpbmcgZmlsZSBwYXRoXG4gICAgICovXG4gICAgYXN5bmMgZ2V0RmlsZVBhdGggKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIHJldHVybiBmaWxlVVJMVG9QYXRoKGF3YWl0IHRoaXMuZ2V0RmlsZVVyaSgpKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZW4vQ2xvc2UgdGhlIGNvbnRlbnQgYXNzaXN0YW50IGF0IHRoZSBjdXJyZW50IHBvc2l0aW9uIGluIHRoZSBlZGl0b3IgYnkgc2VuZGluZyB0aGUgZGVmYXVsdFxuICAgICAqIGtleWJvYXJkIHNob3J0Y3V0IHNpZ25hbFxuICAgICAqIEBwYXJhbSBvcGVuIHRydWUgdG8gb3BlbiwgZmFsc2UgdG8gY2xvc2VcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBDb250ZW50QXNzaXN0IG9iamVjdCB3aGVuIG9wZW5pbmcsIHZvaWQgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgYXN5bmMgdG9nZ2xlQ29udGVudEFzc2lzdCAob3BlbjogYm9vbGVhbik6IFByb21pc2U8Q29udGVudEFzc2lzdCB8IHVuZGVmaW5lZD4ge1xuICAgICAgICBsZXQgaXNIaWRkZW4gPSB0cnVlXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBhc3Npc3QgPSBhd2FpdCB0aGlzLmVsZW0uJCh0aGlzLmxvY2F0b3JNYXAuQ29udGVudEFzc2lzdC5lbGVtIGFzIHN0cmluZylcbiAgICAgICAgICAgIGNvbnN0IGtsYXNzID0gYXdhaXQgYXNzaXN0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKVxuICAgICAgICAgICAgY29uc3QgdmlzaWJpbGl0eSA9IGF3YWl0IGFzc2lzdC5nZXRDU1NQcm9wZXJ0eSgndmlzaWJpbGl0eScpXG4gICAgICAgICAgICBpc0hpZGRlbiA9IGtsYXNzLmluZGV4T2YoJ3Zpc2libGUnKSA8IDAgfHwgdmlzaWJpbGl0eS52YWx1ZSA9PT0gJ2hpZGRlbidcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBpc0hpZGRlbiA9IHRydWVcbiAgICAgICAgfVxuICAgICAgICBpZiAob3Blbikge1xuICAgICAgICAgICAgaWYgKGlzSGlkZGVuKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAgICAgICAgIC5kb3duKENNRF9LRVkpLmRvd24oS2V5LlNwYWNlKVxuICAgICAgICAgICAgICAgICAgICAudXAoQ01EX0tFWSkudXAoS2V5LlNwYWNlKVxuICAgICAgICAgICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci4kKHRoaXMubG9jYXRvck1hcC5Db250ZW50QXNzaXN0LmVsZW0gYXMgc3RyaW5nKVxuICAgICAgICAgICAgICAgICAgICAud2FpdEZvckV4aXN0KHsgdGltZW91dDogMjAwMCB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYXNzaXN0ID0gYXdhaXQgbmV3IENvbnRlbnRBc3Npc3QodGhpcy5sb2NhdG9yTWFwLCB0aGlzKS53YWl0KClcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIud2FpdFVudGlsKCgpID0+IGFzc2lzdC5pc0xvYWRlZCgpLCB7IHRpbWVvdXQ6IDEwMDAwIH0pXG4gICAgICAgICAgICByZXR1cm4gYXNzaXN0XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc0hpZGRlbikge1xuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAgICAgLmRvd24oS2V5LkVzY2FwZSkudXAoS2V5LkVzY2FwZSlcbiAgICAgICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgdGV4dCBmcm9tIHRoZSBlZGl0b3JcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBlZGl0b3IgdGV4dFxuICAgICAqL1xuICAgIGFzeW5jIGdldFRleHQgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgLmRvd24oQ01EX0tFWSkuZG93bignYScpLmRvd24oJ2MnKVxuICAgICAgICAgICAgLnBhdXNlKDEwKVxuICAgICAgICAgICAgLnVwKENNRF9LRVkpLnVwKCdhJykudXAoJ2MnKVxuICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgICAgICBjb25zdCB0ZXh0ID0gY2xpcGJvYXJkLnJlYWRTeW5jKClcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAuZG93bihLZXkuQXJyb3dVcCkudXAoS2V5LkFycm93VXApXG4gICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgICAgIGNsaXBib2FyZC53cml0ZVN5bmMoJycpXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGxldCdzIHJldHVybiBcIlwiIGlmIHRoZSBlZGl0b3IgaXMgZW1wdHkgcmF0aGVyIHRoYW4gXCJcXG5cIlxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIHRleHQudHJpbSgpLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgPyAnJ1xuICAgICAgICAgICAgOiB0ZXh0XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVwbGFjZSB0aGUgY29udGVudHMgb2YgdGhlIGVkaXRvciB3aXRoIGEgZ2l2ZW4gdGV4dFxuICAgICAqIEBwYXJhbSB0ZXh0IHRleHQgdG8gdHlwZSBpbnRvIHRoZSBlZGl0b3JcbiAgICAgKiBAcGFyYW0gZm9ybWF0VGV4dCBmb3JtYXQgdGhlIG5ldyB0ZXh0LCBkZWZhdWx0IGZhbHNlXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgb25jZSB0aGUgbmV3IHRleHQgaXMgY29waWVkIG92ZXJcbiAgICAgKi9cbiAgICBhc3luYyBzZXRUZXh0ICh0ZXh0OiBzdHJpbmcsIGZvcm1hdFRleHQgPSBmYWxzZSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjbGlwYm9hcmQud3JpdGVTeW5jKHRleHQpXG4gICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgLmRvd24oQ01EX0tFWSkuZG93bignYScpLmRvd24oJ3YnKVxuICAgICAgICAgICAgLnBhdXNlKDEwKVxuICAgICAgICAgICAgLnVwKENNRF9LRVkpLnVwKCdhJykudXAoJ3YnKVxuICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgICAgICBjbGlwYm9hcmQud3JpdGVTeW5jKCcnKVxuICAgICAgICBpZiAoZm9ybWF0VGV4dCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5mb3JtYXREb2N1bWVudCgpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGFsbCB0ZXh0IHdpdGhpbiB0aGUgZWRpdG9yXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgb25jZSB0aGUgdGV4dCBpcyBkZWxldGVkXG4gICAgICovXG4gICAgYXN5bmMgY2xlYXJUZXh0ICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAuZG93bihDTURfS0VZKS5kb3duKCdhJykuZG93bihLZXkuQmFja3NwYWNlKVxuICAgICAgICAgICAgLnBhdXNlKDEwKVxuICAgICAgICAgICAgLnVwKENNRF9LRVkpLnVwKCdhJykudXAoS2V5LkJhY2tzcGFjZSlcbiAgICAgICAgICAgIC5wZXJmb3JtKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGV4dCBmcm9tIGEgZ2l2ZW4gbGluZVxuICAgICAqIEBwYXJhbSBsaW5lIG51bWJlciBvZiB0aGUgbGluZSB0byByZXRyaWV2ZVxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRleHQgYXQgdGhlIGdpdmVuIGxpbmUgbnVtYmVyXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VGV4dEF0TGluZSAobGluZTogbnVtYmVyKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHRoaXMuZ2V0VGV4dCgpXG4gICAgICAgIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdCgnXFxuJylcbiAgICAgICAgaWYgKGxpbmUgPCAxIHx8IGxpbmUgPiBsaW5lcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTGluZSBudW1iZXIgJHtsaW5lfSBkb2VzIG5vdCBleGlzdGApXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpbmVzW2xpbmUgLSAxXS50cmltKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlIHRoZSBjb250ZW50cyBvZiBhIGxpbmUgd2l0aCBhIGdpdmVuIHRleHRcbiAgICAgKiBAcGFyYW0gbGluZSBudW1iZXIgb2YgdGhlIGxpbmUgdG8gZWRpdFxuICAgICAqIEBwYXJhbSB0ZXh0IHRleHQgdG8gc2V0IGF0IHRoZSBsaW5lXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgd2hlbiB0aGUgdGV4dCBpcyB0eXBlZCBpblxuICAgICAqL1xuICAgIGFzeW5jIHNldFRleHRBdExpbmUgKGxpbmU6IG51bWJlciwgdGV4dDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmIChsaW5lIDwgMSB8fCBsaW5lID4gYXdhaXQgdGhpcy5nZXROdW1iZXJPZkxpbmVzKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTGluZSBudW1iZXIgJHtsaW5lfSBkb2VzIG5vdCBleGlzdGApXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGluZXMgPSAoYXdhaXQgdGhpcy5nZXRUZXh0KCkpLnNwbGl0KCdcXG4nKVxuICAgICAgICBsaW5lc1tsaW5lIC0gMV0gPSB0ZXh0XG4gICAgICAgIGF3YWl0IHRoaXMuc2V0VGV4dChsaW5lcy5qb2luKCdcXG4nKSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgbGluZSBudW1iZXIgdGhhdCBjb250YWlucyB0aGUgZ2l2ZW4gdGV4dC4gTm90IHN1aXRhYmxlIGZvciBtdWx0aSBsaW5lIGlucHV0cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0ZXh0IHRleHQgdG8gc2VhcmNoIGZvclxuICAgICAqIEBwYXJhbSBvY2N1cnJlbmNlIHNlbGVjdCB3aGljaCBvY2N1cnJlbmNlIG9mIHRoZSBzZWFyY2ggdGV4dCB0byBsb29rIGZvciBpbiBjYXNlXG4gICAgICogICAgICAgICAgICAgICAgICAgdGhlcmUgYXJlIG11bHRpcGxlIGluIHRoZSBkb2N1bWVudCwgZGVmYXVsdHMgdG8gMSAodGhlIGZpcnN0IGluc3RhbmNlKVxuICAgICAqXG4gICAgICogQHJldHVybnMgTnVtYmVyIG9mIHRoZSBsaW5lIHRoYXQgY29udGFpbnMgdGhlIHN0YXJ0IG9mIHRoZSBnaXZlbiB0ZXh0LiAtMSBpZiBubyBzdWNoIHRleHQgaXMgZm91bmQuXG4gICAgICogSWYgb2NjdXJyZW5jZSBudW1iZXIgaXMgc3BlY2lmaWVkLCBzZWFyY2hlcyB1bnRpbCBpdCBmaW5kcyBhcyBtYW55IGluc3RhbmNlcyBvZiB0aGUgZ2l2ZW4gdGV4dC5cbiAgICAgKiBSZXR1cm5zIHRoZSBsaW5lIG51bWJlciB0aGF0IGhvbGRzIHRoZSBsYXN0IG9jY3VycmVuY2UgZm91bmQgdGhpcyB3YXkuXG4gICAgICovXG4gICAgYXN5bmMgZ2V0TGluZU9mVGV4dCAodGV4dDogc3RyaW5nLCBvY2N1cnJlbmNlID0gMSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgIGxldCBsaW5lTnVtID0gLTFcbiAgICAgICAgbGV0IGZvdW5kID0gMFxuICAgICAgICBjb25zdCBsaW5lcyA9IChhd2FpdCB0aGlzLmdldFRleHQoKSkuc3BsaXQoJ1xcbicpXG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgaWYgKGxpbmVzW2ldLmluY2x1ZGVzKHRleHQpKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgKz0gMVxuICAgICAgICAgICAgICAgIGxpbmVOdW0gPSBpICsgMVxuICAgICAgICAgICAgICAgIGlmIChmb3VuZCA+PSBvY2N1cnJlbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsaW5lTnVtXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCBhbmQgc2VsZWN0IGEgZ2l2ZW4gdGV4dC4gTm90IHVzYWJsZSBmb3IgbXVsdGkgbGluZSBzZWxlY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGV4dCB0ZXh0IHRvIHNlbGVjdFxuICAgICAqIEBwYXJhbSBvY2N1cnJlbmNlIHNwZWNpZnkgd2hpY2ggb25jY3VycmVuY2Ugb2YgdGV4dCB0byBzZWxlY3QgaWYgbXVsdGlwbGUgYXJlIHByZXNlbnQgaW4gdGhlIGRvY3VtZW50XG4gICAgICovXG4gICAgYXN5bmMgc2VsZWN0VGV4dCAodGV4dDogc3RyaW5nLCBvY2N1cnJlbmNlID0gMSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBsaW5lTnVtID0gYXdhaXQgdGhpcy5nZXRMaW5lT2ZUZXh0KHRleHQsIG9jY3VycmVuY2UpXG4gICAgICAgIGlmIChsaW5lTnVtIDwgMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUZXh0ICcke3RleHR9JyBub3QgZm91bmRgKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbGluZSA9IGF3YWl0IHRoaXMuZ2V0VGV4dEF0TGluZShsaW5lTnVtKVxuICAgICAgICBjb25zdCBjb2x1bW4gPSBsaW5lLmluZGV4T2YodGV4dCkgKyAxXG5cbiAgICAgICAgYXdhaXQgdGhpcy5tb3ZlQ3Vyc29yKGxpbmVOdW0sIGNvbHVtbilcblxuICAgICAgICBhd2FpdCBicm93c2VyLmFjdGlvbigna2V5JylcbiAgICAgICAgICAgIC5kb3duKENNRF9LRVkpLmRvd24oS2V5LlNoaWZ0KS5kb3duKEtleS5BcnJvd1JpZ2h0KVxuICAgICAgICAgICAgLnBhdXNlKDEwKVxuICAgICAgICAgICAgLnVwKENNRF9LRVkpLnVwKEtleS5TaGlmdCkudXAoS2V5LkFycm93UmlnaHQpXG4gICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB0ZXh0IHRoYXQgaXMgY3VycmVudGx5IHNlbGVjdGVkIGFzIHN0cmluZ1xuICAgICAqL1xuICAgIGFzeW5jIGdldFNlbGVjdGVkVGV4dCAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAuZG93bihDTURfS0VZKS5kb3duKCdjJylcbiAgICAgICAgICAgIC51cChDTURfS0VZKS51cCgnYycpXG4gICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgICAgIHJldHVybiBjbGlwYm9hcmQucmVhZCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBzZWxlY3Rpb24gYmxvY2sgYXMgYSBwYWdlIG9iamVjdFxuICAgICAqIEByZXR1cm5zIFNlbGVjdGlvbiBwYWdlIG9iamVjdFxuICAgICAqL1xuICAgIGFzeW5jIGdldFNlbGVjdGlvbiAoKTogUHJvbWlzZTxTZWxlY3Rpb24gfCB1bmRlZmluZWQ+IHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gYXdhaXQgdGhpcy5zZWxlY3Rpb24kJFxuICAgICAgICBpZiAoc2VsZWN0aW9uLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hcmd1bWVudFxuICAgICAgICByZXR1cm4gbmV3IFNlbGVjdGlvbih0aGlzLmxvY2F0b3JNYXAsIHNlbGVjdGlvblswXSBhcyBhbnksIHRoaXMpXG4gICAgfVxuXG4gICAgYXN5bmMgb3BlbkZpbmRXaWRnZXQgKCk6IFByb21pc2U8RmluZFdpZGdldD4ge1xuICAgICAgICBhd2FpdCBicm93c2VyLmtleXMoW0NNRF9LRVksICdmJ10pXG4gICAgICAgIGNvbnN0IHdpZGdldCA9IGF3YWl0IGJyb3dzZXIuJCh0aGlzLmxvY2F0b3JzLmZpbmRXaWRnZXQpXG4gICAgICAgIGF3YWl0IHdpZGdldC53YWl0Rm9yRGlzcGxheWVkKHsgdGltZW91dDogMjAwMCB9KVxuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFyZ3VtZW50XG4gICAgICAgIHJldHVybiBuZXcgRmluZFdpZGdldCh0aGlzLmxvY2F0b3JNYXAsIHdpZGdldCBhcyBhbnksIHRoaXMpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIHRoZSBnaXZlbiB0ZXh0IHRvIHRoZSBnaXZlbiBjb29yZGluYXRlc1xuICAgICAqIEBwYXJhbSBsaW5lIG51bWJlciBvZiB0aGUgbGluZSB0byB0eXBlIGludG9cbiAgICAgKiBAcGFyYW0gY29sdW1uIG51bWJlciBvZiB0aGUgY29sdW1uIHRvIHN0YXJ0IHR5cGluZyBhdFxuICAgICAqIEBwYXJhbSB0ZXh0IHRleHQgdG8gYWRkXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgd2hlbiB0aGUgdGV4dCBpcyB0eXBlZCBpblxuICAgICAqL1xuICAgIGFzeW5jIHR5cGVUZXh0QXQgKGxpbmU6IG51bWJlciwgY29sdW1uOiBudW1iZXIsIHRleHQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCB0aGlzLm1vdmVDdXJzb3IobGluZSwgY29sdW1uKVxuICAgICAgICBjb25zdCBpbnB1dGFyZWEgPSBhd2FpdCB0aGlzLmVsZW0uJCh0aGlzLmxvY2F0b3JNYXAuRWRpdG9yLmlucHV0QXJlYSBhcyBzdHJpbmcpXG4gICAgICAgIGF3YWl0IGlucHV0YXJlYS5hZGRWYWx1ZSh0ZXh0KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFR5cGUgZ2l2ZW4gdGV4dCBhdCB0aGUgY3VycmVudCBjb29yZGluYXRlc1xuICAgICAqIEBwYXJhbSB0ZXh0IHRleHQgdG8gdHlwZVxuICAgICAqIEByZXR1cm5zIHByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIHRleHQgaXMgdHlwZWQgaW5cbiAgICAgKi9cbiAgICBhc3luYyB0eXBlVGV4dCAodGV4dDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGlucHV0YXJlYSA9IGF3YWl0IHRoaXMuZWxlbS4kKHRoaXMubG9jYXRvck1hcC5FZGl0b3IuaW5wdXRBcmVhIGFzIHN0cmluZylcbiAgICAgICAgYXdhaXQgaW5wdXRhcmVhLmFkZFZhbHVlKHRleHQpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTW92ZSB0aGUgY3Vyc29yIHRvIHRoZSBnaXZlbiBjb29yZGluYXRlc1xuICAgICAqIEBwYXJhbSBsaW5lIGxpbmUgbnVtYmVyIHRvIG1vdmUgdG9cbiAgICAgKiBAcGFyYW0gY29sdW1uIGNvbHVtbiBudW1iZXIgdG8gbW92ZSB0b1xuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIGN1cnNvciBoYXMgcmVhY2hlZCB0aGUgZ2l2ZW4gY29vcmRpbmF0ZXNcbiAgICAgKi9cbiAgICBhc3luYyBtb3ZlQ3Vyc29yIChsaW5lOiBudW1iZXIsIGNvbHVtbjogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmIChsaW5lIDwgMSB8fCBsaW5lID4gYXdhaXQgdGhpcy5nZXROdW1iZXJPZkxpbmVzKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTGluZSBudW1iZXIgJHtsaW5lfSBkb2VzIG5vdCBleGlzdGApXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbHVtbiA8IDEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29sdW1uIG51bWJlciAke2NvbHVtbn0gZG9lcyBub3QgZXhpc3RgKVxuICAgICAgICB9XG4gICAgICAgIGxldCBjb29yZGluYXRlcyA9IGF3YWl0IHRoaXMuZ2V0Q29vcmRpbmF0ZXMoKVxuICAgICAgICBjb25zdCBsaW5lR2FwID0gY29vcmRpbmF0ZXNbMF0gLSBsaW5lXG4gICAgICAgIGNvbnN0IGxpbmVLZXkgPSBsaW5lR2FwID49IDAgPyBLZXkuQXJyb3dVcCA6IEtleS5BcnJvd0Rvd25cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLmFicyhsaW5lR2FwKTsgaSArPSAxKSB7XG4gICAgICAgICAgICBhd2FpdCBicm93c2VyLmFjdGlvbigna2V5JylcbiAgICAgICAgICAgICAgICAuZG93bihsaW5lS2V5KS5wYXVzZSgxMCkudXAobGluZUtleSlcbiAgICAgICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgd2Rpby9uby1wYXVzZVxuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5wYXVzZSg1MClcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB3ZGlvL25vLXBhdXNlXG4gICAgICAgIGF3YWl0IGJyb3dzZXIucGF1c2UoMTAwKVxuICAgICAgICBjb29yZGluYXRlcyA9IGF3YWl0IHRoaXMuZ2V0Q29vcmRpbmF0ZXMoKVxuICAgICAgICBjb25zdCBjb2x1bW5HYXAgPSBjb29yZGluYXRlc1sxXSAtIGNvbHVtblxuICAgICAgICBjb25zdCBjb2x1bW5LZXkgPSBjb2x1bW5HYXAgPj0gMCA/IEtleS5BcnJvd0xlZnQgOiBLZXkuQXJyb3dSaWdodFxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE1hdGguYWJzKGNvbHVtbkdhcCk7IGkgKz0gMSkge1xuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAgICAgLmRvd24oY29sdW1uS2V5KS5wYXVzZSgxMCkudXAoY29sdW1uS2V5KVxuICAgICAgICAgICAgICAgIC5wZXJmb3JtKClcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB3ZGlvL25vLXBhdXNlXG4gICAgICAgICAgICBhd2FpdCBicm93c2VyLnBhdXNlKDUwKVxuICAgICAgICAgICAgaWYgKChhd2FpdCB0aGlzLmdldENvb3JkaW5hdGVzKCkpWzBdICE9PSBjb29yZGluYXRlc1swXSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29sdW1uIG51bWJlciAke2NvbHVtbn0gaXMgbm90IGFjY2Vzc2libGUgb24gbGluZSAke2xpbmV9YClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBudW1iZXIgb2YgbGluZXMgaW4gdGhlIGVkaXRvclxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIG51bWJlciBvZiBsaW5lc1xuICAgICAqL1xuICAgIGFzeW5jIGdldE51bWJlck9mTGluZXMgKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgICAgIGNvbnN0IGxpbmVzID0gKGF3YWl0IHRoaXMuZ2V0VGV4dCgpKS5zcGxpdCgnXFxuJylcbiAgICAgICAgcmV0dXJuIGxpbmVzLmxlbmd0aFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVzZSB0aGUgYnVpbHQtaW4gJ0Zvcm1hdCBEb2N1bWVudCcgb3B0aW9uIHRvIGZvcm1hdCB0aGUgdGV4dFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIEZvcm1hdCBEb2N1bWVudCBjb21tYW5kIGlzIGludm9rZWRcbiAgICAgKi9cbiAgICBhc3luYyBmb3JtYXREb2N1bWVudCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IG1lbnUgPSBhd2FpdCB0aGlzLm9wZW5Db250ZXh0TWVudSgpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBtZW51LnNlbGVjdCgnRm9ybWF0IERvY3VtZW50JylcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBsb2cuZXJyb3IoJ1dhcm46IEZvcm1hdCBEb2N1bWVudCBub3QgYXZhaWxhYmxlIGZvciBzZWxlY3RlZCBsYW5ndWFnZScpXG4gICAgICAgICAgICBpZiAoYXdhaXQgbWVudS5lbGVtLmlzRGlzcGxheWVkKCkpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBtZW51LmNsb3NlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIG9wZW5Db250ZXh0TWVudSAoKTogUHJvbWlzZTxDb250ZXh0TWVudT4ge1xuICAgICAgICBhd2FpdCB0aGlzLmVsZW0uY2xpY2soeyBidXR0b246IDIgfSlcbiAgICAgICAgY29uc3Qgc2hhZG93Um9vdEhvc3QgPSBhd2FpdCB0aGlzLnZpZXcuZWxlbS4kJCgnLnNoYWRvdy1yb290LWhvc3QnKVxuXG4gICAgICAgIGlmIChzaGFkb3dSb290SG9zdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBzaGFkb3dSb290ID0gJChhd2FpdCBicm93c2VyLmV4ZWN1dGUoJ3JldHVybiBhcmd1bWVudHNbMF0uc2hhZG93Um9vdCcsIHNoYWRvd1Jvb3RIb3N0WzBdKSlcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29udGV4dE1lbnUodGhpcy5sb2NhdG9yTWFwLCBzaGFkb3dSb290KS53YWl0KClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VwZXIub3BlbkNvbnRleHRNZW51KClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGN1cnNvcidzIGNvb3JkaW5hdGVzIGFzIGFuIGFycmF5IG9mIHR3byBudW1iZXJzOiBgW2xpbmUsIGNvbHVtbl1gXG4gICAgICpcbiAgICAgKiAqKkNhdXRpb24qKiBsaW5lICYgY29sdW1uIGNvb3JkaW5hdGVzIGRvIG5vdCBzdGFydCBhdCBgMGAgYnV0IGF0IGAxYCFcbiAgICAgKi9cbiAgICBhc3luYyBnZXRDb29yZGluYXRlcyAoKTogUHJvbWlzZTxbbnVtYmVyLCBudW1iZXJdPiB7XG4gICAgICAgIGNvbnN0IGNvb3JkczogbnVtYmVyW10gPSBbXVxuICAgICAgICBjb25zdCBzdGF0dXNCYXIgPSBuZXcgU3RhdHVzQmFyKHRoaXMubG9jYXRvck1hcClcbiAgICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSA8UmVnRXhwTWF0Y2hBcnJheT4oYXdhaXQgc3RhdHVzQmFyLmdldEN1cnJlbnRQb3NpdGlvbigpKS5tYXRjaCgvXFxkKy9nKVxuICAgICAgICBmb3IgKGNvbnN0IGMgb2YgY29vcmRpbmF0ZXMpIHtcbiAgICAgICAgICAgIGNvb3Jkcy5wdXNoKCtjKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbY29vcmRzWzBdLCBjb29yZHNbMV1dXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlIGJyZWFrcG9pbnQgb24gYSBnaXZlbiBsaW5lXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbGluZSB0YXJnZXQgbGluZSBudW1iZXJcbiAgICAgKiBAcmV0dXJucyBwcm9taXNlIHJlc29sdmluZyB0byB0cnVlIHdoZW4gYSBicmVha3BvaW50IHdhcyBhZGRlZCwgZmFsc2Ugd2hlbiByZW1vdmVkIG9yXG4gICAgICovXG4gICAgYXN5bmMgdG9nZ2xlQnJlYWtwb2ludCAobGluZTogbnVtYmVyKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGNvbnN0IG1hcmdpbiA9IGF3YWl0IHRoaXMubWFyZ2luQXJlYSRcbiAgICAgICAgY29uc3QgbGluZU51bSA9IGF3YWl0IG1hcmdpbi4kKHRoaXMubG9jYXRvcnMubGluZU51bWJlcihsaW5lKSlcbiAgICAgICAgYXdhaXQgbGluZU51bS5tb3ZlVG8oKVxuXG4gICAgICAgIGNvbnN0IGxpbmVPdmVybGF5ID0gYXdhaXQgbWFyZ2luLiQodGhpcy5sb2NhdG9ycy5saW5lT3ZlcmxheShsaW5lKSlcbiAgICAgICAgY29uc3QgYnJlYWtQb2ludCA9IGF3YWl0IGxpbmVPdmVybGF5LiQkKHRoaXMubG9jYXRvcnMuYnJlYWtQb2ludClcbiAgICAgICAgaWYgKGJyZWFrUG9pbnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXdhaXQgYnJlYWtQb2ludFswXS5jbGljaygpXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgd2Rpby9uby1wYXVzZVxuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5wYXVzZSgyMDApXG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5vQnJlYWsgPSBhd2FpdCBsaW5lT3ZlcmxheS4kJCh0aGlzLmxvY2F0b3JzLmRlYnVnSGludClcbiAgICAgICAgaWYgKG5vQnJlYWsubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXdhaXQgbm9CcmVha1swXS5jbGljaygpXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgd2Rpby9uby1wYXVzZVxuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5wYXVzZSgyMDApXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgY29kZSBsZW5zZXMgd2l0aGluIHRoZSBlZGl0b3JcbiAgICAgKiBAcmV0dXJucyBsaXN0IG9mIENvZGVMZW5zIHBhZ2Ugb2JqZWN0c1xuICAgICAqL1xuICAgIGFzeW5jIGdldENvZGVMZW5zZXMgKCk6IFByb21pc2U8Q29kZUxlbnNbXT4ge1xuICAgICAgICBjb25zdCBsZW5zZXM6IENvZGVMZW5zW10gPSBbXVxuICAgICAgICBjb25zdCB3aWRnZXRzID0gYXdhaXQgdGhpcy5lbGVtLiQoJy5jb250ZW50V2lkZ2V0cycpXG4gICAgICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgd2lkZ2V0cy4kJCgnLi8vc3Bhbltjb250YWlucyhAd2lkZ2V0aWQsIFxcJ2NvZGVsZW5zLndpZGdldFxcJyldJylcblxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFyZ3VtZW50XG4gICAgICAgICAgICBsZW5zZXMucHVzaChhd2FpdCBuZXcgQ29kZUxlbnModGhpcy5sb2NhdG9yTWFwLCBpdGVtIGFzIGFueSwgdGhpcykud2FpdCgpKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsZW5zZXNcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYSBjb2RlIGxlbnMgYmFzZWQgb24gdGl0bGUsIG9yIHplcm8gYmFzZWQgaW5kZXhcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbmRleE9yVGl0bGUgemVybyBiYXNlZCBpbmRleCAoY291bnRpbmcgZnJvbSB0aGUgdG9wIG9mIHRoZSBlZGl0b3IpLCBvciBwYXJ0aWFsIHRpdGxlIG9mIHRoZSBjb2RlIGxlbnNcbiAgICAgKiBAcmV0dXJucyBDb2RlTGVucyBvYmplY3QgaWYgc3VjaCBhIGNvZGUgbGVucyBleGlzdHMsIHVuZGVmaW5lZCBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBhc3luYyBnZXRDb2RlTGVucyAoaW5kZXhPclRpdGxlOiBudW1iZXIgfCBzdHJpbmcpOiBQcm9taXNlPENvZGVMZW5zIHwgdW5kZWZpbmVkPiB7XG4gICAgICAgIGNvbnN0IGxlbnNlcyA9IGF3YWl0IHRoaXMuZ2V0Q29kZUxlbnNlcygpXG5cbiAgICAgICAgaWYgKHR5cGVvZiBpbmRleE9yVGl0bGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxlbnMgb2YgbGVuc2VzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBhd2FpdCBsZW5zLmdldFRleHQoKVxuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gdGl0bGUubWF0Y2goaW5kZXhPclRpdGxlKVxuICAgICAgICAgICAgICAgIGlmIChtYXRjaCAmJiBtYXRjaC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBsZW5zXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGxlbnNlc1tpbmRleE9yVGl0bGVdKSB7XG4gICAgICAgICAgICByZXR1cm4gbGVuc2VzW2luZGV4T3JUaXRsZV1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgfVxufVxuXG5pbnRlcmZhY2UgU2VsZWN0aW9uIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFRleHRFZGl0b3JMb2NhdG9ycz4ge31cbi8qKlxuICogVGV4dCBzZWxlY3Rpb24gYmxvY2tcbiAqXG4gKiBAY2F0ZWdvcnkgRWRpdG9yXG4gKi9cbkBQYWdlRGVjb3JhdG9yKFRleHRFZGl0b3JMb2NhdG9ycylcbmNsYXNzIFNlbGVjdGlvbiBleHRlbmRzIEVsZW1lbnRXaXRoQ29udGV4dE1lbnU8dHlwZW9mIFRleHRFZGl0b3JMb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHVibGljIGxvY2F0b3JLZXkgPSAnVGV4dEVkaXRvcicgYXMgY29uc3RcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgbG9jYXRvcnM6IFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgICAgIGVsZW1lbnQ6IENoYWluYWJsZVByb21pc2VFbGVtZW50PFdlYmRyaXZlcklPLkVsZW1lbnQ+LFxuICAgICAgICBwdWJsaWMgZWRpdG9yOiBUZXh0RWRpdG9yXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGxvY2F0b3JzLCBlbGVtZW50KVxuICAgIH1cblxuICAgIGFzeW5jIG9wZW5Db250ZXh0TWVudSAoKTogUHJvbWlzZTxDb250ZXh0TWVudT4ge1xuICAgICAgICBhd2FpdCB0aGlzLmVsZW0uY2xpY2soeyBidXR0b246IDIgfSlcbiAgICAgICAgY29uc3Qgc2hhZG93Um9vdEhvc3QgPSBhd2FpdCB0aGlzLmVkaXRvci52aWV3LmVsZW0uJCQoJy5zaGFkb3ctcm9vdC1ob3N0JylcblxuICAgICAgICBpZiAoc2hhZG93Um9vdEhvc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3Qgc2hhZG93Um9vdCA9ICQoYXdhaXQgYnJvd3Nlci5leGVjdXRlKCdyZXR1cm4gYXJndW1lbnRzWzBdLnNoYWRvd1Jvb3QnLCBzaGFkb3dSb290SG9zdFswXSkpXG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbnRleHRNZW51KHRoaXMubG9jYXRvck1hcCwgc2hhZG93Um9vdCkud2FpdCgpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLm9wZW5Db250ZXh0TWVudSgpXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvZGVMZW5zIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFRleHRFZGl0b3JMb2NhdG9ycz4ge31cbi8qKlxuICogUGFnZSBvYmplY3QgZm9yIENvZGUgTGVucyBpbnNpZGUgYSB0ZXh0IGVkaXRvclxuICpcbiAqIEBjYXRlZ29yeSBFZGl0b3JcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoVGV4dEVkaXRvckxvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIENvZGVMZW5zIGV4dGVuZHMgQmFzZVBhZ2U8dHlwZW9mIFRleHRFZGl0b3JMb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHVibGljIGxvY2F0b3JLZXkgPSAnVGV4dEVkaXRvcicgYXMgY29uc3RcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgbG9jYXRvcnM6IFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgICAgIGVsZW1lbnQ6IENoYWluYWJsZVByb21pc2VFbGVtZW50PFdlYmRyaXZlcklPLkVsZW1lbnQ+LFxuICAgICAgICBwdWJsaWMgZWRpdG9yOiBUZXh0RWRpdG9yXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGxvY2F0b3JzLCBlbGVtZW50KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdGV4dCBkaXNwbGF5ZWQgb24gdGhlIGNvZGUgbGVuc1xuICAgICAqIEByZXR1cm5zIHRleHQgYXMgc3RyaW5nXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VGV4dCAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgbGluayA9IGF3YWl0IHRoaXMuZWxlbS4kKCdhJylcbiAgICAgICAgcmV0dXJuIGxpbmsuZ2V0VGV4dCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRvb2x0aXAgb2YgdGhlIGNvZGUgbGVuc1xuICAgICAqIEByZXR1cm5zIHRvb2x0aXAgYXMgc3RyaW5nXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VG9vbHRpcCAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgbGluayA9IGF3YWl0IHRoaXMuZWxlbS4kKCdhJylcbiAgICAgICAgcmV0dXJuIGxpbmsuZ2V0QXR0cmlidXRlKCd0aXRsZScpXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbmRXaWRnZXQgZXh0ZW5kcyBJUGFnZURlY29yYXRvcjx0eXBlb2YgRmluZFdpZGdldExvY2F0b3JzPiB7fVxuLyoqXG4gKiBUZXh0IEVkaXRvcidzIEZpbmQgV2lkZ2V0XG4gKlxuICogQGNhdGVnb3J5IEVkaXRvclxuICovXG5AUGFnZURlY29yYXRvcihGaW5kV2lkZ2V0TG9jYXRvcnMpXG5leHBvcnQgY2xhc3MgRmluZFdpZGdldCBleHRlbmRzIEJhc2VQYWdlPHR5cGVvZiBGaW5kV2lkZ2V0TG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ0ZpbmRXaWRnZXQnIGFzIGNvbnN0XG5cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIGxvY2F0b3JzOiBWU0NvZGVMb2NhdG9yTWFwLFxuICAgICAgICBlbGVtZW50OiBDaGFpbmFibGVQcm9taXNlRWxlbWVudDxXZWJkcml2ZXJJTy5FbGVtZW50PixcbiAgICAgICAgcHVibGljIHRleHRFZGl0b3I6IFRleHRFZGl0b3JcbiAgICApIHtcbiAgICAgICAgc3VwZXIobG9jYXRvcnMsIGVsZW1lbnQpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlIGJldHdlZW4gZmluZCBhbmQgcmVwbGFjZSBtb2RlXG4gICAgICogQHBhcmFtIHJlcGxhY2UgdHJ1ZSBmb3IgcmVwbGFjZSwgZmFsc2UgZm9yIGZpbmRcbiAgICAgKi9cbiAgICBhc3luYyB0b2dnbGVSZXBsYWNlIChyZXBsYWNlOiBib29sZWFuKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGJ0biA9IGF3YWl0IHRoaXMudG9nZ2xlUmVwbGFjZSRcbiAgICAgICAgY29uc3Qga2xhc3MgPSBhd2FpdCBidG4uZ2V0QXR0cmlidXRlKCdjbGFzcycpXG5cbiAgICAgICAgaWYgKChyZXBsYWNlICYmIGtsYXNzLmluY2x1ZGVzKCdjb2xsYXBzZWQnKSkgfHwgKCFyZXBsYWNlICYmICFrbGFzcy5pbmNsdWRlcygnY29sbGFwc2VkJykpKSB7XG4gICAgICAgICAgICBhd2FpdCBidG4uYWRkVmFsdWUoJyAnKVxuICAgICAgICAgICAgY29uc3QgcmVwbCA9IGF3YWl0IGJyb3dzZXIuJCh0aGlzLmxvY2F0b3JzLnJlcGxhY2VQYXJ0KVxuICAgICAgICAgICAgYXdhaXQgcmVwbC53YWl0Rm9yRXhpc3QoeyB0aW1lb3V0OiAyMDAwIH0pXG4gICAgICAgICAgICBpZiAocmVwbGFjZSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHJlcGwud2FpdEZvckRpc3BsYXllZCh7IHRpbWVvdXQ6IDIwMDAgfSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgcmVwbC53YWl0Rm9yRGlzcGxheWVkKHsgdGltZW91dDogMjAwMCwgcmV2ZXJzZTogdHJ1ZSB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IHRleHQgaW4gdGhlIHNlYXJjaCBib3hcbiAgICAgKiBAcGFyYW0gdGV4dCB0ZXh0IHRvIGZpbGwgaW5cbiAgICAgKi9cbiAgICBhc3luYyBzZXRTZWFyY2hUZXh0ICh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5rZXlzKFtDTURfS0VZLCAnZiddKVxuICAgICAgICBhd2FpdCBicm93c2VyLmtleXModGV4dClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGV4dCBmcm9tIEZpbmQgaW5wdXQgYm94XG4gICAgICogQHJldHVybnMgdmFsdWUgb2YgZmluZCBpbnB1dCBhcyBzdHJpbmdcbiAgICAgKi9cbiAgICBhc3luYyBnZXRTZWFyY2hUZXh0ICgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICBjb25zdCBmaW5kUGFydCA9IGF3YWl0IHRoaXMuZmluZFBhcnQkXG4gICAgICAgIHJldHVybiB0aGlzLmdldElucHV0VGV4dChmaW5kUGFydClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdGV4dCBpbiB0aGUgcmVwbGFjZSBib3guIFdpbGwgdG9nZ2xlIHJlcGxhY2UgbW9kZSBvbiBpZiBjYWxsZWQgaW4gZmluZCBtb2RlLlxuICAgICAqIEBwYXJhbSB0ZXh0IHRleHQgdG8gZmlsbCBpblxuICAgICAqL1xuICAgIGFzeW5jIHNldFJlcGxhY2VUZXh0ICh0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgdGhpcy50b2dnbGVSZXBsYWNlKHRydWUpXG4gICAgICAgIGNvbnN0IHJlcGxhY2VQYXJ0ID0gYXdhaXQgdGhpcy5yZXBsYWNlUGFydCRcbiAgICAgICAgYXdhaXQgdGhpcy5zZXRUZXh0KHRleHQsIHJlcGxhY2VQYXJ0KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0ZXh0IGZyb20gUmVwbGFjZSBpbnB1dCBib3hcbiAgICAgKiBAcmV0dXJucyB2YWx1ZSBvZiByZXBsYWNlIGlucHV0IGFzIHN0cmluZ1xuICAgICAqL1xuICAgIGFzeW5jIGdldFJlcGxhY2VUZXh0ICgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICBjb25zdCByZXBsYWNlUGFydCA9IGF3YWl0IHRoaXMucmVwbGFjZVBhcnQkXG4gICAgICAgIHJldHVybiB0aGlzLmdldElucHV0VGV4dChyZXBsYWNlUGFydClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGljayAnTmV4dCBtYXRjaCdcbiAgICAgKi9cbiAgICBhc3luYyBuZXh0TWF0Y2ggKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBuYW1lID0gKGF3YWl0IGJyb3dzZXIuZ2V0VlNDb2RlVmVyc2lvbigpKSA8ICcxLjU5LjAnID8gJ05leHQgbWF0Y2gnIDogJ05leHQgTWF0Y2gnXG4gICAgICAgIGF3YWl0IHRoaXMuY2xpY2tCdXR0b24obmFtZSwgJ2ZpbmQnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsaWNrICdQcmV2aW91cyBtYXRjaCdcbiAgICAgKi9cbiAgICBhc3luYyBwcmV2aW91c01hdGNoICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgbmFtZSA9IChhd2FpdCBicm93c2VyLmdldFZTQ29kZVZlcnNpb24oKSkgPCAnMS41OS4wJyA/ICdQcmV2aW91cyBtYXRjaCcgOiAnUHJldmlvdXMgTWF0Y2gnXG4gICAgICAgIGF3YWl0IHRoaXMuY2xpY2tCdXR0b24obmFtZSwgJ2ZpbmQnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsaWNrICdSZXBsYWNlJy4gT25seSB3b3JrcyBpbiByZXBsYWNlIG1vZGUuXG4gICAgICovXG4gICAgYXN5bmMgcmVwbGFjZSAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xpY2tCdXR0b24oJ1JlcGxhY2UnLCAncmVwbGFjZScpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xpY2sgJ1JlcGxhY2UgQWxsJy4gT25seSB3b3JrcyBpbiByZXBsYWNlIG1vZGUuXG4gICAgICovXG4gICAgYXN5bmMgcmVwbGFjZUFsbCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xpY2tCdXR0b24oJ1JlcGxhY2UgQWxsJywgJ3JlcGxhY2UnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsb3NlIHRoZSB3aWRnZXQuXG4gICAgICovXG4gICAgYXN5bmMgY2xvc2UgKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCB0aGlzLmNsaWNrQnV0dG9uKCdDbG9zZScsICdmaW5kJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIG51bWJlciBvZiByZXN1bHRzIGFzIGFuIG9yZGVyZWQgcGFpciBvZiBudW1iZXJzXG4gICAgICogQHJldHVybnMgcGFpciBpbiBmb3JtIG9mIFtjdXJyZW50IHJlc3VsdCBpbmRleCwgdG90YWwgbnVtYmVyIG9mIHJlc3VsdHNdXG4gICAgICovXG4gICAgYXN5bmMgZ2V0UmVzdWx0Q291bnQgKCk6IFByb21pc2U8W251bWJlciwgbnVtYmVyXT4ge1xuICAgICAgICBjb25zdCBjb3VudCA9IGF3YWl0IHRoaXMubWF0Y2hDb3VudCRcbiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IGNvdW50LmdldFRleHQoKVxuXG4gICAgICAgIGlmICh0ZXh0LmluY2x1ZGVzKCdObyByZXN1bHRzJykpIHtcbiAgICAgICAgICAgIHJldHVybiBbMCwgMF1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBudW1iZXJzID0gdGV4dC5zcGxpdCgnIG9mICcpXG4gICAgICAgIHJldHVybiBbK251bWJlcnNbMF0sICtudW1iZXJzWzFdXVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSB0aGUgc2VhcmNoIHRvIG1hdGNoIGNhc2VcbiAgICAgKiBAcGFyYW0gdG9nZ2xlIHRydWUgdG8gdHVybiBvbiwgZmFsc2UgdG8gdHVybiBvZmZcbiAgICAgKi9cbiAgICBhc3luYyB0b2dnbGVNYXRjaENhc2UgKHRvZ2dsZTogYm9vbGVhbikge1xuICAgICAgICBhd2FpdCB0aGlzLnRvZ2dsZUNvbnRyb2woJ01hdGNoIENhc2UnLCAnZmluZCcsIHRvZ2dsZSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUb2dnbGUgdGhlIHNlYXJjaCB0byBtYXRjaCB3aG9sZSB3b3Jkc1xuICAgICAqIEBwYXJhbSB0b2dnbGUgdHJ1ZSB0byB0dXJuIG9uLCBmYWxzZSB0byB0dXJuIG9mZlxuICAgICAqL1xuICAgIGFzeW5jIHRvZ2dsZU1hdGNoV2hvbGVXb3JkICh0b2dnbGU6IGJvb2xlYW4pIHtcbiAgICAgICAgYXdhaXQgdGhpcy50b2dnbGVDb250cm9sKCdNYXRjaCBXaG9sZSBXb3JkJywgJ2ZpbmQnLCB0b2dnbGUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlIHRoZSBzZWFyY2ggdG8gdXNlIHJlZ3VsYXIgZXhwcmVzc2lvbnNcbiAgICAgKiBAcGFyYW0gdG9nZ2xlIHRydWUgdG8gdHVybiBvbiwgZmFsc2UgdG8gdHVybiBvZmZcbiAgICAgKi9cbiAgICBhc3luYyB0b2dnbGVVc2VSZWd1bGFyRXhwcmVzc2lvbiAodG9nZ2xlOiBib29sZWFuKSB7XG4gICAgICAgIGF3YWl0IHRoaXMudG9nZ2xlQ29udHJvbCgnVXNlIFJlZ3VsYXIgRXhwcmVzc2lvbicsICdmaW5kJywgdG9nZ2xlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSB0aGUgcmVwbGFjZSB0byBwcmVzZXJ2ZSBjYXNlXG4gICAgICogQHBhcmFtIHRvZ2dsZSB0cnVlIHRvIHR1cm4gb24sIGZhbHNlIHRvIHR1cm4gb2ZmXG4gICAgICovXG4gICAgYXN5bmMgdG9nZ2xlUHJlc2VydmVDYXNlICh0b2dnbGU6IGJvb2xlYW4pIHtcbiAgICAgICAgYXdhaXQgdGhpcy50b2dnbGVDb250cm9sKCdQcmVzZXJ2ZSBDYXNlJywgJ3JlcGxhY2UnLCB0b2dnbGUpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyB0b2dnbGVDb250cm9sICh0aXRsZTogc3RyaW5nLCBwYXJ0OiAnZmluZCcgfCAncmVwbGFjZScsIHRvZ2dsZTogYm9vbGVhbikge1xuICAgICAgICBpZiAocGFydCAhPT0gJ2ZpbmQnICYmIHBhcnQgIT09ICdyZXBsYWNlJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdcInBhcnRcIiBwYXJhbWV0ZXIgbmVlZHMgdG8gYmUgXCJmaW5kXCIgb3IgXCJyZXBsYWNlXCInKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHBhcnQgPT09ICdmaW5kJ1xuICAgICAgICAgICAgPyBhd2FpdCB0aGlzLmZpbmRQYXJ0JFxuICAgICAgICAgICAgOiBhd2FpdCB0aGlzLnJlcGxhY2VQYXJ0JFxuXG4gICAgICAgIGlmIChwYXJ0ID09PSAncmVwbGFjZScpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudG9nZ2xlUmVwbGFjZSh0cnVlKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY29udHJvbCA9IGF3YWl0IGVsZW1lbnQuJCh0aGlzLmxvY2F0b3JzLmNoZWNrYm94KHRpdGxlKSlcbiAgICAgICAgY29uc3QgY2hlY2tlZCA9IGF3YWl0IGNvbnRyb2wuZ2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnKVxuICAgICAgICBpZiAoKHRvZ2dsZSAmJiBjaGVja2VkICE9PSAndHJ1ZScpIHx8ICghdG9nZ2xlICYmIGNoZWNrZWQgPT09ICd0cnVlJykpIHtcbiAgICAgICAgICAgIGF3YWl0IGNvbnRyb2wuY2xpY2soKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBjbGlja0J1dHRvbiAodGl0bGU6IHN0cmluZywgcGFydDogJ2ZpbmQnIHwgJ3JlcGxhY2UnKSB7XG4gICAgICAgIGlmIChwYXJ0ICE9PSAnZmluZCcgJiYgcGFydCAhPT0gJ3JlcGxhY2UnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1wicGFydFwiIHBhcmFtZXRlciBuZWVkcyB0byBiZSBcImZpbmRcIiBvciBcInJlcGxhY2VcIicpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBlbGVtZW50ID0gcGFydCA9PT0gJ2ZpbmQnXG4gICAgICAgICAgICA/IGF3YWl0IHRoaXMuZmluZFBhcnQkXG4gICAgICAgICAgICA6IGF3YWl0IHRoaXMucmVwbGFjZVBhcnQkXG5cbiAgICAgICAgaWYgKHBhcnQgPT09ICdyZXBsYWNlJykge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy50b2dnbGVSZXBsYWNlKHRydWUpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBidG4gPSBhd2FpdCBlbGVtZW50LiQodGhpcy5sb2NhdG9ycy5idXR0b24odGl0bGUpKVxuICAgICAgICBhd2FpdCBidG4uY2xpY2soKVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgd2Rpby9uby1wYXVzZVxuICAgICAgICBhd2FpdCBicm93c2VyLnBhdXNlKDEwMClcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHNldFRleHQgKHRleHQ6IHN0cmluZywgY29tcG9zaXRlOiBXZWJkcml2ZXJJTy5FbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gYXdhaXQgY29tcG9zaXRlLiQodGhpcy5sb2NhdG9ycy5pbnB1dClcbiAgICAgICAgYXdhaXQgaW5wdXQuc2V0VmFsdWUodGV4dClcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGdldElucHV0VGV4dCAoY29tcG9zaXRlOiBXZWJkcml2ZXJJTy5FbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gYXdhaXQgY29tcG9zaXRlLiQodGhpcy5sb2NhdG9ycy5jb250ZW50KVxuICAgICAgICByZXR1cm4gaW5wdXQuZ2V0SFRNTChmYWxzZSlcbiAgICB9XG59XG4iXX0=